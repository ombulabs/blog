<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
  xmlns:content="http://purl.org/rss/1.0/modules/content/"
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:itunes="http://www.itunes.com/dtds/podcast-1.0.dtd"
  xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
  <channel>
    <title>OmbuLabs Blog</title>
    <link>https://www.ombulabs.com/blog</link>
    <description>The Lean Software Boutique</description>
    <pubDate>Mon, 23 Jul 2018 07:48:00 -0400</pubDate>
    <item>
      <title>OmbuCast Episode 1 - Performance improvements using derailed_benchmarks</title>
      <link>https://www.ombulabs.com/blog/rails/performance/benchmark/performance-improvements-using-derailed-benchmarks.html</link>
      <description><![CDATA[

Transcript:

Hello and welcome to the first OmbuCast by Ombu Labs. In this screencast we&#39;ll
be taking a look at the
derailed_benchmarks gem,
and how you can use it to benchmark your Rails application and find, and
hopefully fix bottlenecks in your code.
]]></description>
      <pubDate>Mon, 23 Jul 2018 07:48:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/performance/benchmark/performance-improvements-using-derailed-benchmarks.html</guid>
      <content:encoded><![CDATA[<iframe width="560" height="315" src="https://www.youtube.com/embed/Zk67l-ZS9aM" frameborder="0" allowfullscreen></iframe>

<p><strong>Transcript:</strong></p>

<p>Hello and welcome to the first OmbuCast by Ombu Labs. In this screencast we&#39;ll
be taking a look at the
<a href="https://github.com/schneems/derailed_benchmarks"><code>derailed_benchmarks</code></a> gem,
and how you can use it to benchmark your Rails application and find, and
hopefully fix bottlenecks in your code.</p>

<!--more-->

<p>There are two ways you can benchmark your application, one is statically, which
uses your <code>Gemfile</code> to check for any gems which might be too big - which take
too much memory - and the other one is dynamically. To be able to run these,
you&#39;ll need to be able to boot your Rails application in production mode
locally. To be able to run the benchmarks I&#39;ll be showing, you&#39;ll need both the
<code>derailed_benchmarks</code> gem and also the
<a href="https://github.com/tmm1/stackprof"><code>stackprof</code></a> gem.</p>

<p>To show how the gem works, I created a test application, which just returns an
array - a JSON - which has many users, and it&#39;s a Rails 5.2 app. So it probably
won&#39;t be similar to results you may get from your own applications, but it&#39;s
good enough for, just showing how to apply these techniques.</p>

<p>So the first thing that you should do is finding out which one of your endpoints
is slow, be it in production or in development (usually you&#39;ll want to optimize
your production endpoints). And when you do that, you will need to measure how
many iterations per second the endpoint can do. This is to get a baseline, an
idea of how many, or, how fast, your endpoint initially is, and then when you
optimize, you can measure if the optimization was good or not. So our first step
then would be to run the IPS task that <code>derailed_benchmarks</code> provides and
specify that our path to hit will be <code>/users.json</code>.</p>

<p><code>PATH_TO_HIT=/users.json bundle exec derailed exec perf:ips</code></p>

<p>So we run this task and it will give us a number, which is the
IPS, the iterations per second, in this case it&#39;s 263. And this is the starting
point, so any modifications that we do to the code should not make it fall under
263 iterations per second for this endpoint in particular. So to start
optimizing, one thing we can do is to run the <code>stackprof</code> task that
<code>derailed_benchmarks</code> provides, to find where there are any potential
bottlenecks.</p>

<p><code>PATH_TO_HIT=/users.json bundle exec derailed exec perf:stackprof</code></p>

<p>Like before, we specify the <code>/users.json</code> endpoint, and run the
<code>stackprof</code> task. And we get this output from <code>stackprof</code>. The methods on top
are the ones that took the most CPU time: the logger, garbage collection. And
then there&#39;s one that probably jumps out, which is <code>Time.parse</code>, which we&#39;re
using in our controller here, and it&#39;s not exactly a very time consuming task to
parse the time, but since it&#39;s hard-coded, we can use <code>Time.at</code>, which is
slightly more performant than <code>Time.parse</code>, and it will accomplish the same
result. So what we can do here is to check in a Rails console.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">001</span> <span class="o">&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;2018-02-12 12:00:00 UTC&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span>
 <span class="o">=&gt;</span> <span class="mi">1518436800</span>
</code></pre></div>
<p>We can cast to integer, and we get the time that we can use for passing to
<code>Time.at</code>, and then we should do the same for the second one.</p>

<p>If you apply this kind of refactor in a real application, note that these should
probably be constants and not just magic numbers. So now we can run the
<code>stackprof</code> task again, and, yeah, <code>Time.parse</code> should now be gone. This doesn&#39;t
necessarily mean that your iterations per second will be better, it&#39;s a good
indicator, but you still need to double check. So we can check our IPS again,
and, they&#39;re roughly the same as before, which makes sense since it&#39;s a very
small modification, and also a very small app. What we can try and do is make
other changes to our app, and one such change can be the optimization of this
code here.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;send_reminder_at &gt; ?&quot;</span><span class="p">,</span> <span class="n">hour_12</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
  <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="ss">full_name</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">full_name</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>
<p>This is actually instantiating one user per iteration, so for each user, we have
to instantiate one object - one user object. So to save memory, we can introduce
a gem, it&#39;s called <code>pluck_to_hash</code>. It acts like ActiveRecord&#39;s <code>pluck</code>, but it
produces a hash like the JSON we&#39;re trying to produce. So let&#39;s try to install
it, and see how our iterations per second change, if they change.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">users_scope</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;send_reminder_at &gt; ?&quot;</span><span class="p">,</span> <span class="n">hour_12</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;created_at &lt; ?&quot;</span><span class="p">,</span> <span class="n">cut_off_date</span><span class="p">)</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">users_scope</span><span class="o">.</span><span class="n">pluck_to_hash</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:full_name</span><span class="p">)</span>
</code></pre></div>
<p>And now we can run our IPS task again, and measure the change. And yeah,
that&#39;s a noticeable difference, there&#39;s about 60 more iterations per second.
Like I mentioned before though, this is a small scale application, so you may
have similar results, or you may not, it depends on your application. Since our
Rails application is serving a JSON, another gem we can use is called
<a href="https://github.com/ohler55/oj"><code>OJ</code></a>. It stands for &quot;optimized JSON&quot;, and it&#39;s
a faster JSON parser than the default that Rails uses. We&#39;ll install it in our
app by adding it to the <code>Gemfile</code>. And then we need to create an initializer,
and we can check our updated IPS.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># config/initializers/oj.rb</span>

<span class="no">Oj</span><span class="o">.</span><span class="n">optimize_rails</span>
</code></pre></div>
<p>And that&#39;s another performance improvement there, it almost - 400 iterations per
second from 320 and 270 before that, that&#39;s almost 100%, you should keep in mind
though that all of these improvements should be done with a good test suite,
since you should make sure that these changes don&#39;t break compatibility with
your current application. And again, these modifications probably don&#39;t make
much sense in an application this small, but hopefully you can apply them to
your larger Rails applications.</p>

<p>And on a final note, you should benchmark, improve, rinse and repeat. I hope you
found these techniques useful, let me know in the comments if you have doubts
about any of them, and I will see you on the next episode.</p>
]]></content:encoded>
      <dc:date>2018-07-23T07:48:00-04:00</dc:date>
    </item>
    <item>
      <title>Upgrade Rails from 5.0 to 5.1</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-5-0-to-5-1.html</link>
      <description><![CDATA[This article is part of our Upgrade Rails series. To see more of them, click here.

This article will cover the most important aspects that you need to know to get
your Ruby on Rails application from version 5.0 to 5.1.
]]></description>
      <pubDate>Wed, 18 Jul 2018 06:05:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-5-0-to-5-1.html</guid>
      <content:encoded><![CDATA[<p><em>This article is part of our Upgrade Rails series. To see more of them, <a href="https://www.ombulabs.com/blog/tags/upgrades">click here</a></em>.</p>

<p>This article will cover the most important aspects that you need to know to get
your <a href="http://rubyonrails.org/">Ruby on Rails</a> application from <a href="http://guides.rubyonrails.org/5_0_release_notes.html">version 5.0</a> to <a href="http://guides.rubyonrails.org/5_1_release_notes.html">5.1</a>.</p>

<!--more-->

<ol>
<li><a href="#ruby-version">Ruby version</a></li>
<li><a href="#gems">Gems</a></li>
<li><a href="#config-files">Config files</a></li>
<li><a href="#application-code">Application code</a>

<ol>
<li><a href="#active-record">ActiveRecord</a></li>
<li><a href="#controllers">Controllers</a></li>
</ol></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>

<h2 id="ruby-version">1. Ruby version</h2>

<p>Like Rails 5.0, <a href="https://weblog.rubyonrails.org/2017/4/27/Rails-5-1-final/">Rails 5.1</a> requires <a href="https://www.ruby-lang.org/en/news/2015/04/13/ruby-2-2-2-released/">Ruby 2.2.2</a> or later.</p>

<h2 id="gems">2. Gems</h2>

<ul>
<li>Make sure the gems you use are compatible with Rails 5.1, you can check this
using <a href="http://www.ready4rails.net">Ready4Rails</a>. If a gem is missing on
Ready4Rails, you&#39;ll need to manually check the Github page for the project to
find out its status. In case you own the gem, you&#39;ll need to make sure it
supports Rails 5.1 and if it doesn&#39;t, update it.</li>
</ul>

<h2 id="config-files">3. Config files</h2>

<p>Rails includes the <code>rails app:update</code> <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#the-update-task">task</a>.
You can use this task as a guideline as explained thoroughly in
<a href="http://thomasleecopeland.com/2015/08/06/running-rails-update.html">this post</a>.</p>

<p>As an alternative, check out <a href="http://railsdiff.org/5.0.7/5.1.6">RailsDiff</a>,
which provides an overview of the changes in a basic Rails app between 5.0.x and
5.1.x (or any other source/target versions). Always target your upgrade to the
latest patch version (e.g: 5.1.6 instead of 5.1.0).</p>

<p>Some assets configuration changes you&#39;ll have to do on your
<code>config/environments/{development, test, production}.rb</code> files are:</p>

<p>Before:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">config</span><span class="o">.</span><span class="n">serve_static_files</span> <span class="o">=</span> <span class="kp">false</span>
<span class="n">config</span><span class="o">.</span><span class="n">static_cache_control</span> <span class="o">=</span> <span class="s2">&quot;public, max-age=3600&quot;</span>
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">config</span><span class="o">.</span><span class="n">public_file_server</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kp">false</span>
<span class="n">config</span><span class="o">.</span><span class="n">public_file_server</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="s2">&quot;public, max-age=3600&quot;</span>
</code></pre></div>
<h2 id="application-code">4. Application code</h2>

<p><h3 id="active-record">4.1. ActiveRecord</h2></p>

<ul>
<li><p>The <code>raise_in_transactional_callbacks</code> option is now removed. It was
already deprecated and covered in a <a href="https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-4-1-to-4-2.html">previous upgrade</a>.</p></li>
<li><p>Also removed was <code>use_transactional_fixtures</code>, which was <a href="https://github.com/rails/rails/pull/19282">replaced by</a>
<code>use_transactional_tests</code>.</p></li>
<li><p><code>ActiveRecord::Base#uniq</code> was removed, it was deprecated in Rails 5.0 and has
been replaced by <code>#distinct</code>. Check out https://github.com/rails/rails/pull/20198
for the discussion.</p></li>
</ul>

<p><h3 id="controllers">4.2. Controllers</h2></p>

<ul>
<li>Before Rails 5.1, conditions in filters could be invoked using strings. They
now have to be symbols:</li>
</ul>

<p>Before</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="n">before_action</span> <span class="ss">:authenticate_user!</span><span class="p">,</span> <span class="k">unless</span><span class="p">:</span> <span class="s1">&#39;has_project_guest_id&#39;</span>
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="n">before_action</span> <span class="ss">:authenticate_user!</span><span class="p">,</span> <span class="k">unless</span><span class="p">:</span> <span class="ss">:has_project_guest_id</span>
</code></pre></div>
<ul>
<li>All <code>*_filter</code> methods are now called <code>*_action</code>:</li>
</ul>

<p>These methods were actually already deprecated in Rails 5.0, and Rails 5.1
removes support for <code>*_filter</code> usage, so you should be using <code>*_action</code>.</p>

<p>Before:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">skip_before_filter</span> <span class="ss">:authenticate_user!</span>
<span class="n">before_filter</span> <span class="ss">:authenticate_user!</span>
<span class="n">after_filter</span> <span class="ss">:do_something</span>
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">skip_before_action</span> <span class="ss">:authenticate_user!</span>
<span class="n">before_action</span> <span class="ss">:authenticate_user!</span>
<span class="n">after_action</span> <span class="ss">:do_something</span>
</code></pre></div>
<h2 id="testing">5. Testing</h2>

<ul>
<li>Parameters in controller tests now need a <code>params</code> key:</li>
</ul>

<p>Rails 5.0 had already deprecated this behavior, and Rails 5.1 drops support for
passing parameters without using keyword arguments. This change is necessary
even if you&#39;re using RSpec:</p>

<p>Before:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">expect</span> <span class="p">{</span> <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="n">params</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">(</span><span class="no">Project</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">expect</span> <span class="p">{</span> <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="n">params</span> <span class="p">}</span><span class="o">.</span><span class="n">to</span> <span class="n">change</span><span class="p">(</span><span class="no">Project</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span><span class="o">.</span><span class="n">by</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<h2 id="next-steps">6. Next steps</h2>

<p>If you successfully followed all of these steps, you should now be running Rails 5.1! Do you have any other useful tips or recommendations? Share them with us in the comments section.</p>

<p>If you don&#39;t have the time to upgrade your Rails app, check out our <a href="https://fastruby.io">Ruby on Rails
upgrade</a> service: <a href="https://fastruby.io">FastRuby.io</a></p>
]]></content:encoded>
      <dc:date>2018-07-18T06:05:00-04:00</dc:date>
    </item>
    <item>
      <title>Refactoring: Clean your ruby code with design patterns</title>
      <link>https://www.ombulabs.com/blog/code-refactor/refactoring-with-design-patterns.html</link>
      <description><![CDATA[Code refactoring can be defined as “the process of introducing small and incremental changes to leave the code in a better state than it was.”. When refactoring your code you have to consider two things: no new functionality should be added and the external behavior should not be affected.

One of the biggest challenges as a Ruby on Rails Developer is to keep your code clean, simple and easy to maintain and that is why we are always refactoring our code.

There are several techniques that a developer can follow to improve their code by code refactoring, such as extract method, move method, move field, switch statements, etc. If you are not familiarized with them, please visit the Refactoring Guru site.

Another technique developers try to follow is to apply good design patterns to their code. In this post we&#39;ll try to go over some of the documented design patterns and how you can apply them to your Ruby code.
]]></description>
      <pubDate>Thu, 28 Jun 2018 08:00:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/code-refactor/refactoring-with-design-patterns.html</guid>
      <content:encoded><![CDATA[<p>Code refactoring can be defined as <strong><em>“the process of introducing small and incremental changes to leave the code in a better state than it was.”</em></strong>. When refactoring your code you have to consider two things: no new functionality should be added and the external behavior should not be affected.</p>

<p>One of the biggest challenges as a Ruby on Rails Developer is to keep your code clean, simple and easy to maintain and that is why we are always refactoring our code.</p>

<p>There are several techniques that a developer can follow to improve their code by code refactoring, such as extract method, move method, move field, switch statements, etc. If you are not familiarized with them, please visit the <a href="https://refactoring.guru/">Refactoring Guru site</a>.</p>

<p>Another technique developers try to follow is to apply good design patterns to their code. In this post we&#39;ll try to go over some of the documented design patterns and how you can apply them to your Ruby code.</p>

<!--more-->

<h2 id="design-patterns">Design Patterns</h2>

<p>A design pattern can be described as <strong><em>“typical solutions to commonly occurring problems in software design. They are blueprints, that can be taken and customized to solve a particular design problem in your code”</em></strong>. So design patterns are not rules but guides that can help you to find the best solution given a particular situation. That is why, as pragmatic developers, we have always a good design pattern on the hand.</p>

<p>Explaining each pattern in detail is out of this article’s scope, so if you are not familiar with the presented design patterns, a good reference is the book <a href="https://www.amazon.com/Design-Patterns-Object-Oriented-Addison-Wesley-Professional-ebook/dp/B000SEIBB8">Design Patterns: Elements of Reusable Object-Oriented
Software</a>, written by the famous Gang of Four (GoF).</p>

<p>Since there are 23 design patterns cataloged in the book, our intention here is to cover the most used of them and how they can be useful to clean our Ruby code.</p>

<h2 id="factory-method">Factory Method</h2>

<p>When we think about a factory, what comes to mind is a place that builds different products that share common characteristics: cars, electronics, toys, medicines, cakes and several others. You expect that all car factories will build cars and these cars will have different colors, sizes, shapes, etc, right?</p>

<p>Now, let’s say that we have to build an application and one of the functionalities is to create employees. The employees can be one of three different types: full-time, part-time and contractor and each type of employee will have a different hourly rate. So the requirement is to send a hash with the employee information and based on the type, we need to create the correct employee object.</p>

<p>Let’s create the <code>Employee</code> class:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1">#lib/factory/employee.rb</span>
<span class="k">class</span> <span class="nc">Employee</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">employee</span> <span class="o">=</span> <span class="no">Employee</span><span class="o">.</span><span class="n">new</span>

    <span class="n">type</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:type</span><span class="o">]</span>

    <span class="k">case</span> <span class="n">type</span>
    <span class="k">when</span> <span class="s2">&quot;fulltime&quot;</span>
      <span class="n">employee</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="ss">:full_time</span>
      <span class="n">employee</span><span class="o">.</span><span class="n">hourly_rate</span> <span class="o">=</span> <span class="mi">60</span><span class="o">.</span><span class="mo">00</span>
    <span class="k">when</span> <span class="s2">&quot;parttime&quot;</span>
      <span class="n">employee</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="ss">:part_time</span>
      <span class="n">employee</span><span class="o">.</span><span class="n">hourly_rate</span> <span class="o">=</span> <span class="mi">50</span><span class="o">.</span><span class="mo">00</span>
    <span class="k">when</span> <span class="s2">&quot;contractor&quot;</span>
      <span class="n">employee</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="ss">:contractor</span>
      <span class="n">employee</span><span class="o">.</span><span class="n">hourly_rate</span> <span class="o">=</span> <span class="mi">20</span><span class="o">.</span><span class="mo">00</span>
    <span class="k">end</span>

    <span class="n">employee</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>This code works. It creates an employee and fills its information based on the given type. But the code is not beautiful and imagine the trouble if we need to change an existing employee type or even add a new one.</p>

<p>To improve this code we could apply a refactor to extract the business logic of create employees to another class, then the Employee class will have only the responsibility to call the correct employee constructor. The process of extracting the creation business logic to specific classes and methods is the goal of the Factory Method.</p>

<p>The basic principle of this pattern is to have factories creating products, a metaphor to a real factory. With the Factory Method we will change our code to:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># lib/factory/employee.rb</span>
<span class="k">class</span> <span class="nc">Employee</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="no">EmployeeFactory</span><span class="o">.</span><span class="n">create_employee</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># lib/factory/employee_factory.rb</span>
<span class="k">class</span> <span class="nc">EmployeeFactory</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_employee</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="k">case</span> <span class="n">params</span><span class="o">[</span><span class="ss">:type</span><span class="o">]</span>
    <span class="k">when</span> <span class="s2">&quot;fulltime&quot;</span>
      <span class="no">FullTimeEmployee</span><span class="o">.</span><span class="n">new</span>
    <span class="k">when</span> <span class="s2">&quot;parttime&quot;</span>
      <span class="no">PartTimeEmployee</span><span class="o">.</span><span class="n">new</span>
    <span class="k">when</span> <span class="s2">&quot;contractor&quot;</span>
      <span class="no">FullTimeEmployee</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>This way the <code>EmployeeFactory</code> doesn’t need to know how to create each type of employee, they are all created the same way. The logic to create employees is defined on the <code>EmployeeFactory</code> class, that will call specialized constructors for each employee type. The responsibility of these constructors is to know only its own necessary information, like the hourly_rate, for example. That way if we ever need to add a new employee type it will be much easier.</p>

<h2 id="strategy">Strategy</h2>

<p>Now let&#39;s say that our next functionality is to calculate the net salary of the employees. The net salary is the salary that they will receive once all the taxes are applied.</p>

<p>Since different countries have different taxes rules our code needs to handle this when perform the calculation.</p>

<p>Let&#39;s implement the <code>EmployeeSalary</code> class:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># lib/strategy_sample/employee_salary.rb</span>
<span class="k">class</span> <span class="nc">EmployeeSalary</span>
  <span class="no">ARG_TAX</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
  <span class="no">USA_TAX</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">3</span>
  <span class="no">BRA_TAX</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">calculate_net_salary</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
    <span class="n">country_taxes</span> <span class="o">=</span> <span class="k">case</span> <span class="n">country</span>
      <span class="k">when</span> <span class="s2">&quot;Argentina&quot;</span>
        <span class="p">(</span><span class="n">amount</span> <span class="o">*</span> <span class="no">ARG_TAX</span><span class="p">)</span>
        <span class="c1"># Argentina tax calculation</span>
      <span class="k">when</span> <span class="s2">&quot;USA&quot;</span>
        <span class="p">(</span><span class="n">amount</span> <span class="o">*</span> <span class="no">USA_TAX</span><span class="p">)</span> <span class="o">+</span> <span class="mi">200</span>
        <span class="c1"># USA tax calculation</span>
      <span class="k">when</span> <span class="s2">&quot;Brazil&quot;</span>
        <span class="p">(</span><span class="n">amount</span> <span class="o">+</span> <span class="mi">500</span><span class="p">)</span> <span class="o">/</span> <span class="no">BRA_TAX</span>
        <span class="c1"># Brazil tax calculation</span>

    <span class="n">amount</span> <span class="o">-</span> <span class="n">taxes</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>We can easily see that the <code>calculate_net_salary</code> will massively grow each time that we need to add a new country. This situation breaks the <a href="https://en.wikipedia.org/wiki/Open%E2%80%93closed_principle">open/closed principle</a> that says: <em>&quot;software entities (classes, modules, functions, etc.) should be open for extension, but closed for modification&quot;</em>. This means that to make a class do new things you shouldn’t need to change the class itself.</p>

<p>If we can not extend the <code>calculate_net_salary</code> method to make a new country calculation without a lot of modification we are not following this principle. To solve this situation we can apply the Strategy Pattern to refactor our code.</p>

<p>The <strong>Strategy</strong> is a behavioral design pattern that suggests to take a class that does something important in a lot of different ways and extract all these algorithms into separate classes called strategies. The original class, called <em>context</em>, will receive a field that references to one of the strategies.</p>

<p>With that concept in mind we can refactor the context class:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># lib/strategy_sample/employee_salary.rb</span>
<span class="k">class</span> <span class="nc">EmployeeSalary</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
    <span class="vi">@strategy</span> <span class="o">=</span> <span class="n">strategy</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@strategies</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;USA&#39;</span><span class="p">:</span> <span class="no">UsaTaxes</span><span class="p">,</span>
      <span class="s1">&#39;ARG&#39;</span><span class="p">:</span> <span class="no">ArgentinaTaxes</span><span class="p">,</span>
      <span class="s1">&#39;BRA&#39;</span><span class="p">:</span> <span class="no">BrazilTaxes</span>
    <span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">calculate_net_salary</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>
    <span class="n">strategy</span> <span class="o">=</span> <span class="vi">@strategies</span><span class="o">[</span><span class="n">country</span><span class="o">]</span>

    <span class="n">strategy</span> <span class="p">?</span> <span class="n">amount</span> <span class="o">-</span> <span class="n">strategy</span><span class="o">.</span><span class="n">taxes</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="p">:</span> <span class="n">amount</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Then we will create one strategy for each one of the necessary country calculations.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># lib/strategy_sample/strategies/usa_taxes.rb</span>
<span class="k">class</span> <span class="nc">UsaTaxes</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">taxes</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
    <span class="c1"># USA tax calculation here</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># lib/strategy_sample/strategies/argentina_taxes.rb</span>
<span class="k">class</span> <span class="nc">ArgentinaTaxes</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">taxes</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
    <span class="c1"># Argentina tax calculation here</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># lib/strategy_sample/strategies/argentina_taxes.rb</span>
<span class="k">class</span> <span class="nc">BrazilTaxes</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">taxes</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
    <span class="c1"># Argentina tax calculation here</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>That way the single responsibility of the <code>EmployeeSalary</code> class is to delegate the calculation work to a linked strategy instead of executing it on its own.</p>

<p>Wherever we need to get the net salary we should call the <code>EmployeeSalary</code> class like this:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Taxes</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">net_salary</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;BRA&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Now if we need to add a new country we just need to create a new strategy and add to the context class. With this refactor we can keep all the concerns separated and the code is cleaner and easier to maintain.</p>

<h2 id="next-steps">Next steps</h2>

<p>In this post we talked about two very useful design patterns and how we can use them to improve code quality. We hope this was helpful for you. Keep following our blog, we will talk more about this subject soon.</p>
]]></content:encoded>
      <dc:date>2018-06-28T08:00:00-04:00</dc:date>
    </item>
    <item>
      <title>Announcing Gemfile.lock Audit Tool</title>
      <link>https://www.ombulabs.com/blog/rails/ruby/rubygems/announcing-audit-tool.html</link>
      <description><![CDATA[Today we are happy to announce the launch of our new microsite: Gemfile.lock Audit Tool - a tool created to allow users to check their Gemfile.lock for vulnerabilities in a quick and secure manner.
]]></description>
      <pubDate>Fri, 22 Jun 2018 07:10:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/ruby/rubygems/announcing-audit-tool.html</guid>
      <content:encoded><![CDATA[<p>Today we are happy to announce the launch of our new microsite: <a href="https://audit.fastruby.io">Gemfile.lock Audit Tool</a> - a tool created to allow users to check their Gemfile.lock for vulnerabilities in a quick and secure manner.</p>

<!--more-->

<p>The tool uses the <a href="https://github.com/rubysec/bundler-audit">bundler-audit gem</a> to check for vulnerable versions of gems and insecure gem sources. The tool updates automatically with new warnings as the bundler-audit gem database of vulnerabilities is updated.</p>

<p>Thanks to this tool, users can now easily audit their Gemfile.lock without installing any gems or editing their code. Check it out at <a href="https://audit.fastruby.io">https://audit.fastruby.io</a>, and let us know what you think!</p>
]]></content:encoded>
      <dc:date>2018-06-22T07:10:00-04:00</dc:date>
    </item>
    <item>
      <title>Another successful Rails Girls event</title>
      <link>https://www.ombulabs.com/blog/learning/rails/another-successful-rails-girls-event.html</link>
      <description><![CDATA[Last month was the fifth edition of the Rails Girls Buenos Aires event,  and the third time Ombu Labs participated as a sponsor and part of the coaching team. This time it took place in the impressive offices of Google Argentina where 25 participants attended. All of them were very excited and motivated to start learning new skills.
]]></description>
      <pubDate>Mon, 18 Jun 2018 10:00:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/learning/rails/another-successful-rails-girls-event.html</guid>
      <content:encoded><![CDATA[<p>Last month was the fifth edition of the <a href="http://railsgirls.com/buenosaires-en.html">Rails Girls Buenos Aires</a> event,  and the third time Ombu Labs participated as a sponsor and part of the coaching team. This time it took place in the impressive offices of Google Argentina where 25 participants attended. All of them were very excited and motivated to start learning new skills.</p>

<!--more-->

<p><img src="/blog/assets/images/rails-girls/everybody.jpg"></p>

<p>For those who have never heard of Rails Girls, it’s a 2-day workshop to introduce women to programming, with a focus on the <a href="https://rubyonrails.org/">Ruby on Rails</a> framework. We also talk about the current situation of women in technology and the things that we can do to increase the number of women working in this industry.</p>

<p>During the workshop, each participant developed a basic Ruby on Rails application from scratch. Most of the participants had no previous experience in programming but one of the great things about Rails is that it&#39;s incredibly friendly for beginners. It allows you to create applications without worrying about some advanced concepts that aren&#39;t necessary to know yet.</p>

<p>This event was a great experience once again, even as a coach you end up learning a lot from the participants. Here are a couple of photos from that day:</p>

<p><img src="/blog/assets/images/rails-girls/group1.jpg"></p>

<p><img src="/blog/assets/images/rails-girls/teaching.jpg"></p>

<p><img src="/blog/assets/images/rails-girls/group2.jpg"></p>

<p><img src="/blog/assets/images/rails-girls/mvc.jpg"></p>

<p><img src="/blog/assets/images/rails-girls/group3.jpg"></p>

<p><img src="/blog/assets/images/rails-girls/rails-landing.jpg"></p>

<p>At Ombu Labs we believe that it is very important that more companies start working to have more diverse teams. That&#39;s why we decided to contribute to this cause, and we’re going to keep doing it.</p>
]]></content:encoded>
      <dc:date>2018-06-18T10:00:00-04:00</dc:date>
    </item>
    <item>
      <title>Upgrade Rails from 4.2 to 5.0</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-4-2-to-5-0.html</link>
      <description><![CDATA[This article is part of our Upgrade Rails series. To see more of them, click here.

This article will cover the most important aspects that you need to know to get
your Ruby on Rails application from version 4.2 to 5.0.
]]></description>
      <pubDate>Tue, 06 Mar 2018 05:53:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-4-2-to-5-0.html</guid>
      <content:encoded><![CDATA[<p><em>This article is part of our Upgrade Rails series. To see more of them, <a href="https://www.ombulabs.com/blog/tags/upgrades">click here</a></em>.</p>

<p>This article will cover the most important aspects that you need to know to get
your <a href="http://rubyonrails.org/">Ruby on Rails</a> application from <a href="http://guides.rubyonrails.org/4_2_release_notes.html">version 4.2</a> to <a href="http://guides.rubyonrails.org/5_0_release_notes.html">5.0</a>.</p>

<!--more-->

<ol>
<li><a href="#ruby-version">Ruby version</a></li>
<li><a href="#gems">Gems</a></li>
<li><a href="#config-files">Config files (config/)</a></li>
<li><a href="#application-code">Application code</a>

<ol>
<li><a href="#active-record">ActiveRecord</a></li>
<li><a href="#controllers">Controllers</a></li>
</ol></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>

<h2 id="ruby-version">1. Ruby version</h2>

<p><a href="http://weblog.rubyonrails.org/2016/6/30/Rails-5-0-final/">Rails 5.0</a> requires <a href="https://www.ruby-lang.org/en/news/2015/04/13/ruby-2-2-2-released/">Ruby 2.2.2</a> or later.</p>

<p>This Ruby upgrade shouldn&#39;t generate any problems. However, if you run into this
exception in your test suite:</p>

<p><code>cannot load such file -- test/unit/assertions (Load Error)</code></p>

<p>then you&#39;ll need to add:</p>

<p><code>gem &#39;test-unit&#39;</code></p>

<p>to your <code>Gemfile</code>.</p>

<h2 id="gems">2. Gems</h2>

<ul>
<li>It&#39;s recommended that you check your <code>Gemfile</code> against <a href="http://www.ready4rails.net">Ready4Rails</a>
to ensure all your gems are compatible with Rails 5.
As of the release of this blog post, there are only a few gems which don&#39;t
support Rails 5 yet. This is more of a problem when you&#39;re upgrading early on.</li>
</ul>

<p>If any of the gems are missing on Ready4Rails, you&#39;ll need to manually check the
Github page for the project to find out its status. In case you own the gem,
you&#39;ll need to make sure it works on Rails 5 or update it.</p>

<h2 id="config-files">3. Config files</h2>

<p>Rails includes the <code>rails app:update</code> <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#the-update-task">task</a>.
You can use this task as a guideline as explained thoroughly in
<a href="http://thomasleecopeland.com/2015/08/06/running-rails-update.html">this post</a>.</p>

<p>As an alternative, check out <a href="http://railsdiff.org/4.2.10/5.0.6">RailsDiff</a>,
which provides an overview of the changes in a basic Rails app between 4.2.x and
5.0.x (or any other source/target versions).</p>

<h2 id="application-code">4. Application code</h2>

<p><h3 id="active-record">a. ActiveRecord</h2></p>

<ul>
<li>ActiveRecord models will now inherit from ApplicationRecord by default instead
of ActiveRecord::Base. You should create an <code>application_record.rb</code> file under
<code>app/models</code> with:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">ApplicationRecord</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="nb">self</span><span class="o">.</span><span class="n">abstract_class</span> <span class="o">=</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre></div>
<p>And then update all of your models to inherit from <code>ApplicationRecord</code> instead
of <code>ActiveRecord::Base</code>. The only class that inherits from <code>ActiveRecord::Base</code>
will be <code>ApplicationRecord</code>.</p>

<ul>
<li><code>belongs_to</code> associations are <a href="https://github.com/rails/rails/pull/18937/files">now required by default</a>.
This means that if the association doesn&#39;t exist for a model when saving it, an
error will be triggered. You can turn this feature off for an association by
using <code>optional: true</code>:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">belongs_to</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">optional</span><span class="p">:</span> <span class="kp">true</span>
</code></pre></div>
<ul>
<li>ActiveRecord migrations now need to be tagged with the Rails version they are
created under. One of the reasons for this is that strings in Rails 4.2 had a
default size of 4 bytes. In Rails 5.0, their default size is now of 8 bytes. See
<a href="https://stackoverflow.com/a/35930912/2754597">this comment</a> from Rails core
team member Rafael França regarding this change.</li>
</ul>

<p>To resolve this, you&#39;ll need to update your current migrations in your <code>db/migrate</code> directory:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">CreatePosts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</code></pre></div><div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">CreatePosts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="o">[</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span><span class="o">]</span>
</code></pre></div>
<p>If you add a new migration after updating to Rails 5.0, you&#39;ll also need to tag
them appropriately:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">CreateProducts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="o">[</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span>
</code></pre></div>
<p>This will help with potential compatibility issues, so your database can be
correctly reconstructed from the migrations. Strings in your 4.2 migrations
will use the previous default size of 4 bytes instead of the new default.</p>

<p>Note you shouldn&#39;t add the patch version to the tag, just the major and minor
version numbers (<code>4.2</code>, <code>5.0</code>, <code>5.1</code>, <code>5.2</code>).</p>

<p>(Thanks to Cory McDonald in the comments section for reminding us about this
important change!)</p>

<p><h3 id="controllers">b. Controllers</h2></p>

<ul>
<li>If you&#39;re not already using strong parameters, and still rely on
<code>protected_attributes</code>, you should migrate your application to strong
parameters before attempting to upgrade to Rails 5.0.
<a href="https://github.com/rails/protected_attributes"><code>protected_attributes</code></a> is
no longer supported on Rails 5.0.</li>
</ul>

<p>A few months ago we worked on a project to attempt to automate the strong
parameters migration process, and this resulted in the gem <a href="https://github.com/fastruby/rails_upgrader">RailsUpgrader</a>.
It&#39;s in a beta state, but you can try using it if you have too many models, or
at least as a guide for a WIP branch.</p>

<p>There are still efforts being made to keep <code>protected_attributes</code> alive though,
like the <a href="https://github.com/westonganger/protected_attributes_continued"><code>protected_attributes_continued</code></a>
gem. I would strongly recommend against using it since its support is limited,
and it won&#39;t work in future Rails versions.</p>

<ul>
<li>Parameters now behave differently, they no longer inherit from
<code>HashWithIndifferentAccess</code>. Some methods (e.g.: <code>fetch</code>, <code>slice</code>, <code>except</code>) you
may be now calling on <code>params</code> will no longer work. You will need to <code>permit</code>
the parameters, call <code>to_h</code>, and only then you&#39;ll be able to run the <code>Hash</code>
methods you need on them.</li>
</ul>

<p>For more information: <a href="https://github.com/rails/rails/pull/20868">https://github.com/rails/rails/pull/20868</a></p>

<h2 id="testing">5. Testing</h2>

<ul>
<li>One of the most common methods in controller tests, <code>assigns</code>, has been
extracted from Rails and moved to the <a href="https://github.com/rails/rails-controller-testing"><code>rails-controller-testing</code></a> gem.
If you wish to continue using it (and <code>assert_template</code>), you&#39;ll need to add it
to your <code>Gemfile</code>:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;rails-controller-testing&#39;</span>
</code></pre></div>
<ul>
<li>Instead of using <code>ActionDispatch::Http::UploadedFile</code> to test uploads, you&#39;ll
need to update those tests to use <a href="http://www.rubydoc.info/github/brynary/rack-test/Rack/Test/UploadedFile"><code>Rack::Test::UploadedFile</code></a>.</li>
</ul>

<h2 id="next-steps">6. Next steps</h2>

<p>If you successfully followed all of these steps, you should now be running Rails 5.0! Do you have any other useful tips or recommendations? Share them with us in the comments section.</p>

<p>If you don&#39;t have the time to upgrade your Rails app, check out our <a href="https://fastruby.io">Ruby on Rails
upgrade</a> service: <a href="https://fastruby.io">FastRuby.io</a></p>
]]></content:encoded>
      <dc:date>2018-03-06T05:53:00-05:00</dc:date>
    </item>
    <item>
      <title>Upgrading a Huge Monolith from Rails 4.0 to Rails 5.1</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/case-study/upgrading-a-monolith.html</link>
      <description><![CDATA[We recently collaborated with Power Home Remodeling on a Rails upgrade for their self-described “monolith CRM/ERP application” and were able to speak to them about their experience with Ombu Labs.
]]></description>
      <pubDate>Fri, 16 Feb 2018 00:00:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/case-study/upgrading-a-monolith.html</guid>
      <content:encoded><![CDATA[<p>We recently collaborated with <a href="https://powerhrg.com">Power Home Remodeling</a> on a <a href="https://fastruby.io">Rails upgrade</a> for their self-described “monolith CRM/ERP application” and were able to speak to them about their experience with <a href="https://www.ombulabs.com">Ombu Labs</a>.</p>

<!--more-->

<p>We talked to <a href="https://www.linkedin.com/in/benlangfeld/">Ben Langfeld</a>, Application Solutions Architect at <a href="https://powerhrg.com">Power Home Remodeling</a>, about the work on their app, Nitro. According to Ben, their monolithic CRM/ERP application is continuously built by a team of approximately 50 developers, system administrators, testers and support staff. The application contains <em>over 500,000 lines of Ruby on Rails and Javascript code</em>, and by their own definition, is one of the most complex Rails applications out there in terms of scope.</p>

<p>Like many companies, <a href="https://powerhrg.com">Power Home Remodeling</a> was having <strong>difficulty allocating developer attention to the <a href="https://fastruby.io">Rails upgrade</a> project</strong> due to the demands of feature work coming from other areas of the business. That is why they decided to come to <a href="https://www.ombulabs.com">Ombu Labs</a> for help.</p>

<p>Nitro is a <a href="http://shageman.github.io/cbra.info/">Component-Based Rails Application</a>. CBRA is an approach which organizes Rails applications into Ruby Gems and Rails Engines. By using this approach, they&#39;re able to parallelize their test suite, therefore making CI faster, and reducing merge conflicts due to the large size of their team. Also, they are able to onboard new developers faster by having the ability to separate them into teams based on gems/engines instead of having them work their way through the entire codebase. For more information about CBRA, check out this video: &quot;<a href="https://www.youtube.com/watch?v=tkL9On9HVHQ">Scaling Your Rails App Codebase with CBRA - Ben Klang</a>&quot;.</p>

<p>We executed a <strong>full upgrade of the application from Rails 4.0 to 5.1</strong> and prepared the company for an eventual <a href="http://weblog.rubyonrails.org/2017/11/27/Rails-5-2-Active-Storage-Redis-Cache-Store-HTTP2-Early-Hints-Credentials/">5.2</a> upgrade. This necessary upgrade of their application led to a “reduction of risk in terms of repeat bugfix/feature development work compared to what is available in a more modern stack”.</p>

<p>According to Ben, “Ombu augmented our in-house team with a specific capacity for the upgrade project, <strong>enabling our other developers to retain focus on direct business goals</strong>.” <a href="https://www.ombulabs.com">Ombu Labs</a>&#39; exclusive focus on the Rails upgrade allowed the developers at <a href="https://powerhrg.com">Power Home Remodeling</a> to continue their work on features and other goals without distractions. In the end, <a href="https://powerhrg.com">Power Home Remodeling</a> received an application with up-to-date Rails versions and was able to make progress on their other work as well.</p>

<p>For more information about upgrading your Rails application, check out our &quot;<a href="https://www.ombulabs.com/blog/tags/upgrades">Upgrade Rails Series</a>&quot;, a series of do-it-yourself guides to upgrading Rails.</p>
]]></content:encoded>
      <dc:date>2018-02-16T00:00:00-05:00</dc:date>
    </item>
    <item>
      <title>Cleaning up: ActiveRecord::Dirty 5.2 API Changes</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/active-record-5-1-api-changes.html</link>
      <description><![CDATA[With the release of Rails 5.2 just around the corner
(Rails 5.2 RC1 is already available!),
we will be taking a look at some of the upcoming changes to the ActiveRecord::Dirty
module. If you&#39;re running Rails 5.1, you may have already seen some of the
deprecation warnings related to the API changes contained in it. Most of them
are behavior changes, and there are some new additions as well.

To better understand these modifications, we&#39;ll take a look at sample projects
in Rails 5.1 and Rails 5.2.
]]></description>
      <pubDate>Wed, 14 Feb 2018 05:20:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/active-record-5-1-api-changes.html</guid>
      <content:encoded><![CDATA[<p>With the release of Rails 5.2 just around the corner
(<a href="https://rubygems.org/gems/rails/versions/5.2.0.rc1">Rails 5.2 RC1</a> is already available!),
we will be taking a look at some of the upcoming changes to the <code>ActiveRecord::Dirty</code>
module. If you&#39;re running Rails 5.1, you may have already seen some of the
deprecation warnings related to the API changes contained in it. Most of them
are behavior changes, and there are some new additions as well.</p>

<p>To better understand these modifications, we&#39;ll take a look at sample projects
in Rails 5.1 and Rails 5.2.</p>

<!--more-->

<h2>Previous behavior</h2>

<p>Notice the deprecation warnings we get when calling <code>email_changed?</code>, <code>changed?</code>,
<code>changes</code> and <code>previous_changes</code> in Rails 5.1 from within an <code>after_save</code> callback:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">010</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span>
 <span class="o">=&gt;</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">011</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">save</span>

<span class="ss">From</span><span class="p">:</span> <span class="sr">/Users/m</span><span class="n">auro</span><span class="o">-</span><span class="n">oto</span><span class="o">/</span><span class="no">Projects</span><span class="o">/</span><span class="n">rails51test</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">user</span><span class="o">.</span><span class="n">rb</span> <span class="err">@</span> <span class="n">line</span> <span class="mi">2</span> <span class="p">:</span>

    <span class="mi">1</span><span class="p">:</span> <span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
 <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">:</span>   <span class="n">after_save</span> <span class="p">{</span> <span class="nb">binding</span><span class="o">.</span><span class="n">pry</span> <span class="p">}</span>
    <span class="mi">3</span><span class="p">:</span> <span class="k">end</span>

<span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; email_changed?</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`attribute_changed?`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_change_to_attribute?`</span> <span class="n">instead</span><span class="o">.</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; changed?</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`changed?`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_changes?`</span> <span class="n">instead</span><span class="o">.</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`changed_attributes`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_changes.transform_values(&amp;:first)`</span> <span class="n">instead</span><span class="o">.</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; changes</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`changed_attributes`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_changes.transform_values(&amp;:first)`</span> <span class="n">instead</span><span class="o">.</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`changes`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_changes`</span> <span class="n">instead</span><span class="o">.</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`changed`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_changes.keys`</span> <span class="n">instead</span><span class="o">.</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`attribute_change`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_change_to_attribute`</span> <span class="n">instead</span><span class="o">.</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`attribute_changed?`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_change_to_attribute?`</span> <span class="n">instead</span><span class="o">.</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`attribute_change`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_change_to_attribute`</span> <span class="n">instead</span><span class="o">.</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`attribute_changed?`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">will</span> <span class="n">be</span> <span class="n">changing</span> <span class="k">in</span> <span class="n">the</span> <span class="k">next</span> <span class="n">version</span> <span class="n">of</span> <span class="no">Rails</span><span class="o">.</span> <span class="no">The</span> <span class="kp">new</span> <span class="k">return</span> <span class="n">value</span> <span class="n">will</span> <span class="n">reflect</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">calling</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">after</span> <span class="sb">`save`</span> <span class="n">returned</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">of</span> <span class="n">what</span> <span class="n">it</span> <span class="n">returns</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span> <span class="no">To</span> <span class="n">maintain</span> <span class="n">the</span> <span class="n">current</span> <span class="n">behavior</span><span class="p">,</span> <span class="n">use</span> <span class="sb">`saved_change_to_attribute?`</span> <span class="n">instead</span><span class="o">.</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;john@doe.org&quot;</span><span class="p">,</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span><span class="o">]</span><span class="p">}</span>
<span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; previous_changes</span>
<span class="no">DEPRECATION</span> <span class="ss">WARNING</span><span class="p">:</span> <span class="no">The</span> <span class="n">behavior</span> <span class="n">of</span> <span class="sb">`previous_changes`</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">after</span> <span class="n">callbacks</span> <span class="n">is</span>
<span class="n">deprecated</span> <span class="n">without</span> <span class="n">replacement</span><span class="o">.</span> <span class="no">In</span> <span class="n">the</span> <span class="k">next</span> <span class="n">release</span> <span class="n">of</span> <span class="no">Rails</span><span class="p">,</span>
<span class="n">this</span> <span class="nb">method</span> <span class="n">inside</span> <span class="n">of</span> <span class="sb">`after_save`</span> <span class="n">will</span> <span class="k">return</span> <span class="n">the</span> <span class="n">changes</span> <span class="n">that</span>
<span class="n">were</span> <span class="n">just</span> <span class="n">saved</span><span class="o">.</span>
<span class="o">=&gt;</span> <span class="p">{}</span>
<span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; saved_change_to_email?</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">[</span><span class="mi">6</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; saved_change_to_email</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;john@doe.org&quot;</span><span class="p">,</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span><span class="o">]</span>
<span class="o">[</span><span class="mi">7</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; email_before_last_save</span>
<span class="o">=&gt;</span> <span class="s2">&quot;john@doe.org&quot;</span>
</code></pre></div>
<p>The last three methods&#39; behavior remains unchanged between Rails 5.1 and
Rails 5.2, but the first four emit those warning messages, and their behavior
changes between these two versions. These changes are best explained in <a href="https://github.com/rails/rails/commit/16ae3db5a5c6a08383b974ae6c96faac5b4a3c81">this commit</a>,
and the best aspect of it in my opinion is explicitness.</p>

<p>It reduces the ambiguity of simply using <code>changed?</code>, which would return <code>true</code>
when the object was dirty, not yet saved to the database (within <code>before_save</code>),
and <code>true</code> after the object was saved to the database (within <code>after_save</code>).</p>

<p>The second case will <em>no longer</em> be <code>true</code>, but rather <code>false</code>. To reduce
ambiguity now, you can use the more explicit <code>saved_changes?</code> method to ask
whether the object has been changed and if its changes were saved to the database.</p>

<h2>New behavior</h2>

<p>A developer&#39;s intentions will become more clear with the behavior changes
introduced in Rails 5.2:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">003</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span>
 <span class="o">=&gt;</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">004</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">save</span>

<span class="ss">From</span><span class="p">:</span> <span class="sr">/Users/m</span><span class="n">auro</span><span class="o">-</span><span class="n">oto</span><span class="o">/</span><span class="no">Projects</span><span class="o">/</span><span class="n">rails52test</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">user</span><span class="o">.</span><span class="n">rb</span> <span class="err">@</span> <span class="n">line</span> <span class="mi">2</span> <span class="p">:</span>

    <span class="mi">1</span><span class="p">:</span> <span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
 <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">:</span>   <span class="n">after_save</span> <span class="p">{</span> <span class="nb">binding</span><span class="o">.</span><span class="n">pry</span> <span class="p">}</span>
    <span class="mi">3</span><span class="p">:</span> <span class="k">end</span>

<span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; email_changed?</span>
<span class="o">=&gt;</span> <span class="kp">false</span>
<span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; changed?</span>
<span class="o">=&gt;</span> <span class="kp">false</span>
<span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; changes</span>
<span class="o">=&gt;</span> <span class="p">{}</span>
<span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; previous_changes</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="s2">&quot;email&quot;</span><span class="o">=&gt;[</span><span class="s2">&quot;john@doe.org&quot;</span><span class="p">,</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span><span class="o">]</span><span class="p">}</span>
<span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; saved_change_to_email?</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">[</span><span class="mi">6</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; saved_change_to_email</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;john@doe.org&quot;</span><span class="p">,</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span><span class="o">]</span>
<span class="o">[</span><span class="mi">7</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="c1">#&lt;User&gt;)&gt; email_before_last_save</span>
<span class="o">=&gt;</span> <span class="s2">&quot;john@doe.org&quot;</span>
</code></pre></div>
<p><code>attribute_changed?</code> and <code>changed?</code> remain the same when called within a
<code>before_save</code> callback. However, the Rails core team has also introduced a set
of methods which can help further reduce the potential ambiguity of <code>changed?</code>
before saving to the database: <code>will_save_change_to_attribute?</code> and
<code>has_changes_to_save?</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">016</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span>
 <span class="o">=&gt;</span> <span class="s2">&quot;mauro@ombulabs.com&quot;</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">017</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">has_changes_to_save?</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">01</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">will_save_change_to_email?</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">01</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">save</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">020</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">will_save_change_to_email?</span>
 <span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">021</span> <span class="o">&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">has_changes_to_save?</span>
 <span class="o">=&gt;</span> <span class="kp">false</span>
</code></pre></div>
<p>In conclusion, if you use these methods and are planning to migrate to Rails 5.2
or even 5.1, you should take these changes into account:</p>

<h3>Must do:</h3>

<p>After modifying an object and after saving to the database, or within <code>after_save</code>:</p>

<ul>
<li><code>attribute_changed?</code> should now be <code>saved_change_to_attribute?</code></li>
<li><code>changed?</code> should now be <code>saved_changes?</code></li>
<li><code>changes</code> should now be <code>saved_changes</code></li>
<li><code>previous_changes</code> has no replacement, since the behavior for it changes.</li>
</ul>

<h3>Optional (less ambiguity, more readable, but longer):</h3>

<p>After modifying an object and before saving to the database, or within <code>before_save</code>:</p>

<ul>
<li><code>attribute_changed?</code> should now be <code>will_save_change_to_attribute?</code></li>
<li><code>changed?</code> should now be <code>has_changes_to_save?</code></li>
<li><code>changes</code> should now be <code>changes_to_save</code></li>
</ul>

<p>If you or your team lack the time to do the upgrade, you can get in touch with
us at <a href="https://fastruby.io">FastRuby.io</a> and we can help you!</p>
]]></content:encoded>
      <dc:date>2018-02-14T05:20:00-05:00</dc:date>
    </item>
    <item>
      <title>Upgrade Rails from 4.1 to 4.2</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-4-1-to-4-2.html</link>
      <description><![CDATA[This article is part of our Upgrade Rails series. To see more of them, click here.

This article will cover the most important aspects that you need to know to get
your Ruby on Rails application from version 4.1 to 4.2.
]]></description>
      <pubDate>Fri, 02 Feb 2018 06:32:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-4-1-to-4-2.html</guid>
      <content:encoded><![CDATA[<p><em>This article is part of our Upgrade Rails series. To see more of them, <a href="https://www.ombulabs.com/blog/tags/upgrades">click here</a></em>.</p>

<p>This article will cover the most important aspects that you need to know to get
your <a href="http://rubyonrails.org/">Ruby on Rails</a> application from <a href="http://guides.rubyonrails.org/4_1_release_notes.html">version 4.1</a> to <a href="http://guides.rubyonrails.org/4_2_release_notes.html">4.2</a>.</p>

<!--more-->

<ol>
<li><a href="#ruby-version">Ruby version</a></li>
<li><a href="#gems">Gems</a></li>
<li><a href="#config-files">Config files (config/)</a></li>
<li><a href="#application-code">Application code</a>

<ol>
<li><a href="#active-record">ActiveRecord</a></li>
<li><a href="#action-mailer">ActionMailer</a></li>
</ol></li>
<li><a href="#miscellaneous">Miscellaneous</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>

<h2 id="ruby-version">1. Ruby version</h2>

<p>Rails 4.2 requires Ruby 1.9.3 or later, and Ruby 2.0 (or newer) is preferred
according to the <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#ruby-versions">official upgrade guide</a>.</p>

<h2 id="gems">2. Gems</h2>

<p>If you&#39;re using <a href="https://relishapp.com/rspec/rspec-core/v/2-14/docs/">RSpec 2</a>,
you&#39;ll need to migrate to <a href="https://relishapp.com/rspec/rspec-core/v/3-7/docs">RSpec 3</a>,
since RSpec 2 doesn&#39;t officially support Rails 4.2. To make this process easier,
you can update to <a href="https://rubygems.org/gems/rspec/versions/2.99.0">RSpec 2.99</a>,
which will print a bunch of deprecation warnings at the end of the test run,
and you&#39;ll need to fix these before updating to RSpec 3. For more information,
check out their <a href="http://rspec.info/upgrading-from-rspec-2/">official upgrade guide</a>.</p>

<p>You can also use the awesome <a href="http://yujinakayama.me/transpec/">Transpec</a> to
automate the RSpec 2 to 3 upgrade process.</p>

<p>Once you&#39;re on Rails 4.2, you will be able to remove the <a href="https://github.com/travisjeffery/timecop"><code>Timecop</code></a>
gem if you&#39;re using it, and replace it with new test helper methods <code>travel</code>,
<code>travel_to</code> and <code>travel_back</code>. See: <a href="http://api.rubyonrails.org/classes/ActiveSupport/Testing/TimeHelpers.html">TimeHelpers</a></p>

<h2 id="config-files">3. Config files</h2>

<p>Rails includes the <code>rails:update</code> <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#the-update-task">task</a>.
You can use this task as a guideline as explained thoroughly in
<a href="http://thomasleecopeland.com/2015/08/06/running-rails-update.html">this post</a>.</p>

<p>As an alternative, check out <a href="http://railsdiff.org/4.1.16/4.2.10">RailsDiff</a>,
which provides an overview of the changes in a basic Rails app between 4.1.x and
4.2.x (or any other source/target versions).</p>

<p>After upgrading to <a href="https://rubygems.org/gems/rails/versions/4.2.9">Rails 4.2</a> for
an application that needs to run in development on port 80, I came across an
unexpected problem due to <a href="https://github.com/rack/rack/commit/28b014484a8ac0bbb388e7eaeeef159598ec64fc">a change in Rack</a>.
Rails now listens on <code>localhost</code> instead of <code>0.0.0.0</code>. You will run into the
same problem in case you need to access your Rails server from a different
machine. To work around it, you need to start your server by binding to
<code>0.0.0.0</code> by using:</p>

<p><code>rails server -b 0.0.0.0 -p 80</code></p>

<p>Alternatively, you can try the <a href="https://stackoverflow.com/a/33249657/2754597">solution here</a>
to avoid providing <code>-b 0.0.0.0</code> when you start the server. If you&#39;re using
<a href="https://github.com/ddollar/foreman">Foreman</a> and run into this problem, you can
edit your <code>Procfile</code>&#39;s <code>web</code> entry so that it reads:</p>

<p><code>web: bundle exec rails s -b 0.0.0.0</code></p>

<h2 id="application-code">4. Application code</h2>

<p><h3 id="active-record">a. ActiveRecord</h2></p>

<ul>
<li>ActiveRecord &lt;= 4.2 suppresses exceptions raised in the <code>after_commit</code> and
<code>after_rollback</code> callbacks by default. They are rescued and printed on the log,
and they don&#39;t propagate. You can opt into raising these exceptions now by
adding the following configuration:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">config</span><span class="o">.</span><span class="n">active_record</span><span class="o">.</span><span class="n">raise_in_transactional_callbacks</span> <span class="o">=</span> <span class="kp">true</span>
</code></pre></div>
<p>Starting from ActiveRecord 5.0, these exceptions are always raised regardless
of this setting, so you <em>should</em> opt into it and update your code accordingly.</p>

<p>See: <a href="https://github.com/rails/rails/pull/16537">https://github.com/rails/rails/pull/16537</a></p>

<ul>
<li>If you pass an object to <code>#find</code>, you will now run into the following
deprecation warning:</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>DEPRECATION WARNING: You are passing an instance of ActiveRecord::Base to `find`.
Please pass the id of the object by calling `.id`.
</code></pre></div>
<p>You will need to change your <code>.find</code> calls to pass an id instead of an object.</p>

<p>Before:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Comment</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Comment</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">comment</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</code></pre></div>
<p>The same goes for <code>#exists?</code> calls, if you pass an object as a parameter for it,
you will need to provide an id instead.</p>

<p><h3 id="action-mailer">b. ActionMailer</h2></p>

<ul>
<li><code>deliver</code> and <code>deliver!</code> are deprecated, in favor of <code>deliver_now</code> and
<code>deliver_now!</code>.</li>
</ul>

<p>Before:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">NotificationMailer</span><span class="o">.</span><span class="n">daily_summary</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">deliver</span>
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">NotificationMailer</span><span class="o">.</span><span class="n">daily_summary</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
</code></pre></div>
<h2 id="miscellaneous">5. Miscellaneous</h2>

<ul>
<li><code>respond_with</code> and the class-level <code>respond_to</code> were removed from Rails 4.2
and moved to the <a href="https://rubygems.org/gems/responders"><code>responders</code></a> gem.</li>
</ul>

<p>If you&#39;re using these in your controllers, you will need to add:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;responders&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 2.0&#39;</span>
</code></pre></div>
<p>to your <code>Gemfile</code>.</p>

<ul>
<li>Rails&#39; HTML sanitizer was rewritten to use the more secure <a href="https://rubygems.org/gems/loofah">Loofah</a>
gem. As a result, your expected sanitized output might be slightly different for
some inputs. If you experience problems with it, you can restore the behavior by
adding:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;rails-deprecated_sanitizer&#39;</span>
</code></pre></div>
<p>to your <code>Gemfile</code>. It will only be supported for Rails 4.2, so it&#39;s
recommended that you <em>do not</em> do this and stick with the new default HTML
sanitizer.</p>

<h2 id="next-steps">6. Next steps</h2>

<p>If you successfully followed all of these steps, you should now be running Rails 4.2! Do you have any other useful tips or recommendations? Share them with us in the comments section.</p>

<p>If you don&#39;t have the time to upgrade your Rails app, check out our <a href="https://fastruby.io">Ruby on Rails
upgrade</a> service: <a href="https://fastruby.io">FastRuby.io</a></p>
]]></content:encoded>
      <dc:date>2018-02-02T06:32:00-05:00</dc:date>
    </item>
    <item>
      <title>Trial and Error with Ruby Koans</title>
      <link>https://www.ombulabs.com/blog/ruby/learning/trial-and-error-with-ruby-koans.html</link>
      <description><![CDATA[After reading introductory primers and watching instructional videos for beginners learning Ruby, I needed a program that would allow me to test out Ruby concepts for myself. I began practicing Ruby Koans, a testing-based program that runs through a variety of Ruby concepts in a trial and error fashion.
]]></description>
      <pubDate>Wed, 24 Jan 2018 00:00:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/ruby/learning/trial-and-error-with-ruby-koans.html</guid>
      <content:encoded><![CDATA[<p>After reading introductory primers and watching instructional videos for beginners learning <a href="https://www.ruby-lang.org/en">Ruby</a>, I needed a program that would allow me to test out Ruby concepts for myself. I began practicing <a href="http://rubykoans.com"><strong>Ruby Koans</strong></a>, <strong>a testing-based program that runs through a variety of Ruby concepts in a trial and error fashion</strong>.</p>

<!--more-->

<p>Instead of providing problems and requiring that the user figure out the answers, the Koans provide answers to various tests and, using <em>assert_equal</em>, require the user to fill in the blanks and correct the code until the program runs without errors.</p>

<p>The first exercises run through Ruby concepts including <strong><a href="https://github.com/ercohen14/ruby-koans/blob/master/about_strings.rb">strings</a></strong>, <strong><a href="https://github.com/ercohen14/ruby-koans/blob/master/about_arrays.rb">arrays</a></strong> and <strong><a href="https://github.com/ercohen14/ruby-koans/blob/master/about_methods.rb">methods</a></strong>.</p>

<p>The exercise <a href="https://github.com/ercohen14/ruby-koans/blob/master/about_objects.rb">About Objects</a> was particularly useful for me as a Junior Developer. I had heard time and again that <a href="https://launchschool.com/books/oo_ruby/read/the_object_model"><em>&quot;in Ruby, everything is an object”</em></a>, however I didn’t understand what <em>“being an object”</em> actually entailed. This exercise went through what it means to be an object, specifying that although many items are objects, no two objects are ever exactly the same.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>def test_clone_creates_a_different_object
  obj = Object.new
  copy = obj.clone

  assert_equal true, obj           != copy
  assert_equal true, obj.object_id != copy.object_id
end
</code></pre></div>
<p>After the Ruby concept exercises, the Koans culminate in a series of projects that allow the user to apply what they have learned about each concept to complete more complex exercises. One that proved useful to me was the <a href="https://github.com/ercohen14/ruby-koans/blob/master/about_triangle_project.rb">About Triangle Project</a>.</p>

<p>This exercise gives the user side lengths of three different triangles, and asks the user to write code to test whether each triangle is equilateral, isosceles or scalene.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>  class AboutTriangleProject &lt; Neo::Koan
    def test_equilateral_triangles_have_equal_sides
      assert_equal :equilateral, triangle(2, 2, 2)
      assert_equal :equilateral, triangle(10, 10, 10)
    end

    def test_isosceles_triangles_have_exactly_two_sides_equal
      assert_equal :isosceles, triangle(3, 4, 4)
      assert_equal :isosceles, triangle(4, 3, 4)
      assert_equal :isosceles, triangle(4, 4, 3)
      assert_equal :isosceles, triangle(10, 10, 2)
    end

    def test_scalene_triangles_have_no_equal_sides
      assert_equal :scalene, triangle(3, 4, 5)
      assert_equal :scalene, triangle(10, 11, 12)
      assert_equal :scalene, triangle(5, 4, 2)
    end
  end
</code></pre></div>
<p>The answer combines a number of basic <a href="https://en.wikibooks.org/wiki/Ruby_Programming/Syntax/Operators">Ruby operators</a>, including ==, &amp;&amp; and ||, and is a simple exercise to begin thinking about the ways that Ruby can solve more complex problems.</p>

<p><strong>I would highly recommend Ruby Koans</strong> to any developer who has some knowledge of Ruby and test-driven development and is looking to learn more.</p>

<p>In our Junior Developer Training Path at OmbuLabs, we typically complete the Ruby Koans after reading a Ruby primer book, such as <a href="https://www.manning.com/books/the-well-grounded-rubyist-second-edition">The Well-Grounded Rubyist</a>, to get an understanding of the fundamentals of Ruby. What steps did you take to learn to code? Do you have a great Junior Developer Training Path to recommend? Let us know!</p>
]]></content:encoded>
      <dc:date>2018-01-24T00:00:00-05:00</dc:date>
    </item>
    <item>
      <title>Upgrade Rails from 4.0 to 4.1</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-4-0-to-4-1.html</link>
      <description><![CDATA[This article is part of our Upgrade Rails series. To see more of them, click here.

This article will cover the most important aspects that you need to know to get
your Ruby on Rails application from version 4.0 to 4.1.
]]></description>
      <pubDate>Wed, 06 Dec 2017 11:31:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-4-0-to-4-1.html</guid>
      <content:encoded><![CDATA[<p><em>This article is part of our Upgrade Rails series. To see more of them, <a href="https://www.ombulabs.com/blog/tags/upgrades">click here</a></em>.</p>

<p>This article will cover the most important aspects that you need to know to get
your <a href="http://rubyonrails.org/">Ruby on Rails</a> application from <a href="http://guides.rubyonrails.org/4_0_release_notes.html">version 4.0</a> to <a href="http://guides.rubyonrails.org/4_1_release_notes.html">4.1</a>.</p>

<!--more-->

<ol>
<li><a href="#ruby-version">Ruby version</a></li>
<li><a href="#gems">Gems</a></li>
<li><a href="#config-files">Config files (config/)</a></li>
<li><a href="#application-code">Application code</a>

<ol>
<li><a href="#callbacks">Callbacks</a></li>
<li><a href="#active-record">ActiveRecord</a></li>
</ol></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#miscellaneous">Miscellaneous</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>

<h2 id="ruby-version">1. Ruby version</h2>

<p>Rails 4.1 requires Ruby 1.9.3 or later. Ruby 1.8.7 support was dropped in
Rails 4.0, so you should already be running 1.9.3 or later. For Rails 4.1,
Ruby 2.0 (or newer) is preferred according to the <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#ruby-versions">official upgrade guide</a>.</p>

<h2 id="gems">2. Gems</h2>

<p>If your application relies on <a href="https://github.com/intridea/multi_json"><code>MultiJSON</code></a>,
you will need to add the gem to your <code>Gemfile</code> (<code>gem &#39;multi_json&#39;</code>) if it&#39;s not
already there, since it was removed from Rails 4.1.</p>

<p>Alternatively, stop using MultiJSON and migrate your application to use
<code>to_json</code> and <code>JSON.parse</code>.</p>

<h2 id="config-files">3. Config files</h2>

<p>Rails includes the <code>rails:update</code> <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#the-update-task">task</a>.
You can use this task as a guideline as explained thoroughly in
<a href="http://thomasleecopeland.com/2015/08/06/running-rails-update.html">this post</a>.</p>

<p>As an alternative, check out <a href="http://railsdiff.org/4.0.13/4.1.16">RailsDiff</a>,
which provides an overview of the changes in a basic Rails app between 4.0 and
4.1 (or any other source/target versions).</p>

<h2 id="application-code">4. Application code</h2>

<p><h3 id="callbacks">a. Callbacks</h2></p>

<ul>
<li>Return from callbacks is no longer allowed:</li>
</ul>

<p>Before:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>before_save { return false }
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>before_save { false }
</code></pre></div>
<p>See: <a href="https://github.com/rails/rails/pull/13271">https://github.com/rails/rails/pull/13271</a></p>

<p><h3 id="active-record">b. ActiveRecord</h2></p>

<ul>
<li>Removal of deprecated finders:</li>
</ul>

<p><code>activerecord-deprecated_finders</code> (https://github.com/rails/activerecord-deprecated_finders)
was removed as a dependency from Rails 4.1. From the gem&#39;s README:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>To migrate dynamic finders to Rails 4.1+:

find_all_by_... should become where(...).
find_last_by_... should become where(...).last.
scoped_by_... should become where(...).
find_or_initialize_by_... should become find_or_initialize_by(...).
find_or_create_by_... should become find_or_create_by(...).
</code></pre></div>
<p>If you can&#39;t afford to upgrade the finders now, then add the gem back yourself
into the <code>Gemfile</code>:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>gem &#39;activerecord-deprecated_finders&#39;
</code></pre></div>
<p>See our <a href="https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-3-2-to-4-0.html">last upgrade post</a> for more information.</p>

<ul>
<li>Default scopes are now chained to other scopes:</li>
</ul>

<p>If you thought default scopes on models could be confusing, there&#39;s even another
(un?)expected twist to it:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>class User &lt; ActiveRecord::Base
  default_scope { where active: true }
  scope :inactive, -&gt; { where active: false }

  # ...
end

# Rails &lt; 4.1
&gt; User.all
SELECT &quot;users&quot;.* FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;active&quot; = &#39;true&#39;

&gt; User.inactive
SELECT &quot;users&quot;.* FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;active&quot; = &#39;false&#39;

# Rails &gt;= 4.1:

&gt; User.all
SELECT &quot;users&quot;.* FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;active&quot; = &#39;true&#39;

&gt; User.inactive
SELECT &quot;users&quot;.* FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;active&quot; = &#39;true&#39;
AND &quot;users&quot;.&quot;active&quot; = &#39;false&#39;
</code></pre></div>
<p>If you depended on this behavior, you will need to work around it using
<code>unscoped</code>, <code>unscope</code> or the new <code>rewhere</code> method (<a href="https://github.com/rails/rails/commit/f950b2699f97749ef706c6939a84dfc85f0b05f2">source</a>)</p>

<p>(Friendly reminder: beware when using <a href="https://www.ombulabs.com/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html">default_scope</a>)</p>

<ul>
<li>No more mutable methods on ActiveRecord relations:</li>
</ul>

<p><code>ActiveRecord::Relation</code> no longer has access to mutator methods like <code>#map!</code>,
<code>#delete_if</code> or <code>#compact!</code>. If you need to use them, you will need to convert
the <code>Relation</code> to an <code>Array</code> by calling <code>#to_a</code> first.</p>

<p>Before:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Project.where(title: &#39;Rails Upgrade&#39;).compact!
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>projects = Project.where(name: &#39;Rails Upgrade&#39;).to_a
projects.compact!
</code></pre></div>
<ul>
<li>Implicit joins are removed:</li>
</ul>

<p>Before Rails 4.1, if you had this code:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Post.includes(:comments).where(&quot;comments.title = &#39;foo&#39;&quot;)
</code></pre></div>
<p>ActiveRecord 4.0 would know to join <code>posts</code> and <code>comments</code> in the executed SQL,
and it would work just fine.</p>

<p>However, Rails shouldn&#39;t have to be smart and parse your <code>where</code> with a regular
expression to figure out what tables you want to join, since it leads to
bugs (for example: <a href="https://github.com/rails/rails/issues/9712">https://github.com/rails/rails/issues/9712</a>).</p>

<p>To fix this problem, you need to use an explicit join:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Post.joins(:comments).where(&quot;comments.title = &#39;foo&#39;&quot;)
</code></pre></div>
<p>Unless your intention was to actually eager load the post&#39;s comments.
In that case, you can use the following syntax:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Post.eager_load(:comments).where(&quot;comments.title = &#39;foo&#39;&quot;)
</code></pre></div>
<p>Or:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Post.includes(:comments).where(&quot;comments.title = &#39;foo&#39;&quot;).references(:comments)
</code></pre></div>
<p>Both are equivalent and produce the same SQL.</p>

<p>For a more in depth explanation of the differences between <code>joins</code>, <code>includes</code>,
<code>references</code>, <code>eager_load</code> and even <code>preload</code>, <a href="http://blog.ifyouseewendy.com/blog/2015/11/11/preload-eager_load-includes-references-joins/">check out this post</a>.</p>

<p>Finally, if you get this deprecation warning:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>DEPRECATION WARNING: Implicit join references were removed with Rails 4.1. Make sure to remove this configuration because it does nothing.
</code></pre></div>
<p>Just remove <code>config.active_record.disable_implicit_join_references</code> from your
config files.</p>

<h2 id="tests">5. Tests</h2>

<ul>
<li><a href="http://guides.rubyonrails.org/security.html#cross-site-request-forgery-csrf">CSRF protection</a> now covers GET requests with JS responses:</li>
</ul>

<p>If your tests hit JS URLs, you&#39;ll need to use <code>xhr</code> instead of <code>get</code>:</p>

<p>Before:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>post :create, format: :js
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>xhr :post, :create, format: :js
</code></pre></div>
<p>See: <a href="https://github.com/rails/rails/pull/13345">https://github.com/rails/rails/pull/13345</a></p>

<h2 id="miscellaneous">6. Miscellaneous</h2>

<ul>
<li>Flash message keys are strings now:</li>
</ul>

<p>If you were using the <code>flash</code> hash or its keys and expected symbols,
you will need to use strings now:</p>

<p>Before:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>flash.to_hash.except(:notify)
</code></pre></div>
<p>After:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>flash.to_hash.except(&quot;notify&quot;)
</code></pre></div>
<h2 id="next-steps">7. Next steps</h2>

<p>If you successfully followed all of these steps, you should now be running Rails 4.1! Do you have any other tips? Share it with us in the comments section.</p>

<p>If you don&#39;t have the time to upgrade your Rails app, check out our <a href="https://fastruby.io">Ruby on Rails
upgrade</a> service: <a href="https://fastruby.io">FastRuby.io</a></p>
]]></content:encoded>
      <dc:date>2017-12-06T11:31:00-05:00</dc:date>
    </item>
    <item>
      <title>Setup Monit notifications on Slack</title>
      <link>https://www.ombulabs.com/blog/monit/slack/setup-monit-notifications-on-slack.html</link>
      <description><![CDATA[Monit is a powerful tool for monitoring processes on Unix systems and sometimes it can be very useful to receive notifications about a specific process from your server to your everyday tool, Slack. This article will show you exactly how to do that.
]]></description>
      <pubDate>Wed, 15 Nov 2017 04:45:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/monit/slack/setup-monit-notifications-on-slack.html</guid>
      <content:encoded><![CDATA[<p><a href="https://mmonit.com/monit/">Monit</a> is a powerful tool for monitoring processes on <a href="https://en.wikipedia.org/wiki/Unix">Unix</a> systems and sometimes it can be very useful to receive notifications about a specific process from your server to your everyday tool, <a href="https://slack.com/">Slack</a>. This article will show you exactly how to do that.</p>

<!--more-->

<p>In the examples we are using a <a href="https://en.wikipedia.org/wiki/Linux">Linux</a> environment running <a href="https://www.ubuntu.com/">Ubuntu</a> <code>16.04</code>.
Also the process that we will be monitoring is <a href="https://projects.eclipse.org/projects/technology.mosquitto">Mosquitto</a>, but you can monitor any process just by changing the configuration.</p>

<h3>Setup Slack</h3>

<p>As a first step you need to create a new <a href="https://api.slack.com/incoming-webhooks">Incoming WebHook</a>. You can do that by going to <code>https://my.slack.com/services/new/incoming-webhook</code>, select or create a channel, and then click on <code>Add incoming WebHooks Integration</code>. Then you will see a <code>Webhook URL</code> that should be similar to this: <code>https://hooks.slack.com/services/T7W3HFJSO/B7XLPmQAZ/aviXjd5cKdzvzUjfWbCn8oEqr</code>. You will need that URL in the next step.</p>

<p>The second part requires you to create a <a href="https://en.wikipedia.org/wiki/Bash_(Unix_shell)"> Bash </a> script that will post Slack messages when you run it.
This is an example of how this file should look like:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>URL=&quot;https://hooks.slack.com/services/T7W3HFJSO/B7XLPmQAZ/aviXjd5cKdzvzUjfWbCn8oEqr&quot; # Slack Webhook URL

PAYLOAD=&quot;{
  \&quot;attachments\&quot;: [
    {
      \&quot;title\&quot;: \&quot;$PROCESS was restarted\&quot;,
      \&quot;color\&quot;: \&quot;warning\&quot;,
      \&quot;mrkdwn_in\&quot;: [\&quot;text\&quot;],
      \&quot;fields\&quot;: [
        { \&quot;title\&quot;: \&quot;Date\&quot;, \&quot;value\&quot;: \&quot;$MONIT_DATE\&quot;, \&quot;short\&quot;: true },
        { \&quot;title\&quot;: \&quot;Host\&quot;, \&quot;value\&quot;: \&quot;$MONIT_HOST\&quot;, \&quot;short\&quot;: true }
      ]
    }
  ]
}&quot;

curl -s -X POST --data-urlencode &quot;payload=$PAYLOAD&quot; $URL
</code></pre></div>
<p>If you want to see how to customize the Slack messages you can take a look at the <a href="https://api.slack.com/incoming-webhooks#sending_messages">official documentation</a>.</p>

<p>Before running the script we should add some permissions (I saved it as <code>slack-webhook.sh</code> in <code>/usr/local/bin/</code>)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ sudo chmod u+x /usr/local/bin/slack-webhook.sh
</code></pre></div>
<p>Now let&#39;s run it to see if it&#39;s working</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ /usr/local/bin/slack-webhook.sh
</code></pre></div>
<p>If correct, you will see the message in your Slack channel.</p>

<p><img src="/blog/assets/images/monit-message.png" alt="Monit message"></p>

<p>It looks a bit empty because we didn&#39;t set any variables for the message to use (e.g. <code>$PROCESS</code>).</p>

<h3>Setup Monit</h3>

<p>You can see if you already have installed Monit by running</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ monit --version
This is Monit version 5.16
</code></pre></div>
<p>If not you can install it with
<code>
$ sudo apt install monit -y
</code></p>

<p>Now that you have Monit installed, you can add the configuration for your process on <code>/etc/monit/conf.d</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>check process mosquitto with pidfile /var/run/mosquitto.pid
  start program = &quot;/etc/init.d/mosquitto start&quot;
  stop program = &quot;/etc/init.d/mosquitto stop&quot;

  if changed pid then exec &quot;/bin/bash -c &#39;PROCESS=Mosquitto /usr/local/bin/slack-webhook.sh&#39;&quot;
  if 1 restart within 1 cycle then exec &quot;/bin/bash -c &#39;PROCESS=Mosquitto /usr/local/bin/slack-webhook.sh&#39;&quot;
</code></pre></div>
<p>This configuration will restart the process in case you stop it manually or if it gets stopped by itself. And when that happens it will call the <code>slack-webhook</code> script to publish a message in the Slack channel.
You can see a bunch of real-world configuration examples on <a href="https://mmonit.com/wiki/Monit/ConfigurationExamples">this link</a>.</p>

<p>Don&#39;t forget to restart Monit after you make changes in the configuration.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ monit reload
Reinitializing monit daemon
</code></pre></div>
<p>You can easily test this by manually killing the process.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ ps aux | grep mosquitto
mosquit+ 23073  0.0  0.2  44200  4916 ?        S    19:48   0:00 /usr/sbin/mosquitto -c /etc/mosquitto/mosquitto.conf

$ kill -9 23073
</code></pre></div>
<p>The process will be automatically restarted after a couple of seconds and you will receive a message in your Slack channel.</p>

<p><img src="/blog/assets/images/monit-message-2.png" alt="Monit message"></p>

<p>This is just one type of message that you can implement in your Slack team, but you can also do some cooler things with Monit, like sending reports or alerts. You just need to change the configuration files based on that.</p>
]]></content:encoded>
      <dc:date>2017-11-15T04:45:00-05:00</dc:date>
    </item>
    <item>
      <title>Upgrade Rails from 3.2 to 4.0</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-3-2-to-4-0.html</link>
      <description><![CDATA[This article is part of our Upgrade Rails series. To see more of them, click here.

A previous post
covered some general tips to take into account for this migration. This article
will try to go a bit more in depth. We will first go from 3.2 to 4.0, then to
4.1 and finally to 4.2. Depending on the complexity of your app, a Rails upgrade
can take anywhere from one week for a single developer, to a few months for two
developers.
]]></description>
      <pubDate>Wed, 08 Nov 2017 07:42:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/upgrade-rails-from-3-2-to-4-0.html</guid>
      <content:encoded><![CDATA[<p><em>This article is part of our Upgrade Rails series. To see more of them, <a href="https://www.ombulabs.com/blog/tags/upgrades">click here</a></em>.</p>

<p>A <a href="https://www.ombulabs.com/blog/rails/tips-for-upgrading-rails-3-2-to-4.html">previous post</a>
covered some general tips to take into account for this migration. This article
will try to go a bit more in depth. We will first go from 3.2 to 4.0, then to
4.1 and finally to 4.2. Depending on the complexity of your app, a Rails upgrade
can take anywhere from one week for a single developer, to a few months for two
developers.</p>

<!--more-->

<ol>
<li><a href="#ruby-version">Ruby version</a></li>
<li><a href="#gems">Gems</a></li>
<li><a href="#config-files">Config files (config/)</a></li>
<li><a href="#application-code">Application code</a>

<ol>
<li><a href="#models">Models (app/models/)</a></li>
<li><a href="#controllers">Controllers (app/controllers/)</a></li>
</ol></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#miscellaneous">Miscellaneous</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>

<h2 id="ruby-version">1. Ruby version</h2>

<p>Rails 3.2.x is the last version to support Ruby 1.8.7. If you&#39;re using Ruby 1.8.7,
you&#39;ll need to upgrade to Ruby 1.9.3 or newer. The Ruby upgrade is not covered
in this guide, but check out <a href="http://www.darkridge.com/%7Ejpr5/2012/10/03/ruby-1.8.7-1.9.3-migration">this guide</a> for more details on that.</p>

<h2 id="gems">2. Gems</h2>

<p>You can add the aptly named <a href="https://github.com/alindeman/rails4_upgrade">rails4_upgrade gem</a>
to your Rails 3 project&#39;s Gemfile and find gems which you&#39;ll need to update:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>➜  myproject git:(develop) ✗ bundle exec rake rails4:check

** GEM COMPATIBILITY CHECK **
+------------------------------------------+----------------------------+
| Dependency Path                          | Rails Requirement          |
+------------------------------------------+----------------------------+
| devise 2.1.4                             | railties ~&gt; 3.1            |
| devise-encryptable 0.2.0 -&gt; devise 2.1.4 | railties ~&gt; 3.1            |
| friendly_id 4.0.10.1                     | activerecord &lt; 4.0, &gt;= 3.0 |
| strong_parameters 0.2.3                  | actionpack ~&gt; 3.0          |
| strong_parameters 0.2.3                  | activemodel ~&gt; 3.0         |
| strong_parameters 0.2.3                  | activesupport ~&gt; 3.0       |
| strong_parameters 0.2.3                  | railties ~&gt; 3.0            |
+------------------------------------------+----------------------------+
</code></pre></div>
<p>Instead of going through your currently bundled gems or <code>Gemfile.lock</code> manually,
you get a report of the gems you need to upgrade.</p>

<h2 id="config-files">3. Config files</h2>

<p>Rails includes the <code>rails:update</code> <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#the-update-task">task</a>.
You can use this task as a guideline as explained thoroughly in
<a href="http://thomasleecopeland.com/2015/08/06/running-rails-update.html">this post</a>.
It will help you get rid of unnecessary code or monkey-patches in your config
files and initializers, specially if your Rails 3 app was running on Rails 2.</p>

<p>As an alternative, check out <a href="http://railsdiff.org/3.2.22.5/4.0.13">RailsDiff</a>,
which provides an overview of the changes in a basic Rails app between 3.2 and
4.0 (or any other source/target versions).</p>

<p>If you&#39;re feeling adventurous, you
can give <a href="https://github.com/bsodmike/upgrade_rails_3.2.12_to_4.0.0.beta1">this script</a>
a try. It attempts to apply <a href="https://github.com/bsodmike/upgrade_rails_3.2.12_to_4.0.0.beta1/blob/master/upgrade/upgrade.patch">this git patch</a>
(similar to the patch shown on RailsDiff) to your Rails app to migrate from 3.2
to 4.0. However, I don&#39;t recommend this for complex or mature apps, as there
will be plenty of conflicts.</p>

<h2 id="application-code">4. Application code</h2>

<h2 id="models">a. Models</h2>

<ul>
<li>All dynamic finder methods except for <code>.find_by_...</code> are deprecated:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># before:</span>
<span class="no">Authentication</span><span class="o">.</span><span class="n">find_all_by_provider_and_uid</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>

<span class="c1"># after:</span>
<span class="no">Authentication</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">provider</span><span class="p">:</span> <span class="n">provider</span><span class="p">,</span> <span class="ss">uid</span><span class="p">:</span> <span class="n">uid</span><span class="p">)</span>
</code></pre></div>
<p>You can regain usage of these finders by adding the gem
<a href="https://github.com/rails/activerecord-deprecated_finders">activerecord-deprecated_finders</a></p>

<ul>
<li>ActiveRecord scopes now need a lambda:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># before:</span>
<span class="n">default_scope</span> <span class="n">where</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>

<span class="c1"># after:</span>
<span class="n">default_scope</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span> <span class="p">}</span>

<span class="c1"># before:</span>
<span class="n">has_many</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">order</span><span class="p">:</span> <span class="s1">&#39;position&#39;</span>

<span class="c1"># after:</span>
<span class="n">has_many</span> <span class="ss">:posts</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
<p>(Friendly reminder: beware when using <a href="https://www.ombulabs.com/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html">default_scope</a>)</p>

<ul>
<li>Protected attributes is deprecated, but you can still add the <a href="https://github.com/rails/protected_attributes">protected_attributes</a> gem.
However, since the Rails core team dropped its support since Rails 5.0, you
should begin migrating your models to <a href="http://guides.rubyonrails.org/action_controller_overview.html#strong-parameters">Strong Parameters</a> anyway.</li>
</ul>

<p>To do so, you will need to remove calls to <code>attr_accessible</code> from your models,
and add a new method to your model&#39;s controller with a name like <code>user_params</code>
or <code>your_model_params</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">user_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Finally, change (most) references to <code>params[:user]</code> to <code>user_params</code> in your
controller&#39;s actions. If the reference is for an update or a creation, like
<code>user.update_attributes(params[:user])</code>, change it to <code>user.update_attributes(user_params)</code>.
This new method permits using the <code>name</code> and <code>email</code> attributes of the user
model and disallows writing any other attribute the user model may have (like <code>id</code>).</p>

<ul>
<li>ActiveRecord Observers were removed from the Rails 4.0 codebase and extracted
into a gem. You can regain usage by adding the gem to your Gemfile:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;rails-observers&#39;</span> <span class="c1"># https://github.com/rails/rails-observers</span>
</code></pre></div>
<p>As an alternative, you can take a look at the <a href="https://github.com/krisleech/wisper">wisper gem</a>,
or Rails&#39; Concerns (which were added in Rails 4.0) for a slightly different
approach.</p>

<ul>
<li>ActiveResource was removed and extracted into its own gem:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;active_resource&#39;</span> <span class="c1"># https://github.com/rails/activeresource</span>
</code></pre></div>
<h2 id="controllers">b. Controllers</h2>

<ul>
<li>ActionController Sweeper was extracted into the <code>rails-observers</code> gem, you can
regain usage by adding the gem to your Gemfile:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;rails-observers&#39;</span> <span class="c1"># https://github.com/rails/rails-observers</span>
</code></pre></div>
<ul>
<li>Action caching was extracted into its own gem, so if you&#39;re using this feature
through either:</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">caches_page</span>   <span class="ss">:public</span>
</code></pre></div>
<p>or:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">caches_action</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span>
</code></pre></div>
<p>You will need to add the gem:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;actionpack-action_caching&#39;</span> <span class="c1"># https://github.com/rails/actionpack-action_caching</span>
</code></pre></div>
<h2 id="tests">5. Tests</h2>

<p>From Ruby 1.9.x onwards, you have to include the <a href="https://rubygems.org/gems/test-unit"><code>test-unit</code> gem</a>
in your Gemfile as it was removed from the standard lib. As an alternative,
migrate to <code>Minitest</code>, <code>RSpec</code> or your favorite test framework.</p>

<h2 id="miscellaneous">6. Miscellaneous</h2>

<ul>
<li>Routes now require you to specify the request method, so you no longer can
rely on the catch-all default.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># change:</span>
<span class="n">match</span> <span class="s1">&#39;/home&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;home#index&#39;</span>

<span class="c1"># to:</span>
<span class="n">match</span> <span class="s1">&#39;/home&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;home#index&#39;</span><span class="p">,</span> <span class="ss">via</span><span class="p">:</span> <span class="ss">:get</span>

<span class="c1"># or:</span>
<span class="n">get</span> <span class="s1">&#39;/home&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;home#index&#39;</span>
</code></pre></div>
<ul>
<li>Rails 4.0 dropped support for plugins, so you&#39;ll need to replace them with gems,
either by searching for the project on <a href="https://rubygems.org">RubyGems</a>/<a href="https://github.com">Github</a>,
or by moving the plugin to your <code>lib</code> directory and require it from somewhere
within your Rails app.</li>
</ul>

<h2 id="next-steps">7. Next steps</h2>

<p>If you successfully followed all of these steps, by now you should be running Rails 4.0!</p>

<p>To fine-tune your app, check out <a href="https://fastruby.io">FastRuby.io</a>, and feel
free to tell us how your upgrade went.</p>
]]></content:encoded>
      <dc:date>2017-11-08T07:42:00-05:00</dc:date>
    </item>
    <item>
      <title>Upgrade Rails from 3.1 to 3.2</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/upgrade-to-rails-3-2.html</link>
      <description><![CDATA[This is the third article of our Upgrade Rails series. We will be covering the most important aspects that you need to know to update your Ruby on Rails application from version 3.1 to 3.2.
]]></description>
      <pubDate>Tue, 07 Nov 2017 04:30:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/upgrade-to-rails-3-2.html</guid>
      <content:encoded><![CDATA[<p>This is the third article of our <a href="https://www.ombulabs.com/blog/tags/upgrades">Upgrade Rails series</a>. We will be covering the most important aspects that you need to know to update your <a href="http://rubyonrails.org/">Ruby on Rails</a> application from <a href="http://guides.rubyonrails.org/3_1_release_notes.html">version 3.1</a> to <a href="http://guides.rubyonrails.org/3_2_release_notes.html">3.2</a>.</p>

<!--more-->

<ol>
<li><a href="#considerations">Considerations</a></li>
<li><a href="#ruby-version">Ruby version</a></li>
<li><a href="#tools">Tools</a></li>
<li><a href="#config-files">Config files</a></li>
<li><a href="#gemfile">Gemfile</a></li>
<li><a href="#deprecations">Deprecations</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>

<h2 id="considerations">1. Considerations</h2>

<p>Before beginning with the upgrade process, we recommend that each version of your Rails app has the latest <a href="http://semver.org">patch version</a> before moving to the next major/minor version. For example, in order to follow this article, your <a href="https://rubygems.org/gems/rails/versions">Rails version</a> should be at 3.1.12 before updating to Rails 3.2.22</p>

<h2 id="ruby-version">2. Ruby version</h2>

<p>Depending on which patch version of Rails 3.2 you are using, the <a href="https://www.ruby-lang.org/en/downloads/releases/">Ruby versions</a> that you can use will change. Since we recommend you to always use the latest patch version, we will focus this article on <a href="http://weblog.rubyonrails.org/2015/6/16/Rails-3-2-22-4-1-11-and-4-2-2-have-been-released-and-more/">Rails 3.2.22</a>. The minor Ruby version that you can use is <a href="https://www.ruby-lang.org/en/news/2008/05/31/ruby-1-8-7-has-been-released">1.8.7</a>, and the latest one is <a href="https://www.ruby-lang.org/en/news/2014/12/25/ruby-2-2-0-released/">2.2</a>. As always, we recommend you to use the latest version to avoid any bugs or vulnerabilities.</p>

<h2 id="tools">3. Tools</h2>

<p>Rails 3.2 comes with a <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#the-update-task">generator</a> that helps you to update the configuration files. The <code>rake rails:update</code> generator will identify every configuration file in your application that differs from a new Rails application. When it detects a conflict, it will offer to overwrite your file. Keep in mind that many of your files will be different because you’ve made changes from a default new Rails application. When the generator offers to overwrite a file, enter a <code>d</code> in order to review the differences.</p>

<p>Sometimes it&#39;s also useful to check which files changed between two specific versions of Rails. Fortunately <a href="http://railsdiff.org/3.1.12/3.2.22.5">Rails Diff</a> makes that easy.</p>

<h2 id="config-files">4. Config files</h2>

<p>There are a few settings that you need to add to your environment filters</p>

<ul>
<li>Add to <code>config/environments/development.rb</code></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Raise exception on mass assignment protection for Active Record models
config.active_record.mass_assignment_sanitizer = :strict

# Log the query plan for queries taking more than this (works
# with SQLite, MySQL, and PostgreSQL)
config.active_record.auto_explain_threshold_in_seconds = 0.5
</code></pre></div>
<ul>
<li>Add to <code>config/environments/test.rb</code></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Raise exception on mass assignment protection for Active Record models
config.active_record.mass_assignment_sanitizer = :strict
</code></pre></div>
<h2 id="gemfile">5. Gemfile</h2>

<ul>
<li>You should update a couple of gems inside your assets group</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>gem &quot;rails&quot;, &quot;~&gt; 3.2.0&quot;

group :assets do
  gem &#39;sass-rails&#39;,   &#39;~&gt; 3.2.6&#39;
  gem &#39;coffee-rails&#39;, &#39;~&gt; 3.2.2&#39;
  gem &#39;uglifier&#39;,     &#39;&gt;= 1.0.3&#39;
end
</code></pre></div>
<h2 id="deprecations">6. Deprecations</h2>

<p>Rails 3.2 deprecates <code>vendor/plugins</code>, and it&#39;s the last Rails version that support it. If your plan is to migrate to Rails 4 in the future, you can start replacing any plugins by extracting them to gems and adding them to your <code>Gemfile</code>, or you can move them into <code>lib/my_plugin/*</code>. We cover this topic in depth in our Rails 4.0 upgrade guide.</p>

<h2 id="next-steps">7. Next steps</h2>

<p>After you get your application properly running in Rails 3.2, you will probably want to keep working on this Rails upgrade journey. So don&#39;t forget to check our complete <a href="https://www.ombulabs.com/blog/tags/upgrades">Rails upgrade series</a> to make that easy.</p>
]]></content:encoded>
      <dc:date>2017-11-07T04:30:00-05:00</dc:date>
    </item>
    <item>
      <title>Upgrade Rails from 3.0 to 3.1</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/upgrade-to-rails-3-1.html</link>
      <description><![CDATA[This is the second article of our Upgrade Rails series. We will be covering the most important aspects that you need to know to update your Ruby on Rails application from version 3.0 to 3.1. If you are in an older version, you can take a look at our previous article.
]]></description>
      <pubDate>Mon, 16 Oct 2017 05:30:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/upgrade-to-rails-3-1.html</guid>
      <content:encoded><![CDATA[<p>This is the second article of our <a href="https://www.ombulabs.com/blog/tags/upgrades">Upgrade Rails series</a>. We will be covering the most important aspects that you need to know to update your <a href="http://rubyonrails.org/">Ruby on Rails</a> application from <a href="http://guides.rubyonrails.org/3_0_release_notes.html">version 3.0</a> to <a href="http://guides.rubyonrails.org/3_1_release_notes.html">3.1</a>. If you are in an older version, you can take a look at our <a href="https://www.ombulabs.com/blog/rails/upgrades/upgrade-to-rails-3.html">previous article</a>.</p>

<!--more-->

<ol>
<li><a href="#considerations">Considerations</a></li>
<li><a href="#ruby-version">Ruby version</a></li>
<li><a href="#tools">Tools</a></li>
<li><a href="#config-files">Config files</a></li>
<li><a href="#jquery">jQuery</a></li>
<li><a href="#asset_pipeline">Asset Pipeline</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>

<h2 id="considerations">1. Considerations</h2>

<p>Before beginning with the upgrade process, we recommend that each version of your Rails app has the latest <a href="http://semver.org">patch version</a> before moving to the next major/minor version. For example, in order to follow this article, your <a href="https://rubygems.org/gems/rails/versions">Rails version</a> should be at 3.0.20 before updating to Rails 3.1.12</p>

<h2 id="ruby-version">2. Ruby version</h2>

<p>Rails 3.1 requires Ruby <a href="https://www.ruby-lang.org/en/news/2008/05/31/ruby-1-8-7-has-been-released">1.8.7</a> or higher, but no more than <a href="https://www.ruby-lang.org/en/news/2011/10/31/ruby-1-9-3-p0-is-released">1.9.3</a>. If you want to use Ruby 1.9.x, we recommend you skip directly to 1.9.3. Also Ruby <a href="https://www.ruby-lang.org/en/news/2009/01/30/ruby-1-9-1-released">1.9.1</a> is not usable because it has segmentation faults on Rails 3.1. That means that the compatible <a href="https://www.ruby-lang.org/en/downloads/releases/">Ruby versions</a> for Rails 3.1 are 1.8.7, <a href="https://www.ruby-lang.org/en/news/2010/08/18/ruby-1-9-2-released">1.9.2</a>, or 1.9.3. Keep in mind that the next Rails version (3.2) will be the last one that supports Ruby 1.8.7 and 1.9.2.</p>

<h2 id="tools">3. Tools</h2>

<p>Rails 3.1 comes with a generator that helps the upgrade process. You just need to run <code>rake rails:update</code> to see a <a href="https://gist.github.com/ryanb/1101906">guide</a> that details how to upgrade your application.</p>

<p>Sometimes it&#39;s also useful to check which files changed between two specific versions of Rails. Fortunately <a href="http://railsdiff.org/3.0.20/3.1.12">Rails Diff</a> makes that easy.</p>

<h2 id="config-files">4. Config files</h2>

<ul>
<li>You should <strong>remove</strong> any references to <code>ActionView::Base.debug_rjs</code> in your project.</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># (config/environments/development.rb)

config.action_view.debug_rjs = true
</code></pre></div>
<ul>
<li>If you want to wrap parameters into a nested hash add a <code>config/initializers/wrap_parameters.rb</code> file with the following contents. This file comes by default in new applications.</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Be sure to restart your server when you modify this file.
# This file contains settings for ActionController::ParamsWrapper which
# is enabled by default.

# Enable parameter wrapping for JSON. You can disable this by setting :format to an empty array.
ActiveSupport.on_load(:action_controller) do
  wrap_parameters :format =&gt; [:json]
end

# Disable root element in JSON by default.
ActiveSupport.on_load(:active_record) do
  self.include_root_in_json = false
end
</code></pre></div>
<h2 id="jquery">5. jQuery</h2>

<p><a href="https://jquery.com/">jQuery</a> is the default JavaScript library that comes with Rails 3.1.</p>

<p>To add this you need to include the <a href="https://github.com/rails/jquery-rails">jquery-rails</a> gem in your <a href="https://bundler.io/gemfile.html">Gemfile</a></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>gem &#39;jquery-rails&#39;
</code></pre></div>
<p>And then include the libraries in your <code>app/assets/javascripts/application.js</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>//= require jquery
//= require jquery_ujs
</code></pre></div>
<p>So now you can get rid of your jQuery assets like <code>jquery.js</code> or <code>jquery.min.js</code>.</p>

<h2 id="asset_pipeline">6. Asset Pipeline</h2>

<p><a href="http://guides.rubyonrails.org/asset_pipeline.html">Asset Pipeline</a> is an optional feature in Rails 3.1, but we recommend to include it to take advantage of it. In order to do that, you should apply the following changes:</p>

<ul>
<li>Add to your <code>Gemfile</code>:</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>group :assets do
  gem &#39;sass-rails&#39;,   &quot;~&gt; 3.1.5&quot;
  gem &#39;coffee-rails&#39;, &quot;~&gt; 3.1.1&quot;
  gem &#39;uglifier&#39;,     &quot;&gt;= 1.0.3&quot;
end
</code></pre></div>
<ul>
<li>Update your <code>config/application.rb</code></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>config.assets.enabled = true
config.assets.version = &#39;1.0&#39;

# Defaults to &#39;/assets&#39;
config.assets.prefix = &#39;/asset-files&#39;
</code></pre></div>
<ul>
<li>Update your <code>config/environments/development.rb</code></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Do not compress assets
config.assets.compress = false

# Expands the lines which load the assets
config.assets.debug = true
</code></pre></div>
<ul>
<li>Update your <code>config/environments/production.rb</code></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Compress JavaScripts and CSS
config.assets.compress = true

# Don&#39;t fallback to assets pipeline if a precompiled asset is missed
config.assets.compile = false

# Generate digests for assets URLs
config.assets.digest = true

# Defaults to Rails.root.join(&quot;public/assets&quot;)
# config.assets.manifest = YOUR_PATH

# Precompile additional assets (application.js, application.css, and all non-JS/CSS are already added)
# config.assets.precompile = %w( admin.js admin.css )
</code></pre></div>
<ul>
<li>Update your <code>config/environments/test.rb</code></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Configure static asset server for tests with Cache-Control for performance
config.serve_static_assets = true
config.static_cache_control = &quot;public, max-age=3600&quot;
</code></pre></div>
<h2 id="next-steps">7. Next steps</h2>

<p>After you get your application properly running in Rails 3.1, you will probably want to keep working on this Rails upgrade journey. So don&#39;t forget to check our complete <a href="https://www.ombulabs.com/blog/tags/upgrades">Rails upgrade series</a> to make that easy.</p>
]]></content:encoded>
      <dc:date>2017-10-16T05:30:00-04:00</dc:date>
    </item>
    <item>
      <title>Upgrade Rails from 2.3 to 3.0</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/upgrade-to-rails-3.html</link>
      <description><![CDATA[This article is the first of our Upgrade Rails series. We will be covering the most important aspects that you need to know to update your Ruby on Rails application from version 2.3 to 3.0.
]]></description>
      <pubDate>Mon, 28 Aug 2017 12:06:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/upgrade-to-rails-3.html</guid>
      <content:encoded><![CDATA[<p>This article is the first of our <a href="https://www.ombulabs.com/blog/tags/upgrades">Upgrade Rails series</a>. We will be covering the most important aspects that you need to know to update your <a href="http://rubyonrails.org">Ruby on Rails</a> application from <a href="http://guides.rubyonrails.org/2_3_release_notes.html">version 2.3</a> to <a href="http://guides.rubyonrails.org/3_0_release_notes.html">3.0</a>.</p>

<!--more-->

<ol>
<li><a href="#considerations">Considerations</a></li>
<li><a href="#ruby-version">Ruby version</a></li>
<li><a href="#tools">Tools</a></li>
<li><a href="#xss-protection">XSS protection</a></li>
<li><a href="#config-files">Config files</a></li>
<li><a href="#gems">Gems</a></li>
<li><a href="#deprecations">Deprecations</a>

<ul>
<li><a href="#active-record">Active Record</a></li>
<li><a href="#action-mailer">Action Mailer</a></li>
<li><a href="#metal">Metal</a></li>
<li><a href="#railties">Railties</a></li>
</ul></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>

<h2 id="considerations">1. Considerations</h2>

<p>Before beginning with the upgrade process, we recommend that each version of your Rails app has the latest <a href="http://semver.org">patch version</a> before moving to the next major/minor version. For example, in order to follow this article, your <a href="https://rubygems.org/gems/rails/versions">Rails version</a> should be at 2.3.18 before updating to Rails 3.0.20</p>

<h2 id="ruby-version">2. Ruby version</h2>

<p>Rails 3.0 requires Ruby <a href="https://www.ruby-lang.org/en/news/2008/05/31/ruby-1-8-7-has-been-released">1.8.7</a> or higher, but no more than <a href="https://www.ruby-lang.org/en/news/2011/10/31/ruby-1-9-3-p0-is-released">1.9.3</a>. If you want to use Ruby 1.9.x, we recommend you skip directly to 1.9.3. Also Ruby <a href="https://www.ruby-lang.org/en/news/2009/01/30/ruby-1-9-1-released">1.9.1</a> is not usable because it has segmentation faults on Rails 3.0. That means that the compatible <a href="https://www.ruby-lang.org/en/downloads/releases/">Ruby versions</a> for Rails 3.0 are 1.8.7, <a href="https://www.ruby-lang.org/en/news/2010/08/18/ruby-1-9-2-released">1.9.2</a>, or 1.9.3.</p>

<h2 id="tools">3. Tools</h2>

<p>There is an <a href="https://github.com/rails/rails_upgrade">official plugin</a> that helps the upgrade process. You just need to install the script by doing <code>script/plugin install git://github.com/rails/rails_upgrade.git</code> and then run <code>rake rails:upgrade:check</code> to see most of the files you need to upgrade in your application. It also provides some other generators to upgrade specific areas in you app like routes or gems.</p>

<p>Sometimes it&#39;s also useful to check which files changed between two specifics versions of Rails. Fortunately <a href="http://railsdiff.org/2.3.18/3.0.0">Rails Diff</a> makes that easy.</p>

<h2 id="xss-protection">4. XSS protection</h2>

<p>In this version, Rails automatically adds <a href="http://yehudakatz.com/2010/02/01/safebuffers-and-rails-3-0/">XSS protection</a> in order to escape any content, so you will probably need to update your templates according to this. Luckily there is an <a href="https://github.com/rails/rails_xss">official plugin</a> for this. We recommend you take a look at this.</p>

<h2 id="config-files">5. Config files</h2>

<p>Rails 3 introduces the concept of an Application object. An application object holds all the specific application configurations and it&#39;s similar to the current config/environment.rb from Rails 2.3. The application object is defined in config/application.rb. You should move there most of the configuration that you had in config/environment.rb.</p>

<p>In terms of routes, there are a couple of changes that you need to apply to your routes.rb file. For example:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Rails 2.3 way:
ActionController::Routing::Routes.draw do |map|
  map.resources :products
end

# Rails 3.0 way:
AppName::Application.routes do
  resources :products
end
</code></pre></div>
<p>You can go to <a href="https://blog.engineyard.com/2010/the-lowdown-on-routes-in-rails-3">this article</a> to read an in-depth article about this topic.</p>

<h2 id="gems">6. Gems</h2>

<p><a href="https://bundler.io/">Bundler</a> is the default way to manage Gem dependencies in Rails 3 applications. You will need to add a <a href="https://bundler.io/v1.15/gemfile_man.html">Gemfile</a> in the root of your app, define all you gems there, and then get rid of the config.gem statements.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Before:
config.gem &#39;aws-sdk&#39;,  :version =&gt; &#39;1.0.0&#39; # (config/environment.rb)

config.gem &#39;pry&#39;, :version =&gt; [&#39;&gt;= 0.6.0&#39;, &#39;&lt; 0.7.0&#39;] # (config/development.rb)

# Now:
(Gemfile)

gem &#39;aws-sdk&#39;, &#39;1.0.0&#39;

group :development do
  gem &#39;pry&#39;, &#39;~&gt; 0.6.0&#39;
end
</code></pre></div>
<p>Remember that if you installed the plugin mentioned in step 3, you can run <code>rake rails:upgrade:gems</code>. This task will extract your config.gem calls and generate code that you can put in your Gemfile.</p>

<h2 id="deprecations">6. Deprecations</h2>

<p>There are a bunch of deprecations that happen during this version:</p>

<h3 id="active-record">Active Record</h3>

<ul>
<li><p>The method to define a named scope is now called <code>scope</code> instead of <code>named_scope</code>.</p></li>
<li><p>In scope methods, you no longer pass the conditions as a hash:</p></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Before:
named_scope :active, :conditions =&gt; [&quot;active = ?&quot;, true]

# Now:
scope :active, where(&quot;active = ?&quot;, true)
</code></pre></div>
<ul>
<li><p><code>save(false)</code> is deprecated, so you should use <code>save(:validate =&gt; false)</code>.</p></li>
<li><p>I18n error messages for Active Record should be changed from <code>:en.activerecord.errors.template</code> to <code>:en.errors.template</code>.</p></li>
<li><p><code>model.errors.on</code> is deprecated in favor of <code>model.errors[]</code></p></li>
<li><p>There is a new syntax for presence validations:</p></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Before:
validates_presence_of :email

# Now:
validates :email, presence: true
</code></pre></div>
<ul>
<li><code>ActiveRecord::Base.colorize_logging</code> and <code>config.active_record.colorize_logging</code> are deprecated in favor of <code>Rails::LogSubscriber.colorize_logging</code> or <code>config.colorize_logging</code>.</li>
</ul>

<h3 id="action-mailer">Action Mailer</h3>

<ul>
<li><code>:charset</code>, <code>:content_type</code>, <code>:mime_version</code>, <code>:implicit_parts_order</code> are all deprecated in favor of <code>ActionMailer.default :key =&gt; value</code> style declarations.</li>
<li>Mailer dynamic <code>create_method_name</code> and <code>deliver_method_name</code> are deprecated, just call <code>method_name</code> which now returns a <code>Mail::Message</code> object.</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Before:
message = UserMailer.create_welcome_email(user)
UserMailer.deliver(message)

or

UserMailer.deliver_welcome_email(user)

# Now:
UserMailer.welcome_email(user).deliver
</code></pre></div>
<ul>
<li><code>template_root</code> is deprecated, pass options to a render call inside a proc from the <code>format.mime_type</code> method inside the mail generation block.</li>
<li>The body method to define instance variables is deprecated (<code>body {:ivar =&gt; value}</code>), just declare instance variables in the method directly and they will be available in the view.</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Before:
def welcome_email(user)
  ...
  body {:user =&gt; user, :url =&gt; &quot;https://fastruby.io&quot;}
end

# Now:
def welcome_email(user)
  ...
  @user = user
  @url = &quot;https://fastruby.io&quot;
end
</code></pre></div>
<ul>
<li>Mailers should now be in app/mailers instead of app/models.</li>
</ul>

<h3 id="metal">Metal</h3>

<p>Since Rails 3 is closer to <a href="http://guides.rubyonrails.org/rails_on_rack.html">Rack</a>, the <a href="http://weblog.rubyonrails.org/2008/12/17/introducing-rails-metal/">Metal</a> abstraction is no longer needed.</p>

<p>This is the <a href="https://github.com/rails/rails/commit/ed34652d1aca148fea61c5309c1bd5ff3a55abfa">official explanation</a> of what you need to do to update your existing Metals:</p>

<ul>
<li>If your metal behaves like a middleware, add it to the middleware stack via config.middleware.use. You can use methods on the middleware stack to control exactly where it should go.</li>
<li>If it behaves like a Rack endpoint, you can link to it in the router. This will result in more optimal routing time, and allows you to remove code in your endpoint that matches specific URLs in favor of the more powerful handling in the router itself.</li>
</ul>

<p>For the future, you can use ActionController::Metal to get a very fast controller with the ability to opt-in to specific controller features without paying the penalty of the full controller stack.</p>

<h3 id="railties">Railties</h3>

<p><a href="http://api.rubyonrails.org/classes/Rails/Railtie.html">Railties</a> deprecates the following constants during this version:</p>

<ul>
<li><code>RAILS_ROOT</code> in favor of <code>Rails.root</code></li>
<li><code>RAILS_ENV</code> in favor of <code>Rails.env</code></li>
<li><code>RAILS_DEFAULT_LOGGER</code> in favor of <code>Rails.logger</code></li>
</ul>

<p>Also, <code>PLUGIN/rails/tasks</code> and <code>PLUGIN/tasks</code> are no longer loaded all tasks, now must be in <code>lib/tasks</code>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span># Before:
vendor/plugins/ombulabs_patches/tasks/s3_backup.rake

# Now:
lib/tasks/ombulabs_patches/s3_backup.rake
</code></pre></div>
<h2 id="next-steps">8. Next steps</h2>

<p>After you get your application properly running in Rails 3.0, you will probably want to keep working on this Rails upgrade journey. So don&#39;t forget to check our complete <a href="https://www.ombulabs.com/blog/tags/upgrades">Rails upgrade series</a> to make that easy.</p>
]]></content:encoded>
      <dc:date>2017-08-28T12:06:00-04:00</dc:date>
    </item>
    <item>
      <title>How We Helped Predictable Revenue Scale</title>
      <link>https://www.ombulabs.com/blog/case-study/how-we-helped-predictable-revenue-scale.html</link>
      <description><![CDATA[A few weeks ago I had the opportunity to talk to Preston St. Pierre, CTO of Predictable Revenue. We worked with Preston and his team for 2 years to help them scale their software development.
]]></description>
      <pubDate>Tue, 22 Aug 2017 04:06:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/case-study/how-we-helped-predictable-revenue-scale.html</guid>
      <content:encoded><![CDATA[<p>A few weeks ago I had the opportunity to talk to <a href="https://www.linkedin.com/in/tarential">Preston St. Pierre</a>, CTO of <a href="http://predictablerevenue.com">Predictable Revenue</a>. We worked with Preston and his team for 2 years to help them scale their software development.</p>

<!--more-->

<p><strong>Ernesto:</strong> First of all, thanks for taking the time to talk to me. I have a few questions about our past engagement. Let&#39;s start with this one: <strong>What was the main problem you were having when you hired us?</strong></p>

<p><strong>Preston:</strong> I suppose the main problem was lack of developer hours. We needed somebody that was flexible, on time, that we could hire for more hours or less hours if we had the budget.</p>

<p>But the part that we didn&#39;t realize that we needed was that there was no real structure to our development, being just Francesco and I. We&#39;d discuss the problem, decide what to do, and that was kind of it. You gave us a number of processes and principles that we used to start our growth towards a more traditional organization for engineering. It didn&#39;t affect us much at the time, but it sure helped us later on as we added more developers.</p>

<p><strong>Ernesto:</strong> That&#39;s great to hear. <strong>And how did that impact the business for Predictable Revenue?</strong></p>

<p><strong>Preston:</strong> <a href="https://www.ombulabs.com">Ombu Labs</a> was a significant part of our development team for over two years. You guys were a core part of our team, and therefore you helped shape our product. I couldn&#39;t put a specific number value on the impact or anything, but I definitely would say that your expertise brought a lot to the table and that it positively influenced our system architecture.</p>

<p>For example, using <a href="https://aws.amazon.com/sqs/">Amazon&#39;s SQS</a> to communicate with our sender nodes via message queues; we might have went that way otherwise, but I think that was your idea. I didn&#39;t have that in mind. So it&#39;s possible we could be using that now only because of you.</p>

<p><strong>Ernesto:</strong> That was a very interesting project. Thanks for the kind words! I appreciate that. I actually have a question about that but I&#39;ll leave it for later. You said a little bit about the value we added to the team. <strong>Anything in particular that you valued from working with us?</strong></p>

<p><strong>Preston:</strong> We work with a number of contractors, but the thing that set the really good ones apart was how they, instead of just doing the job they were told to do, they would actually figure out what we needed and try to find ways to solve our problems as though they were members of the team. And that&#39;s exactly what you guys did. Whereas the bad contractors, they would accept the terms that we gave them, and they would give us what we asked for. It was kind of like we were holding their hand the whole time, and it was not really worth it to hire them at that point.</p>

<p>But you guys were much different. You took the initiative to figure out where there were problems, where updates/maintenance were needed, then went out and did the work. That was very useful.</p>

<p><strong>Ernesto:</strong> I think one thing that I valued from our engagement is that  there was value in disagreeing with you every now and then. And not just disagreeing for the sake of disagreeing, but proposing other ideas or other ways to implement a solution, then having a discussion about it, and then presenting the arguments and eventually going with one way or the other.</p>

<p><strong>Preston:</strong> Definitely. And while I can&#39;t guarantee that everybody&#39;s going to appreciate that like I do, I know I&#39;m not always right. Sometimes I needed to be challenged.</p>

<p><strong>Ernesto:</strong> So let&#39;s talk a little about how things were after we ended our engagement, <strong>how did we impact your day-to-day engineering operations?</strong></p>

<p><strong>Preston:</strong> I think it circles back to what I mentioned before, which is that you guys largely helped put in place at least a framework of processes that we were able to build upon later. Kind of sent us in the direction of using some sort of organizational structure to our development as opposed to simply discussing what needed to be done and doing it, which was the previous way we did it. I hesitate to repeat my previous answer, but it&#39;s the only one I can think of.</p>

<p>I should mention, your push for <a href="http://wiki.c2.com/?PairProgramming">pair programming</a> has been very influential on our team. We do a lot of it.</p>

<p><strong>Ernesto:</strong> I&#39;m glad to hear that. We are big fans of pair programming. <strong>How are guys doing it now? Are you doing it like just when it&#39;s needed or do you have scheduled pair programming sessions?</strong></p>

<p><strong>Preston:</strong> We generally do as needed, but also if there&#39;s a special situation where somebody who has knowledge needs to share with somebody who doesn&#39;t. We&#39;ll get them to pair up together while working on a feature just to transfer that knowledge. Additionally, now we have office days. Every Wednesday people come into the office. There is usually a lot of programming going on at that time since we&#39;re all sitting around together anyway.</p>

<p><strong>Ernesto:</strong> Cool. So the last question is quite technical and it&#39;s about the cluster of server nodes we helped implement and if you could tell me a little bit about the problem we were having before that solution.</p>

<p><strong>Preston:</strong> There were two problems, actually. One was that we were connecting to <a href="https://www.google.com/gmail">Gmail</a> from the same IP address for all of our clients and that presented a security risk. If Gmail ever decided to ban us, they could quite easily do so by simply blocking our IP address. Or simply silently routing our messages just to spam or whatever it is they chose to do. So there&#39;s the security aspect. And then there was another more simple aspect, which was throughput. We were sending through Gmail and it imposed a limitation on how many messages you could send per minute by simply holding the connection open. So you had to wait around three seconds per message. Accordingly, the throughput was relatively low. We couldn&#39;t send for all of our clients in the timeframe that we wanted to.</p>

<p><strong>Ernesto:</strong> So what value did we add there in terms of the solution, this cluster of sender nodes?</p>

<p><strong>Preston:</strong> Well, specifically, the problem that you solved that I wouldn&#39;t have had a solution for was that of using queues to communicate between the sender nodes and the API server. The one-way communication from the sender nodes to the API, that would seem pretty easy to make an API call. But the other way, it was like are they going to connect to the database, or how exactly is this going to work? And then of course it made a whole lot of sense if you simply use SQS and they have a separate system waiting with the messages all there.</p>

<p>In retrospect, I should have been looking at it going, &quot;Hey, this is obvious.&quot; But I didn&#39;t have that idea and you guys contributed that.</p>

<p><strong>Ernesto:</strong> It was really cool to work on that. I think it&#39;s one of the coolest projects we worked on in the past three years or so.</p>

<p><strong>Thanks for your time and your feedback! I really appreciate you taking the time to do this.</strong></p>

<p><strong>Preston:</strong> No worries. Hope it helps.</p>
]]></content:encoded>
      <dc:date>2017-08-22T04:06:00-04:00</dc:date>
    </item>
    <item>
      <title>Announcing FastRuby.io</title>
      <link>https://www.ombulabs.com/blog/rails/upgrades/announcing-fastruby-io-productized-rails-upgrades.html</link>
      <description><![CDATA[Today we are happy to announce the launch of our first productized service: fastruby.io - Speedy Ruby on Rails Upgrades by Ombu Labs.

We are quite familiar with this sort of projects and decided to package it under its own domain. We have been doing Ruby on Rails upgrades since 2009, for our own products and client projects, and we are looking forward to shipping more of them.
]]></description>
      <pubDate>Wed, 07 Jun 2017 11:06:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/upgrades/announcing-fastruby-io-productized-rails-upgrades.html</guid>
      <content:encoded><![CDATA[<p>Today we are happy to announce the launch of our first productized service: <a href="https://fastruby.io">fastruby.io</a> - Speedy Ruby on Rails Upgrades by Ombu Labs.</p>

<p>We are quite familiar with this sort of projects and decided to package it under its own domain. We have been doing <a href="http://rubyonrails.org">Ruby on Rails</a> upgrades since 2009, for our <a href="https://www.ombulabs.com/#products">own products</a> and <a href="https://www.ombulabs.com/#clients">client projects</a>, and we are looking forward to shipping more of them.</p>

<!--more-->

<p>If you have been using <a href="http://rubyonrails.org">Rails</a> for a while, you know that big version jumps are hard. If you have a big Rails <a href="https://martinfowler.com/bliki/MonolithFirst.html">monolith</a> with 100+ dependencies, you know that <a href="https://fastruby.io">upgrading Rails</a> is not a trivial project.</p>

<p>You know you need to keep your Rails app <strong>up to date</strong>, but it&#39;s usually <em>not</em> a priority. So you postpone upgrading until your version of Rails is <strong>no longer supported</strong>. Then you upgrade.</p>

<p>More often than not, you start a <a href="https://fastruby.io">Rails upgrade</a> branch, start bumping versions, find problems, troubleshoot them, and eventually get sidetracked by your business. Then you switch to another branch and the <a href="https://fastruby.io">Rails upgrade</a> branch grows stale.</p>

<p>Even the best teams have this problem! (e.g. <a href="http://shayfrendt.com/posts/upgrading-github-to-rails-3-with-zero-downtime/">Github</a>)</p>

<p>That&#39;s why we decided to create <a href="https://fastruby.io">fastruby.io</a>. If you don&#39;t have the time, but you have the budget to do the <strong>Rails Upgrade</strong>, you can <a href="http://fastruby.io/#contact-us">just contact us</a> and <strong>we can help</strong>.</p>
]]></content:encoded>
      <dc:date>2017-06-07T11:06:00-04:00</dc:date>
    </item>
    <item>
      <title>AWS S3 Policies for Carrierwave</title>
      <link>https://www.ombulabs.com/blog/aws/carrierwave/s3/aws-s3-policies-for-carrierwave.html</link>
      <description><![CDATA[When you create IAM credentials and policies for
your app, you should make sure that they have access to the resources that they
need and not more than that!.

This way, if anyone gets access to those credentials, the impact of this leak
is reduced to the resources associated with them (and not all the buckets in
your S3 account)
]]></description>
      <pubDate>Wed, 10 May 2017 05:02:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/aws/carrierwave/s3/aws-s3-policies-for-carrierwave.html</guid>
      <content:encoded><![CDATA[<p>When you create <a href="https://aws.amazon.com/iam/">IAM</a> credentials and policies for
your app, you should make sure that they have access to the resources that they
need <strong>and not more than that!</strong>.</p>

<p>This way, if anyone gets access to those credentials, the impact of this leak
is reduced to the resources associated with them (<strong>and not all the buckets in
your S3 account</strong>)</p>

<!--more-->

<p>If you&#39;re using <a href="https://github.com/carrierwaveuploader/carrierwave">Carrierwave</a>,
you will <em>probably</em> need credentials that have <strong>access</strong> to these buckets:</p>

<ul>
<li>gif-dir-development</li>
<li>gif-dir-test</li>
<li>gif-dir-production</li>
</ul>

<p><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html">Creating a policy for this is <strong>not trivial</strong></a>
using the AWS Administration Panel. If you follow the <a href="https://aws.amazon.com/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/">instructions in the official AWS documentation</a>, you might run into this issue:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>Excon::Error::Socket <span class="o">(</span>Broken pipe <span class="o">(</span>Errno::EPIPE<span class="o">))</span>:
  app/controllers/gifs_controller.rb:64:in <span class="sb">`</span>block in create<span class="s1">&#39;</span>
<span class="s1">  app/controllers/gifs_controller.rb:63:in `create&#39;</span>

  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/actionpack-4.2.6/lib/action_dispatch/middleware/templates/rescues/_source.erb <span class="o">(</span><span class="m">11</span>.7ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/actionpack-4.2.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb <span class="o">(</span><span class="m">5</span>.1ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/actionpack-4.2.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb <span class="o">(</span><span class="m">1</span>.4ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/actionpack-4.2.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout <span class="o">(</span><span class="m">60</span>.9ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/_markup.html.erb <span class="o">(</span><span class="m">0</span>.5ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/_inner_console_markup.html.erb within layouts/inlined_string <span class="o">(</span><span class="m">0</span>.3ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/_prompt_box_markup.html.erb within layouts/inlined_string <span class="o">(</span><span class="m">0</span>.3ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/style.css.erb within layouts/inlined_string <span class="o">(</span><span class="m">0</span>.6ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/console.js.erb within layouts/javascript <span class="o">(</span><span class="m">45</span>.4ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/main.js.erb within layouts/javascript <span class="o">(</span><span class="m">0</span>.7ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/error_page.js.erb within layouts/javascript <span class="o">(</span><span class="m">0</span>.4ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/index.html.erb <span class="o">(</span><span class="m">102</span>.7ms<span class="o">)</span>
</code></pre></div>
<p>The issue is documented in Fog&#39;s <a href="https://github.com/fog/fog/issues/1659">issue #1659</a>.
The problem with the official documentation is that it lists only 4 actions:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
      <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;s3:ListBucket&quot;</span><span class="p">],</span>
      <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;arn:aws:s3:::gif-dir-development&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
      <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
        <span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
        <span class="s2">&quot;s3:DeleteObject&quot;</span>
      <span class="p">],</span>
      <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;arn:aws:s3:::gif-dir-development/*&quot;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>These actions are not enough for <a href="https://github.com/carrierwaveuploader/carrierwave">Carrierwave</a>. You will need
to add the <code>&quot;s3:PutObjectAcl&quot;</code> action to the list. While you are at it, you
should add more buckets to the list of resources:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;s3:ListBucket&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-development&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-test&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-production&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:PutObjectAcl&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:DeleteObject&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-development/*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-test/*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-production/*&quot;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>After you&#39;ve modified the policy&#39;s JSON, you can update it and associate it to
the IAM user using the AWS administration panel.</p>
]]></content:encoded>
      <dc:date>2017-05-10T05:02:00-04:00</dc:date>
    </item>
    <item>
      <title>'Flaky' tests: a short story</title>
      <link>https://www.ombulabs.com/blog/rspec/continuous-integration/how-to-track-down-a-flaky-test.html</link>
      <description><![CDATA[One of the hardest failing tests to debug are those which fail randomly, also
known as &quot;flaky&quot; tests. You write your test cases, you run the tests in your
environment (in random order), and see them all pass. Afterwards, you push your
code, your CI server runs them and one test fails.

This is not an uncommon scenario, and one too common when using integration
tests which use JS, with Capybara-Webkit or Selenium.
But if your failing test doesn&#39;t communicate with an external API, doesn&#39;t use
JS, and passes locally, it can be a bit nerve-wracking.

After you have identified the failing test, and it still passes after running it
locally, one way to figure out why it&#39;s failing is running its context
multiple times.

To automate this process a bit, I like to use the following command:
]]></description>
      <pubDate>Thu, 04 May 2017 07:02:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rspec/continuous-integration/how-to-track-down-a-flaky-test.html</guid>
      <content:encoded><![CDATA[<p>One of the hardest failing tests to debug are those which fail randomly, also
known as <strong>&quot;flaky&quot;</strong> tests. You write your test cases, you run the tests in your
environment (in random order), and see them all pass. Afterwards, you push your
code, your CI server runs them and <em>one test fails</em>.</p>

<p>This is not an uncommon scenario, and one <em>too common</em> when using integration
tests which use JS, with <code>Capybara-Webkit</code> or <code>Selenium</code>.
But if your failing test doesn&#39;t communicate with an external API, doesn&#39;t use
JS, and passes locally, it can be a bit nerve-wracking.</p>

<p>After you have identified the failing test, and it still passes after running it
locally, one way to figure out <strong>why</strong> it&#39;s failing is running its context
multiple times.</p>

<p>To automate this process a bit, I like to use the following command:</p>

<!--more-->
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="k">for</span> i in <span class="o">{</span><span class="m">1</span>..10<span class="o">}</span><span class="p">;</span> <span class="k">do</span> rspec spec/controllers/v7/users_controller_spec.rb:205<span class="p">;</span> <span class="k">done</span>
</code></pre></div>
<p>It will run your test 10 times in a row, and <em>hopefully</em> you might see the
test fail once or twice. RSpec&#39;s feedback should provide some insight into why
the failure occurred. Otherwise, what I like to do before running the command is
add <code>puts</code> statements before the expectations.</p>

<p>If your expectation is:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
</code></pre></div>
<p>a good thing to do would be to change that to:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="nb">puts</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">80</span>
<span class="nb">puts</span> <span class="s2">&quot;actual response: </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nb">puts</span> <span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="mi">80</span>
<span class="nb">puts</span> <span class="s2">&quot;expected response: </span><span class="si">#{</span><span class="n">json</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
</code></pre></div>
<p>(See also: <a href="https://tenderlovemaking.com/2016/02/05/i-am-a-puts-debuggerer.html">I am a puts debuggerer</a>)</p>

<p>Now when your test fails, you&#39;ll be able to see what the contents of the
compared variables were.</p>

<p>In my case, the last time I faced this (which prompted me to write this article),
the test did not fail locally, <em>even after 20 runs</em>. I went back into the CI server,
and noticed the tests&#39; order <em>was not randomized</em>.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="k">for</span> i in <span class="o">{</span><span class="m">1</span>..10<span class="o">}</span><span class="p">;</span> <span class="k">do</span> rspec spec/controllers/v7/users_controller_spec.rb:205 --order defined<span class="p">;</span> <span class="k">done</span>
</code></pre></div>
<p>By adding <code>--order defined</code> I was able to track down the flaky test and fix it.
On one hand, it&#39;s good the CI caught it because the build is always randomized in
my environment, and one day the test suite would &quot;randomly&quot; be in order and fail.
On the other, this made me realize that I needed to update my <code>yml</code> config for
the CI server to <em>randomize the tests</em> by explicitly using <code>--order random</code>.</p>

<p>The <code>--seed 1234</code> option also exists in RSpec, so if your tests in the CI already use
random ordering and you get a flaky test, you can run:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>rspec spec/controllers/v7/users_controller_spec.rb:205 --seed <span class="m">1234</span>
</code></pre></div>
<p>and it will use the seed provided by you, obtained from the failing
test log on the CI server.</p>

<p>Re-running failing tests has been brought up in the <a href="https://github.com/rspec/rspec-core">RSpec repo</a>
<a href="https://github.com/rspec/rspec-core/issues/456">a couple</a>
<a href="https://github.com/rspec/rspec-core/issues/795">of times</a> in the past.
Some alternatives like <a href="https://github.com/oggy/respec">respec</a> exist, but it
might not be worth it to add to a project as it&#39;s not something that happens too
often.</p>

<p>Depending on your CI server, you may also be able to configure re-runs
using your <code>yml</code> config file, in case your flaky tests are persistent. We have
been using <a href="https://ci.solanolabs.com">Solano CI</a> for a while and by using:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span></span><span class="l l-Scalar l-Scalar-Plain">rerun_list</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">spec/benchmarks/controllers/v7/users_controller_spec.rb</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
</code></pre></div>
<p>the test runs at least two more times if it fails on the first run, to ensure
that the entire build doesn&#39;t fail because of <em>that one pesky</em> test.</p>
]]></content:encoded>
      <dc:date>2017-05-04T07:02:00-04:00</dc:date>
    </item>
    <item>
      <title>How to run multiple dependent builds on Circle CI</title>
      <link>https://www.ombulabs.com/blog/continuous-integration/circle-ci/how-to-run-multiple-dependency-builds-on-your-ci-server.html</link>
      <description><![CDATA[We all know the importance of having a CI tool integrated in your project. It allows you to run your entire test suite every time you want to merge a set of changes.
If you have a core project and many projects that depend on it, you want to run the tests for the core project and the dependent projects at the same time. This article explains how you can do it with Circle CI.
]]></description>
      <pubDate>Thu, 23 Feb 2017 10:21:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/continuous-integration/circle-ci/how-to-run-multiple-dependency-builds-on-your-ci-server.html</guid>
      <content:encoded><![CDATA[<p>We all know the importance of having a <a href="https://en.wikipedia.org/wiki/Continuous_integration">CI</a> tool integrated in your project. It allows you to run your entire test suite every time you want to merge a set of changes.
If you have a core project and many projects that depend on it, you want to run the tests for the core project and the dependent projects at the same time. This article explains how you can do it with <a href="https://circleci.com">Circle CI</a>.</p>

<!--more-->

<p>I will explain how to do that with two <a href="http://rubyonrails.org">Rails</a> projects (an application and an <a href="http://guides.rubyonrails.org/engines.html">engine</a>)</p>

<p>In this example we have an app called <code>my-app</code> and an engine called <code>my-gem</code>.
In <code>my-app/Gemfile</code> we should have something like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>gem &#39;my-gem&#39;, git: &#39;git@github.com:ombulabs/my-gem.git&#39;, tag: &#39;1.0.0&#39;
</code></pre></div>
<p>In order to edit the default settings of CircleCI, you need to have a <code>circle.yml</code> file in your project directory. You can check the <a href="https://circleci.com/docs/configuration/">documentation</a> to help you complete each section.</p>

<p>The idea is that every time we push changes to the engine&#39;s repo (<code>my-gem</code>), the CI runs its tests automatically. Afterwards, the CI should also run the tests of the dependent projects (in this example it will be only <code>my-app</code>) pointing to the current branch of <code>my-gem</code>. So, basically we need to apply these steps on the <code>my-gem/circle.yml</code>.</p>

<h3>Clone the dependent project (my-app)</h3>

<p><code>git clone -b develop git@github.com:ombulabs/my-app.git ../my-app</code></p>

<h3>Edit the Gemfile and point my-gem to the current branch</h3>

<p><code>&quot;sed -i \&quot;s@tag.*@branch: &#39;${CIRCLE_BRANCH}&#39;@\&quot; ../my-app/Gemfile&quot;</code></p>

<h3>Setup the project</h3>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>(cd ../my-app &amp;&amp; gem install bundler --no-ri --no-rdoc)
(cd ../my-app &amp;&amp; bundle)
(cd ../my-app &amp;&amp; bundle exec rake db:create db:schema:load)
</code></pre></div>
<h3>Run the tests</h3>

<p><code>(cd ../my-app &amp;&amp; bundle exec rake)</code></p>

<p>The best place to put all of that is after running the main test. So, your <code>circle.yml</code> should look like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>test:
  post:
    - git clone -b develop git@github.com:ombulabs/my-app.git ../my-app
    - &quot;sed -i \&quot;s@tag.*@branch: &#39;${CIRCLE_BRANCH}&#39;@\&quot; ../my-app/Gemfile&quot;
    - (cd ../my-app &amp;&amp; gem install bundler --no-ri --no-rdoc)
    - (cd ../my-app &amp;&amp; bundle)
    - (cd ../my-app &amp;&amp; bundle exec rake db:create db:schema:load)
    - (cd ../my-app &amp;&amp; bundle exec rake)
</code></pre></div>
<p>Obviously, the build will be slower than before because now it&#39;s running two projects inside the same build. But this ensures that your dependent projects won&#39;t crash after updating the references to the gem (engine).</p>
]]></content:encoded>
      <dc:date>2017-02-23T10:21:00-05:00</dc:date>
    </item>
    <item>
      <title>How to test a React app using capybara-webkit</title>
      <link>https://www.ombulabs.com/blog/rails/react/how-to-test-a-react-app-using-capybara-webkit.html</link>
      <description><![CDATA[I have been using the capybara-webkit
gem for a while now since I first tried it out after making the switch from
Capybara + Selenium.

Using capybara-webkit speeds up my Selenium tests due to its headless nature,
and it&#39;s very straightforward. However, I had some trouble testing a
Rails based React app.

In this post, I will explain how I worked around the issues that came up when
trying to use capybara-webkit with React.
]]></description>
      <pubDate>Mon, 13 Feb 2017 05:27:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/react/how-to-test-a-react-app-using-capybara-webkit.html</guid>
      <content:encoded><![CDATA[<p>I have been using the <a href="https://github.com/thoughtbot/capybara-webkit">capybara-webkit</a>
gem for a while now since I first tried it out after making the switch from
Capybara + Selenium.</p>

<p>Using capybara-webkit speeds up my Selenium tests due to its headless nature,
and it&#39;s very straightforward. However, I had some trouble testing a
<a href="http://rubyonrails.org">Rails</a> based React app.</p>

<p>In this post, I will explain how I worked around the issues that came up when
trying to use capybara-webkit with <a href="https://facebook.github.io/react">React</a>.</p>

<!--more-->

<p>capybara-webkit depends on <a href="https://www.qt.io">Qt</a>, which you can install on
OSX using <a href="http://brewformulas.org/Qt">Homebrew</a>.
When running the tests using capybara-webkit with Qt 4.8, I noticed nothing was
getting rendered. To debug this problem, I used capybara-webkit&#39;s <a href="https://github.com/thoughtbot/capybara-webkit#configuration">debug mode</a>,
which spits out problems you would usually see in the Chrome console.
To enable it:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Capybara</span><span class="o">::</span><span class="no">Webkit</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="c1"># Enable debug mode. Prints a log of everything the driver is doing.</span>
  <span class="n">config</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kp">true</span>
<span class="k">end</span>
</code></pre></div>
<p>When the test runs, you&#39;ll get a log of every request/response and JS errors
that occurred during the test. One of the errors I got was:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>ReferenceError: Can&#39;t find variable: React
</code></pre></div>
<p>After some googling, I found <a href="https://github.com/reactjs/react-rails/issues/10#issuecomment-57300387">this issue</a>.
Because I was using Qt 4.8, I needed <a href="https://github.com/es-shims/es5-shim/blob/master/es5-shim.js">es5-shim</a>
on my <code>vendor/assets/javascripts</code> directory, and include it on the manifest
before including React, like so:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>//= require jquery
//= require jquery_ujs
//= require es5-shim
//= require react
//= require react_ujs
</code></pre></div>
<p>This happens because Qt 4.8&#39;s QtWebKit doesn&#39;t support most of the ES5 standard.
As an alternative to es5-shim, you can upgrade to a newer version of Qt, like
5.5, which does support some of the newer Javascript features.</p>

<p>After upgrading to Qt 5.5 and re-installing capybara-webkit, you can try getting
rid of <code>es5-shim</code> from your pipeline, and your tests should pass.</p>

<p>If you are using any of the <a href="http://es6-features.org,">ES6 features</a>, you&#39;ll
notice that your tests will fail even using Qt 5.5, because ES6 is not yet
supported by Qt 5.5.</p>

<p>When using <code>Object.assign</code> for merging objects to pass to my React state, I was
getting this error:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>TypeError: undefined is not a constructor (evaluating &#39;Object.assign(...)&#39;) ...
</code></pre></div>
<p>To fix it, I used the polyfill provided by Mozilla in their MDN documentation
for <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a>.
But if you prefer, you can include the whole <a href="https://github.com/paulmillr/es6-shim">es6-shim</a>
library and not worry about including each individual polyfill.</p>

<p>After all this, my tests finally passed!</p>

<p>Disclaimer: I used the <a href="https://github.com/reactjs/react-rails">react-rails</a>
gem. If you are already using <a href="https://webpack.js.org">Webpack</a> in your
Rails app, using <a href="https://github.com/babel/babel-loader">babel-loader</a> or
similar plugins to allow <a href="https://scotch.io/tutorials/javascript-transpilers-what-they-are-why-we-need-them">transpiling</a>
of ES6 would make these problems go away.</p>

<p>Have you had any problems getting your React integration tests running? Let me
know in the comments section below.</p>
]]></content:encoded>
      <dc:date>2017-02-13T05:27:00-05:00</dc:date>
    </item>
    <item>
      <title>Announcing AfipBill</title>
      <link>https://www.ombulabs.com/blog/open-source/ruby/rubygems/announcing-afip-bill.html</link>
      <description><![CDATA[If you live in Argentina and you ever use AFIP, you should already know that their platform is not the best in terms of user friendliness.
We wanted to integrate OmbuShop with AFIP (using their API) in order to generate and print the bills for each seller. Unfortunately, there is no way to do this because the API doesn&#39;t generate a printable version (PDF) of the bill.
]]></description>
      <pubDate>Thu, 09 Feb 2017 10:06:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/open-source/ruby/rubygems/announcing-afip-bill.html</guid>
      <content:encoded><![CDATA[<p>If you live in Argentina and you ever use AFIP, you should already know that their platform is not the best in terms of user friendliness.
We wanted to integrate <a href="https://www.ombushop.com">OmbuShop</a> with AFIP (using their <a href="http://www.afip.gob.ar/ws">API</a>) in order to generate and print the bills for each seller. Unfortunately, there is no way to do this because the API doesn&#39;t generate a printable version (PDF) of the bill.</p>

<!--more-->

<p>The old way to print the bills was to access the AFIP website, create the bill and download it. This is a very tedious task, specially because we needed to send a monthly bill to each of our sellers.</p>

<p>That&#39;s why we decided to create this new <a href="https://rubygems.org/gems/afip_bill">Ruby gem</a>. With <a href="https://github.com/ombulabs/afip_bill">afip_bill</a> you will be able to easily generate a PDF bill for your users. You only need to provide some basic information about your business and your users, and it will automatically complete the whole bill for you, ready to be printed.</p>

<p>You can check the whole code on <a href="https://github.com/ombulabs/afip_bill">Github</a>, as well as the documentation on how to use it.
If you detect a way to improve the codebase, feel free to send us a PR.</p>
]]></content:encoded>
      <dc:date>2017-02-09T10:06:00-05:00</dc:date>
    </item>
    <item>
      <title>How to use any gem in the Rails production console</title>
      <link>https://www.ombulabs.com/blog/rails/ruby/how-to-use-any-gem-in-production-console.html</link>
      <description><![CDATA[How many times did you come across a great gem you wanted to try out in
a production console, like benchmark-ips
or awesome-print?

Be it for performance or for readability, sometimes it&#39;s nice to be able to try
out something new quickly without going through a pull request + deployment
process. This is possible by modifying the $LOAD_PATH
Ruby global variable and requiring the gem manually.
]]></description>
      <pubDate>Wed, 14 Dec 2016 13:06:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/ruby/how-to-use-any-gem-in-production-console.html</guid>
      <content:encoded><![CDATA[<p>How many times did you come across a great gem you wanted to try out in
a production console, like <a href="https://github.com/evanphx/benchmark-ips">benchmark-ips</a>
or <a href="https://github.com/awesome-print/awesome_print">awesome-print</a>?</p>

<p>Be it for performance or for readability, sometimes it&#39;s nice to be able to try
out something new quickly without going through a pull request + deployment
process. This is possible by modifying the <a href="http://ruby-doc.org/core-2.3.0/doc/globals_rdoc.html">$LOAD_PATH</a>
Ruby global variable and requiring the gem manually.</p>

<!--more-->

<p>The Ruby global variable <code>$LOAD_PATH</code> is an alias for <code>$:</code>, which essentially
contains an array of paths that your app will search through when using the
Kernel method <code>require</code>.</p>

<p>Obviously the real solution here would be to just put the gem in your Gemfile,
and bundle. However, if you wish to use <code>benchmark-ips</code> to test the performance
of methods in a Rails console with production data and you don&#39;t have the gem
already bundled, then follow these steps:</p>

<ul>
<li>SSH into your target server</li>
<li>Run <code>gem install benchmark-ips</code></li>
<li>Run <code>gem env gemdir</code> to figure out the path where gems are installed. For example:</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>/usr/local/rbenv/versions/2.1.2/lib/ruby/gems/2.1.0
</code></pre></div>
<ul>
<li>Open the Rails console</li>
<li>Add the gem&#39;s path to the <code>$LOAD_PATH</code> global variable, like so:</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$LOAD_PATH &lt;&lt; &quot;/usr/local/rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/benchmark-ips-2.7.2/lib&quot;
</code></pre></div>
<ul>
<li>Finally, require the gem&#39;s entry point file. You may need to look into the
gem&#39;s structure to figure out what file you need to require. For example, for
<code>benchmark-ips</code>:</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>require &quot;/usr/local/rbenv/versions/2.1.2/lib/ruby/gems/benchmark-ips-2.7.2/lib/benchmark/ips.rb&quot;
</code></pre></div>
<p>This should let you use almost any gem you need in a Rails production console.</p>
]]></content:encoded>
      <dc:date>2016-12-14T13:06:00-05:00</dc:date>
    </item>
    <item>
      <title>Present? vs Any? vs Exists?</title>
      <link>https://www.ombulabs.com/blog/benchmark/performance/rails/present-vs-any-vs-exists.html</link>
      <description><![CDATA[When working on a Rails project, you may have seen present? calls on
ActiveRecord relationships. This might feel natural, mostly because present?
exists on all objects via ActiveSupport, so you expect the relationship to respond to it,
but it&#39;s actually not a very good idea. If all we want to do is check if the
scope returns any results from the database, there are better ways than using
present?.
]]></description>
      <pubDate>Fri, 02 Dec 2016 08:31:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/benchmark/performance/rails/present-vs-any-vs-exists.html</guid>
      <content:encoded><![CDATA[<p>When working on a Rails project, you may have seen <code>present?</code> calls on
ActiveRecord relationships. This might feel natural, mostly because <code>present?</code>
exists on all objects <a href="http://guides.rubyonrails.org/active_support_core_extensions.html#blank-questionmark-and-present-questionmark">via ActiveSupport</a>, so you expect the relationship to respond to it,
but it&#39;s actually not a very good idea. If all we want to do is check if the
scope returns any results from the database, there are better ways than using
<code>present?</code>.</p>

<!--more-->

<p><em>In Rails 5.1 and up, the performance of <code>any?</code> and <code>exists?</code> has been fixed, so
they are now equally performant.</em></p>

<p><code>present?</code> is slow because:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">003</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">57</span><span class="p">)</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">not</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span><span class="o">.</span><span class="n">present?</span>
<span class="no">Project</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="s2">&quot;projects&quot;</span><span class="o">.</span><span class="n n-Operator">*</span> <span class="no">FROM</span> <span class="s2">&quot;projects&quot;</span>  <span class="no">WHERE</span> <span class="s2">&quot;projects&quot;</span><span class="o">.</span><span class="s2">&quot;enabled&quot;</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span> <span class="no">AND</span> <span class="s2">&quot;projects&quot;</span><span class="o">.</span><span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="vg">$1</span> <span class="no">LIMIT</span> <span class="mi">1</span>  <span class="o">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="mi">57</span><span class="o">]]</span>
<span class="no">Task</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">918</span><span class="o">.</span><span class="mi">7</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="n n-Operator">*</span> <span class="no">FROM</span> <span class="s2">&quot;tasks&quot;</span> <span class="no">INNER</span> <span class="no">JOIN</span> <span class="s2">&quot;boards&quot;</span> <span class="no">ON</span> <span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="s2">&quot;board_id&quot;</span> <span class="o">=</span> <span class="s2">&quot;boards&quot;</span><span class="o">.</span><span class="s2">&quot;id&quot;</span> <span class="no">WHERE</span> <span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="s2">&quot;enabled&quot;</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span> <span class="no">AND</span> <span class="s2">&quot;boards&quot;</span><span class="o">.</span><span class="s2">&quot;project_id&quot;</span> <span class="o">=</span> <span class="vg">$1</span> <span class="no">AND</span> <span class="s2">&quot;boards&quot;</span><span class="o">.</span><span class="s2">&quot;enabled&quot;</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span> <span class="no">AND</span> <span class="p">(</span><span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="s2">&quot;deleted_at&quot;</span> <span class="no">IS</span> <span class="no">NOT</span> <span class="no">NULL</span><span class="p">)</span>  <span class="o">[[</span><span class="s2">&quot;project_id&quot;</span><span class="p">,</span> <span class="mi">57</span><span class="o">]]</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div>
<p>As you can see in the snippet above, we&#39;re loading one project, and then loading
all of its tasks to check for presence using <code>present?</code>. This ends up taking
quite a bit of time (~900ms), hurting the performance of the app both memory and
time-wise.</p>

<p>A slightly better approach would be using <code>any?</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">004</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">57</span><span class="p">)</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">not</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span><span class="o">.</span><span class="n">any?</span>
<span class="no">Project</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="s2">&quot;projects&quot;</span><span class="o">.</span><span class="n n-Operator">*</span> <span class="no">FROM</span> <span class="s2">&quot;projects&quot;</span>  <span class="no">WHERE</span> <span class="s2">&quot;projects&quot;</span><span class="o">.</span><span class="s2">&quot;enabled&quot;</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span> <span class="no">AND</span> <span class="s2">&quot;projects&quot;</span><span class="o">.</span><span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="vg">$1</span> <span class="no">LIMIT</span> <span class="mi">1</span>  <span class="o">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="mi">57</span><span class="o">]]</span>
<span class="p">(</span><span class="mi">119</span><span class="o">.</span><span class="mi">0</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="no">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="no">FROM</span> <span class="s2">&quot;tasks&quot;</span> <span class="no">INNER</span> <span class="no">JOIN</span> <span class="s2">&quot;boards&quot;</span> <span class="no">ON</span> <span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="s2">&quot;board_id&quot;</span> <span class="o">=</span> <span class="s2">&quot;boards&quot;</span><span class="o">.</span><span class="s2">&quot;id&quot;</span> <span class="no">WHERE</span> <span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="s2">&quot;enabled&quot;</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span> <span class="no">AND</span> <span class="s2">&quot;boards&quot;</span><span class="o">.</span><span class="s2">&quot;project_id&quot;</span> <span class="o">=</span> <span class="vg">$1</span> <span class="no">AND</span> <span class="s2">&quot;boards&quot;</span><span class="o">.</span><span class="s2">&quot;enabled&quot;</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span> <span class="no">AND</span> <span class="p">(</span><span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="s2">&quot;deleted_at&quot;</span> <span class="no">IS</span> <span class="no">NOT</span> <span class="no">NULL</span><span class="p">)</span>  <span class="o">[[</span><span class="s2">&quot;project_id&quot;</span><span class="p">,</span> <span class="mi">57</span><span class="o">]]</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div>
<p><code>any?</code> uses <a href="http://www.w3schools.com/sql/sql_func_count.asp">SQL count</a> instead
of loading each task, resulting in a faster, more performant result (from ~900ms
down to ~100ms). However, what we actually want to know in this case is if there
is at least one record in our scope. We don&#39;t really need to count all of the
tasks, it should stop after finding the first one. So applying <code>LIMIT</code> would
solve that for us, and that&#39;s how <code>exists?</code> saves the day:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">005</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="no">Project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">57</span><span class="p">)</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">not</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span><span class="o">.</span><span class="n">exists?</span>
<span class="no">Project</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="s2">&quot;projects&quot;</span><span class="o">.</span><span class="n n-Operator">*</span> <span class="no">FROM</span> <span class="s2">&quot;projects&quot;</span>  <span class="no">WHERE</span> <span class="s2">&quot;projects&quot;</span><span class="o">.</span><span class="s2">&quot;enabled&quot;</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span> <span class="no">AND</span> <span class="s2">&quot;projects&quot;</span><span class="o">.</span><span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="vg">$1</span> <span class="no">LIMIT</span> <span class="mi">1</span>  <span class="o">[[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="mi">57</span><span class="o">]]</span>
<span class="no">Task</span> <span class="no">Exists</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span>  <span class="mi">1</span> <span class="no">AS</span> <span class="n">one</span> <span class="no">FROM</span> <span class="s2">&quot;tasks&quot;</span> <span class="no">INNER</span> <span class="no">JOIN</span> <span class="s2">&quot;boards&quot;</span> <span class="no">ON</span> <span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="s2">&quot;board_id&quot;</span> <span class="o">=</span> <span class="s2">&quot;boards&quot;</span><span class="o">.</span><span class="s2">&quot;id&quot;</span> <span class="no">WHERE</span> <span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="s2">&quot;enabled&quot;</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span> <span class="no">AND</span> <span class="s2">&quot;boards&quot;</span><span class="o">.</span><span class="s2">&quot;project_id&quot;</span> <span class="o">=</span> <span class="vg">$1</span> <span class="no">AND</span> <span class="s2">&quot;boards&quot;</span><span class="o">.</span><span class="s2">&quot;enabled&quot;</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span> <span class="no">AND</span> <span class="p">(</span><span class="s2">&quot;tasks&quot;</span><span class="o">.</span><span class="s2">&quot;deleted_at&quot;</span> <span class="no">IS</span> <span class="no">NOT</span> <span class="no">NULL</span><span class="p">)</span> <span class="no">LIMIT</span> <span class="mi">1</span>  <span class="o">[[</span><span class="s2">&quot;project_id&quot;</span><span class="p">,</span> <span class="mi">57</span><span class="o">]]</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div>
<p>By limiting the count to 1, after finding the first record, it returns true.
Notice the time in the debug lines in parenthesis, we went from ~900ms using
<code>present?</code>, to ~100ms using <code>any?</code>, to ~1ms using <code>exists?</code>.</p>

<p>Finally, here&#39;s a benchmark (using <a href="https://github.com/evanphx/benchmark-ips">benchmark-ips</a>) which shows the difference in execution time between the three methods:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Benchmark</span><span class="o">.</span><span class="n">ips</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="n">x</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;present?&quot;</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">not</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span><span class="o">.</span><span class="n">present?</span>
  <span class="k">end</span>
  <span class="n">x</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;any?&quot;</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">not</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span><span class="o">.</span><span class="n">any?</span>
  <span class="k">end</span>
  <span class="n">x</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;exists?&quot;</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">where</span><span class="o">.</span><span class="n">not</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span><span class="o">.</span><span class="n">exists?</span>
  <span class="k">end</span>
  <span class="n">x</span><span class="o">.</span><span class="n">compare!</span>
<span class="k">end</span>

 <span class="n">exists?</span><span class="p">:</span>      <span class="mi">158</span><span class="o">.</span><span class="mi">4</span> <span class="n">i</span><span class="o">/</span><span class="n">s</span>
    <span class="n">any?</span><span class="p">:</span>       <span class="mi">10</span><span class="o">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">/</span><span class="n">s</span> <span class="o">-</span> <span class="mi">15</span><span class="o">.</span><span class="mi">65</span><span class="n">x</span>  <span class="n">slower</span>
<span class="n">present?</span><span class="p">:</span>        <span class="mi">2</span><span class="o">.</span><span class="mi">3</span> <span class="n">i</span><span class="o">/</span><span class="n">s</span> <span class="o">-</span> <span class="mi">68</span><span class="o">.</span><span class="mi">39</span><span class="n">x</span>  <span class="n">slower</span>
</code></pre></div>
<p>NOTE: The examples shown in this post are taken from a Rails 4.2 app, using
PostgreSQL. I am not sure if this behavior remains the same in newer versions
of Rails.</p>

<p>If you&#39;re currently using <code>present?</code> in your projects, it should be a
quick performance win to replace these calls to use either <code>any?</code> or <code>exists?</code>.</p>
]]></content:encoded>
      <dc:date>2016-12-02T08:31:00-05:00</dc:date>
    </item>
    <item>
      <title>Brief look at RSpec's formatting options</title>
      <link>https://www.ombulabs.com/blog/rspec/ruby/using-rspecs-documentation-format.html</link>
      <description><![CDATA[A few weeks ago, I noticed weird output in the RSpec
test suite (~4000 tests) for a Rails application:
.............................................................................................unknown OID 353414: failed to recognize type of &#39;&lt;field&gt;&#39;. It will be treated as String  ...........................................................................................................................................

This Rails app uses a PostgreSQL database. After
some Googling, it turns out that this is a warning from PostgreSQL. When the
database doesn&#39;t recognize the type to use for a column, it casts to string by
default.
]]></description>
      <pubDate>Tue, 08 Nov 2016 07:53:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rspec/ruby/using-rspecs-documentation-format.html</guid>
      <content:encoded><![CDATA[<p>A few weeks ago, I noticed weird output in the <a href="https://relishapp.com/rspec">RSpec</a>
test suite (~4000 tests) for a <a href="http://rubyonrails.org">Rails</a> application:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>.............................................................................................unknown OID 353414: failed to recognize type of &#39;&lt;field&gt;&#39;. It will be treated as String  ...........................................................................................................................................
</code></pre></div>
<p>This Rails app uses a <a href="https://www.postgresql.org">PostgreSQL</a> database. After
some Googling, it turns out that this is a warning from PostgreSQL. When the
database doesn&#39;t recognize the type to use for a column, it casts to string by
default.</p>

<!--more-->

<p>I first thought I could look through previous CI runs to find out when this
warning first started showing up. Then I decided to use RSpec&#39;s documentation
format instead. I ran the build locally, and the test that triggers the warning
for the first time was exposed:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>➜  myproject git:(develop) ✗ bundle exec rspec spec --format documentation

...

Admin::ClientsController
  GET &#39;index&#39;
unknown OID 353414: failed to recognize type of &#39;client_campaigns&#39;. It will be treated as String.
    non-admin user
      does not authorize non-admin users
    admin user
      lists all clients

...
</code></pre></div>
<p>The RSpec documentation format shows us the test description and the example
names. Because of this, we can tell what test we can run to reproduce the
warning. It also allows us to figure out where in the codebase the warning is
triggered from.</p>

<p>A good alternative to the documentation format is the <a href="https://github.com/thekompanee/fuubar">Fuubar gem</a>.
Using <code>rspec --format Fuubar</code>, you get a nice looking progress bar, as well as
its coolest feature, insta-failing tests. With Fuubar, you don&#39;t have to wait
until the build ends or until you ctrl+c out of RSpec, you get the failure
result right away. If you don&#39;t care about the build finishing after the first
failure, you can use RSpec&#39;s <a href="https://relishapp.com/rspec/rspec-core/docs/command-line/fail-fast-option">fail fast</a>
option instead.</p>

<p>Since <code>--format Fuubar</code> doesn&#39;t show test descriptions by default, you can
combine Fuubar with the documentation format, using
<code>rspec --format Fuubar --format documentation</code>. This way, you get both the
documentation format and insta-failing tests. If you prefer this formatting to
RSpec&#39;s default formatting, remember you can always add the flag to your
<code>.rspec</code> file.</p>
]]></content:encoded>
      <dc:date>2016-11-08T07:53:00-05:00</dc:date>
    </item>
    <item>
      <title>Tips for Writing Fast Rails: Part 1</title>
      <link>https://www.ombulabs.com/blog/performance/rails/writing-fast-rails.html</link>
      <description><![CDATA[Rails is a powerful framework. You can write a lot of features in a short period of time. In the process you can easily write code that performs poorly.

At Ombu Labs we like to maintain Ruby on Rails
applications. In the process
of maintaining them, adding features and fixing bugs, we like to improve
the code and its performance (because we are good boy scouts!)

Here are some tips based on our experience.

Prefer where instead of select

When you are performing a lot of calculations, you should load as little as
possible into memory. Always prefer a SQL query vs. an object&#39;s method call.
]]></description>
      <pubDate>Tue, 11 Oct 2016 04:37:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/performance/rails/writing-fast-rails.html</guid>
      <content:encoded><![CDATA[<p><a href="http://rubyonrails.org/">Rails</a> is a powerful framework. You can write a lot of features in a short period of time. In the process you can easily write code that <strong>performs poorly</strong>.</p>

<p>At <a href="https://www.ombulabs.com">Ombu Labs</a> we like to <a href="https://www.ombulabs.com/blog/tags/maintenance">maintain Ruby on Rails
applications</a>. In the process
of maintaining them, adding features and fixing bugs, we like to improve
the code and its performance (because we are <a href="http://programmer.97things.oreilly.com/wiki/index.php/The_Boy_Scout_Rule">good <em>boy scouts</em></a>!)</p>

<p>Here are some tips based on our experience.</p>

<h2>Prefer <code>where</code> instead of <code>select</code></h2>

<p>When you are performing a lot of calculations, you should load as little as
possible into memory. <strong>Always</strong> prefer a SQL query vs. an object&#39;s method call.</p>

<!--more-->

<p>With <a href="http://guides.rubyonrails.org/active_record_basics.html">ActiveRecord</a>, it&#39;s
easy to forget which methods load
<a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/base.rb">ActiveRecord::Base</a>
objects into memory and which perform a simple query instead.</p>

<p><strong>The bigger the table, the slower the object load</strong>. If you have a table with 80
columns (<strong>sigh!</strong>), loading each record will take a lot longer than a table
with 3 columns. So, you must  avoid object loads as much as possible. Only load
objects into memory when you <strong>really need them</strong>.</p>

<p>For example:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">shop_ids</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">shop_id</span><span class="o">|</span>
  <span class="n">products</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">p</span><span class="o">.</span><span class="n">shop_id</span> <span class="o">==</span> <span class="n">shop_id</span> <span class="p">}</span><span class="o">.</span><span class="n">first</span>
<span class="k">end</span>
</code></pre></div>
<p><code>select</code> will load all the <code>products</code> into memory and then compare the ids.
This will be slower than just using <code>where</code>.</p>

<p>This will be much faster:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">shop_ids</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">shop_id</span><span class="o">|</span>
  <span class="n">products</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">shop_id</span><span class="p">:</span> <span class="n">shop_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="k">end</span>
</code></pre></div>
<p>Because it will perform the query and <strong>only after the query returns</strong> it will
load the objects into memory.</p>

<h2>Prefer <code>pluck</code> instead of <code>map</code></h2>

<p>If you are interested in only a few values per row, you should use <code>pluck</code>
instead of <code>map</code>.</p>

<p>For example:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Order</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">number</span><span class="p">:</span> <span class="s1">&#39;R545612547&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="o">&amp;</span><span class="ss">:id</span>
<span class="c1"># Order Load (5.0ms)  SELECT `orders`.* FROM `orders` WHERE `orders`.`number` = &#39;R545612547&#39; ORDER BY orders.created_at DESC</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</code></pre></div>
<p>As with <code>select</code>, <code>map</code> will load the <code>order</code> into memory and it will get the
<code>id</code> attribute.</p>

<p>Using <code>pluck</code> will be faster, because it doesn&#39;t need to load an entire object
into memory.</p>

<p>So this will be much faster:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Order</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">number</span><span class="p">:</span> <span class="s1">&#39;R545612547&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">pluck</span> <span class="ss">:id</span>
<span class="c1"># SQL (0.8ms)  SELECT `orders`.`id` FROM `orders` WHERE `orders`.`number` = &#39;R545612547&#39; ORDER BY orders.created_at DESC</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</code></pre></div>
<p>For this particular case, <code>pluck</code> is six times faster than <code>map</code>.</p>

<h2>Avoid N+1 Queries</h2>

<p>There are some rare cases where you want an <strong>N+1 query</strong> in your application.
For  instance, when you are using a
<a href="http://edgeguides.rubyonrails.org/caching_with_rails.html#russian-doll-caching">Russian Doll Caching</a>
strategy, it&#39;s a good idea. (full explanation in this interview with <a href="https://twitter.com/dhh">DHH</a>:
  <a href="https://youtu.be/ktZLpjCanvg?t=4m27s">https://youtu.be/ktZLpjCanvg?t=4m27s</a>)</p>

<p>If you are <strong>not</strong> using this caching strategy, you should get rid of all your
<a href="http://guides.rubyonrails.org/active_record_querying.html#eager-loading-associations">N+1 query problems</a>
by including the tables that you need before running the query.</p>

<p>For example:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Order</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;created_at &gt; ?&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="o">.</span><span class="n">hour</span><span class="o">.</span><span class="n">ago</span><span class="p">)</span>
     <span class="o">.</span><span class="n">find_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">order</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">order</span><span class="o">.</span><span class="n">ship_address</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:firstname</span><span class="p">)</span>
<span class="k">end</span>
  <span class="no">Order</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">7866</span><span class="o">.</span><span class="mi">0</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="sb">`orders`</span><span class="o">.</span><span class="n n-Operator">*</span> <span class="no">FROM</span> <span class="sb">`orders`</span> <span class="no">WHERE</span> <span class="p">(</span><span class="n">created_at</span> <span class="o">&gt;</span> <span class="s1">&#39;2016-10-05 18:05:48&#39;</span><span class="p">)</span> <span class="no">ORDER</span> <span class="no">BY</span> <span class="sb">`orders`</span><span class="o">.</span><span class="n n-Operator">`</span><span class="nb">id</span><span class="sb">` ASC LIMIT 1000</span>
<span class="sb">  Address::ShipAddress Load (0.5ms)  SELECT `</span><span class="n">addresses</span><span class="sb">`.* FROM `</span><span class="n">addresses</span><span class="sb">` WHERE `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">type</span><span class="sb">` IN (&#39;Address::ShipAddress&#39;) AND `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">order_id</span><span class="sb">` = 2619178 LIMIT 1</span>
<span class="sb">  Address::ShipAddress Load (0.5ms)  SELECT `</span><span class="n">addresses</span><span class="sb">`.* FROM `</span><span class="n">addresses</span><span class="sb">` WHERE `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">type</span><span class="sb">` IN (&#39;Address::ShipAddress&#39;) AND `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">order_id</span><span class="sb">` = 2619179 LIMIT 1</span>
<span class="sb">  Address::ShipAddress Load (0.5ms)  SELECT `</span><span class="n">addresses</span><span class="sb">`.* FROM `</span><span class="n">addresses</span><span class="sb">` WHERE `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">type</span><span class="sb">` IN (&#39;Address::ShipAddress&#39;) AND `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">order_id</span><span class="sb">` = 2619180 LIMIT 1</span>
<span class="sb">  Address::ShipAddress Load (0.5ms)  SELECT `</span><span class="n">addresses</span><span class="sb">`.* FROM `</span><span class="n">addresses</span><span class="sb">` WHERE `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">type</span><span class="sb">` IN (&#39;Address::ShipAddress&#39;) AND `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">order_id</span><span class="sb">` = 2619181 LIMIT 1</span>
<span class="sb">  Address::ShipAddress Load (0.5ms)  SELECT `</span><span class="n">addresses</span><span class="sb">`.* FROM `</span><span class="n">addresses</span><span class="sb">` WHERE `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">type</span><span class="sb">` IN (&#39;Address::ShipAddress&#39;) AND `</span><span class="n">addresses</span><span class="sb">`.`</span><span class="n">order_id</span><span class="sb">` = 2619182 LIMIT 1</span>
<span class="sb">  # ... to N</span>
</code></pre></div>
<p>This code will perform <strong>one</strong> query on the <code>orders</code> table and <strong>N</strong> queries on
the <code>addresses</code> table.</p>

<p>This will be faster:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Order</span><span class="o">.</span><span class="n">eager_load</span><span class="p">(</span><span class="ss">:ship_address</span><span class="p">)</span>
     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;orders.created_at &gt; ?&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="o">.</span><span class="n">hour</span><span class="o">.</span><span class="n">ago</span><span class="p">)</span>
     <span class="o">.</span><span class="n">find_each</span> <span class="k">do</span> <span class="o">|</span><span class="n">order</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">order</span><span class="o">.</span><span class="n">ship_address</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:firstname</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>This code will perform <strong>only one query</strong>. <code>eager_load</code> will <a href="http://apidock.com/rails/ActiveRecord/QueryMethods/eager_load">perform a query
with a LEFT OUTER JOIN</a>
with the associated table (<code>addresses</code>).</p>

<p>If you use <code>Order.includes(:ship_address)</code> it will perform two
queries one for the <code>orders</code> table and another one for the <code>addresses</code> table.
To understand the difference between <code>includes</code> and <code>eager_load</code>, read
this article about <a href="http://blog.arkency.com/2013/12/rails4-preloading/">Rails 4 preloading</a>.</p>

<p>A good way to find <strong>N+1</strong> queries is using
<a href="https://rubygems.org/gems/bullet">bullet</a> to get warnings as you develop your
application.</p>

<h2>Conclusion</h2>

<p>Sometimes it takes only a few lines of code to improve the performance of your
<a href="http://rubyonrails.org/">Rails</a> application. Before you start refactoring your
code to perform faster, you should make sure that you have coverage for the
methods that you&#39;re improving.</p>

<p>If you found this article interesting, check out
Erik Michaels-Ober&#39;s talk
about <a href="https://speakerdeck.com/sferik/writing-fast-ruby">Writing Fast Ruby</a>: <a href="https://www.youtube.com/watch?v=fGFM_UrSp70">https://www.youtube.com/watch?v=fGFM_UrSp70</a>. It has
great tips for improving performance in your Ruby application or library.</p>

<p>And, if you need help improving the
<a href="https://www.ombulabs.com/blog/tags/performance">performance</a> of your Rails
application, <a href="https://www.ombulabs.com/contact">get in touch</a>! We are constantly
looking for new projects and opportunities to improve your
<a href="https://www.ombulabs.com/blog/tags/rails">Rails</a> performance.</p>
]]></content:encoded>
      <dc:date>2016-10-11T04:37:00-04:00</dc:date>
    </item>
    <item>
      <title>Spy vs Double vs Instance Double</title>
      <link>https://www.ombulabs.com/blog/rspec/ruby/spy-vs-double-vs-instance-double.html</link>
      <description><![CDATA[When writing tests for services, you may sometimes want to use mock objects
instead of real objects. In case you&#39;re using ActiveRecord and real
objects, your tests may hit the database and slow down your suite. The
latest release of the rspec-mocks
library bundled with RSpec 3 includes at least three
different ways to implement a mock object.

Let&#39;s discuss some of the differences between a spy, a double and an
instance_double. First, the spy:
[1] pry(main)&gt; require &#39;rspec/mocks/standalone&#39;
=&gt; true
[2] pry(main)&gt; user_spy = spy(User)
=&gt; #&lt;Double User&gt;
[3] pry(main)&gt; spy.whatever_method
=&gt; #&lt;Double (anonymous)&gt;
]]></description>
      <pubDate>Wed, 17 Aug 2016 02:04:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rspec/ruby/spy-vs-double-vs-instance-double.html</guid>
      <content:encoded><![CDATA[<p>When writing tests for services, you may sometimes want to use mock objects
instead of real objects. In case you&#39;re using ActiveRecord and real
objects, your tests may hit the database and slow down your suite. The
latest release of the <a href="https://github.com/rspec/rspec-mocks">rspec-mocks</a>
library bundled with <a href="http://rspec.info">RSpec 3</a> includes at least three
different ways to implement a mock object.</p>

<p>Let&#39;s discuss some of the differences between a <code>spy</code>, a <code>double</code> and an
<code>instance_double</code>. First, the <code>spy</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;rspec/mocks/standalone&#39;</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user_spy</span> <span class="o">=</span> <span class="n">spy</span><span class="p">(</span><span class="no">User</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Double User&gt;</span>
<span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">spy</span><span class="o">.</span><span class="n">whatever_method</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Double (anonymous)&gt;</span>
</code></pre></div>
<!--more-->

<p>The <code>spy</code> <a href="https://relishapp.com/rspec/rspec-mocks/docs/basics/spies">accepts any method calls</a>
and always returns itself unless specified. If you need the mock object to raise
if it receives an unexpected method call, you can use a <code>double</code> instead:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user_double</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="no">User</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Double User&gt;</span>
<span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user_double</span><span class="o">.</span><span class="n">whatever_method</span>
<span class="no">RSpec</span><span class="o">::</span><span class="no">Mocks</span><span class="o">::</span><span class="ss">MockExpectationError</span><span class="p">:</span> <span class="c1">#&lt;Double User&gt; received unexpected message :whatever_method with (no args)</span>
<span class="n">from</span> <span class="sr">/Users/m</span><span class="n">auro</span><span class="o">-</span><span class="n">oto</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">2</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="vi">@carbide</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">rspec</span><span class="o">-</span><span class="n">support</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rspec</span><span class="o">/</span><span class="n">support</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">87</span><span class="ss">:in</span> <span class="n">block</span> <span class="k">in</span> <span class="o">&lt;</span><span class="ss">module</span><span class="p">:</span><span class="no">Support</span><span class="o">&gt;</span>
</code></pre></div>
<p>If you haven&#39;t specified that the double can receive a given method, in the case
above <code>whatever_method</code>, it&#39;ll raise an exception. You can explicitly tell the
double that it can receive such a method and its return value like this:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">6</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user_double</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">whatever_method</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Double User&gt;</span>
<span class="o">[</span><span class="mi">7</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user_double</span><span class="o">.</span><span class="n">whatever_method</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="o">[</span><span class="mi">8</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user_double</span><span class="o">.</span><span class="n">some_method</span>
<span class="no">RSpec</span><span class="o">::</span><span class="no">Mocks</span><span class="o">::</span><span class="ss">MockExpectationError</span><span class="p">:</span> <span class="c1">#&lt;Double User&gt; received unexpected message :some_method with (no args)</span>
<span class="n">from</span> <span class="sr">/Users/m</span><span class="n">auro</span><span class="o">-</span><span class="n">oto</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">2</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="vi">@carbide</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">rspec</span><span class="o">-</span><span class="n">support</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rspec</span><span class="o">/</span><span class="n">support</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">87</span><span class="ss">:in</span> <span class="n">block</span> <span class="k">in</span> <span class="o">&lt;</span><span class="ss">module</span><span class="p">:</span><span class="no">Support</span><span class="o">&gt;</span>
</code></pre></div>
<p>This way, <code>whatever_method</code> can be called and <code>nil</code> will be returned, which is
the return value we specified. Any other method calls will fail if we
haven&#39;t specified them (e.g. <code>some_method</code>).</p>

<p>If we want to have even more control over what happens with our mock object, and
disallow arbitrary method creation like <code>whatever_method</code> or <code>some_method</code>, we
can use a verifying double, which exists since RSpec 3 as <code>instance_double</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">9</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user_verifiable</span> <span class="o">=</span> <span class="n">instance_double</span><span class="p">(</span><span class="no">User</span><span class="p">,</span> <span class="ss">whatever_method</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
<span class="no">RSpec</span><span class="o">::</span><span class="no">Mocks</span><span class="o">::</span><span class="ss">MockExpectationError</span><span class="p">:</span> <span class="n">the</span> <span class="no">User</span> <span class="k">class</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">implement</span> <span class="n">the</span> <span class="n">instance</span> <span class="nb">method</span><span class="p">:</span> <span class="n">whatever_method</span>
<span class="n">from</span> <span class="sr">/Users/m</span><span class="n">auro</span><span class="o">-</span><span class="n">oto</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">2</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="vi">@carbide</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">rspec</span><span class="o">-</span><span class="n">support</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rspec</span><span class="o">/</span><span class="n">support</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">87</span><span class="ss">:in</span> <span class="n">block</span> <span class="k">in</span> <span class="o">&lt;</span><span class="ss">module</span><span class="p">:</span><span class="no">Support</span><span class="o">&gt;</span>
</code></pre></div>
<p>If we try to declare a method which is not implemented by the class of the
mocked instance, it will raise an exception. If we decide to use mock objects in
our tests, instance_doubles provides us with a bit more confidence in our tests
than if we were using spies or regular doubles.</p>

<p>The performance of <code>instance_double</code> is slightly worse than <code>double</code> or <code>spy</code>
because verifying doubles are more complex. The difference between using a
verifying double and a real object is quite significant:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Benchmark.ips do |bm|
  bm.report(&quot;spy&quot;) { spy(User, id: 1) }
  bm.report(&quot;double&quot;) { double(User, id: 1) }
  bm.report(&quot;verifying double&quot;) { instance_double(User, id: 1) }
  bm.report(&quot;actual object&quot;) { User.new(id: 1) }
  bm.report(&quot;via factorygirl&quot;) { FactoryGirl.build(:user, id: 1) }
  bm.compare!
end

Warming up --------------------------------------
                 spy   402.000  i/100ms
              double   572.000  i/100ms
    verifying double   424.000  i/100ms
       actual object   153.000  i/100ms
     via factorygirl    92.000  i/100ms
Calculating -------------------------------------
                 spy     29.174k (±31.6%) i/s -     55.878k in   5.575866s
              double     21.567k (±37.5%) i/s -     35.464k in   5.599092s
    verifying double      9.418k (±36.4%) i/s -     10.600k in   5.031771s
       actual object      1.226k (±37.3%) i/s -      3.366k in   6.897566s
     via factorygirl      1.037k (±27.4%) i/s -      2.300k in   7.289933s

Comparison:
                 spy:    29174.4 i/s
              double:    21567.0 i/s - same-ish: difference falls within error
    verifying double:     9417.5 i/s - 3.10x slower
       actual object:     1226.1 i/s - 23.79x slower
     via factorygirl:     1036.7 i/s - 28.14x slower
</code></pre></div>
<p>If you are testing a service and don&#39;t care about testing ActiveRecord callbacks
or database interactions, you will likely be better off using a double. If
you are already using spies or doubles, you may want to use a verifying double
instead. I think the slight performance hit of verifying the object&#39;s
implementation is worth it.</p>
]]></content:encoded>
      <dc:date>2016-08-17T02:04:00-04:00</dc:date>
    </item>
    <item>
      <title>The Need for bin/start</title>
      <link>https://www.ombulabs.com/blog/maintenance/conventions/standard-getting-started.html</link>
      <description><![CDATA[Getting started with a new project should be as simple as possible, even for
someone who is not technical. As a maintainer, you must make sure that
anyone can clone your project and get it up and running in a few minutes.

After you clone a project, you should follow two steps:


Setup
Start

]]></description>
      <pubDate>Mon, 04 Jul 2016 08:31:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/maintenance/conventions/standard-getting-started.html</guid>
      <content:encoded><![CDATA[<p>Getting started with a new project should be <strong>as simple as possible</strong>, even for
someone who is not technical. As a maintainer, you <strong>must</strong> make sure that
anyone can clone your project and get it up and running in a few minutes.</p>

<p>After you clone a project, you should follow two steps:</p>

<ol>
<li>Setup</li>
<li>Start</li>
</ol>

<!--more-->

<p>In this example, the project is a web application, but it works for other
projects too.</p>

<h2>Setup</h2>

<p>You should have a small bash script called <code>bin/setup</code> in every project. You
could use <a href="https://www.ruby-lang.org/en/">Ruby</a> for the script if that&#39;s
what you prefer.</p>

<p><a href="http://rubyonrails.org/">Rails</a> has had a <code>bin/setup</code> <a href="https://github.com/rails/rails/pull/15189">since 2014</a> and so should your project! This is the default <a href="https://github.com/rails/rails/blob/v4.2.7.1/railties/lib/rails/generators/rails/app/templates/bin/setup">./bin/setup</a> in a Rails application.</p>

<p><a href="https://robots.thoughtbot.com/">Thoughtbot</a> wrote a great article about
their <code>bin/setup</code> convention:
<a href="https://robots.thoughtbot.com/bin-setup">./bin/setup</a></p>

<p>At <a href="https://www.ombulabs.com/">Ombu Labs</a>, one of our latest <code>bin/setup</code> scripts
looks like this:</p>

<script src="https://gist.github.com/etagwerker/956448c7a4b058b45e23f562deca8d79.js">
</script>

<p>In order for our script to work, you <strong>must</strong> have a <code>.env.sample</code> file that
has some default values for your <code>.env</code> file. Every project you start <strong>must</strong>
have a <code>.env</code> file with environment configuration. Why?
<a href="http://12factor.net/config">Read here</a></p>

<p>We use <a href="https://www.ruby-lang.org/en/">Ruby</a> for our setup script because all of
our development environments have been setup with this script:
<a href="https://github.com/ombulabs/setup">Ombu Labs Setup</a></p>

<h2>Start</h2>

<p>If you are using Rails, starting an application is simple:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>./bin/rails server
</code></pre></div>
<p>But, what if you want to use something else? Let&#39;s say you want to use
<a href="https://github.com/sinatra/sinatra">Sinatra</a> with
<a href="https://github.com/rtomayko/shotgun">Shotgun</a>. Then you would need to start
the server like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>shotgun config.ru
</code></pre></div>
<p>If you are using <a href="https://rubygems.org/gems/bundler">Bundler</a>, then you would
need to run it like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>bundle exec shotgun config.ru
</code></pre></div>
<p>What if you want to use <a href="https://github.com/ddollar/foreman">Foreman</a>?</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span> foreman start
</code></pre></div>
<p>You get the point. There are way too many ways to start a web application. We
need to <strong>standardize</strong> this into something flexible like <code>./bin/start</code>.</p>

<p>One of our latest <code>bin/start</code> scripts looks like this:</p>

<script src="https://gist.github.com/etagwerker/e38b8021c0028f20d1f19932716d2c67.js">
</script>

<p>From now on, all the web applications that we build at <a href="https://www.ombulabs.com">Ombu Labs</a>
will be able to get started like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>./bin/start
</code></pre></div>
<p>It won&#39;t matter if we use Foreman, Sinatra,
<a href="https://rubygems.org/gems/cuba">Cuba</a>, Rails, Shotgun, or whatever.
<code>bin/start</code> will know how to get the application started in a development
environment.</p>

<h2>Why</h2>

<p>I love how simple it can be to tell anyone to clone the project and run these
steps:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>cd path/to/project
./bin/setup
./bin/start
</code></pre></div>
<p>A web designer that has no experience with Ruby/Rails can setup and start a
web application in a few minutes.</p>

<p>I&#39;m a big fan of <a href="http://c2.com/cgi/wiki?ConventionOverConfiguration">Convention over Configuration</a>. Also, I hate
it when it takes me half a day to setup a new application in my environment. It
should <strong>never</strong> take more than a few minutes.</p>
]]></content:encoded>
      <dc:date>2016-07-04T08:31:00-04:00</dc:date>
    </item>
    <item>
      <title>Tips for upgrading from Rails 3.2 to 4.0</title>
      <link>https://www.ombulabs.com/blog/rails/tips-for-upgrading-rails-3-2-to-4.html</link>
      <description><![CDATA[There are already quite a few guides in the wild to help with the upgrade of
Rails 3.2 to Rails 4.0.
The official Rails guide
for upgrading from Rails 3.2 to 4.0 is very thorough.
With the recent release of Rails 5.0, apps currently in production running
Rails 3.2 should probably be updated to any stable Rails 4 release as soon as
possible.

There is even an e-book about
upgrading from Rails 3 to 4,
which serves as a useful guide to make this upgrade easier, and also helps
understand the advantages &amp; disadvantages of this new (soon to be old) version.

However, if you&#39;re using any non-standard gems, you&#39;re mostly on your own. Some
gems stopped being maintained before Rails 4 was released, as was the case
with CanCan, a well known authorization
library. After many open pull requests were left unmerged,
CanCanCan was released.
It is a community driven effort to have a semi-official fork of CanCan.
It serves as a drop-in replacement for people who want to use CanCan after
upgrading to Rails 4.
]]></description>
      <pubDate>Fri, 01 Jul 2016 14:37:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/tips-for-upgrading-rails-3-2-to-4.html</guid>
      <content:encoded><![CDATA[<p>There are already quite a few guides in the wild to help with the upgrade of
Rails 3.2 to Rails 4.0.
The <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#upgrading-from-rails-3-2-to-rails-4-0">official Rails guide</a>
for upgrading from Rails 3.2 to 4.0 is very thorough.
With the recent release of Rails 5.0, apps currently in production running
Rails 3.2 should probably be updated to any stable Rails 4 release as soon as
possible.</p>

<p>There is even an e-book about
<a href="https://github.com/alindeman/upgradingtorails4">upgrading from Rails 3 to 4</a>,
which serves as a useful guide to make this upgrade easier, and also helps
understand the advantages &amp; disadvantages of this new (soon to be old) version.</p>

<p>However, if you&#39;re using any non-standard gems, you&#39;re mostly on your own. Some
gems stopped being maintained before Rails 4 was released, as was the case
with <a href="https://github.com/ryanb/cancan">CanCan</a>, a well known authorization
library. After many open pull requests were left <a href="https://github.com/ryanb/cancan/pulls">unmerged</a>,
<a href="https://github.com/CanCanCommunity/cancancan">CanCanCan</a> was released.
It is a community driven effort to have a semi-official fork of CanCan.
It serves as a drop-in replacement for people who want to use CanCan after
upgrading to Rails 4.</p>

<!--more-->

<p>Along with the e-book I mentioned, the author released
<a href="https://github.com/alindeman/rails4_upgrade">a gem</a> which you can add to your
Rails 3 project. It includes a Rake task that will help you with the upgrade:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>➜  myproject git:(develop) ✗ bundle exec rake rails4:check

** GEM COMPATIBILITY CHECK **
+------------------------------------------+----------------------------+
| Dependency Path                          | Rails Requirement          |
+------------------------------------------+----------------------------+
| devise 2.1.4                             | railties ~&gt; 3.1            |
| devise-encryptable 0.2.0 -&gt; devise 2.1.4 | railties ~&gt; 3.1            |
| friendly_id 4.0.10.1                     | activerecord &lt; 4.0, &gt;= 3.0 |
| strong_parameters 0.2.3                  | actionpack ~&gt; 3.0          |
| strong_parameters 0.2.3                  | activemodel ~&gt; 3.0         |
| strong_parameters 0.2.3                  | activesupport ~&gt; 3.0       |
| strong_parameters 0.2.3                  | railties ~&gt; 3.0            |
+------------------------------------------+----------------------------+
</code></pre></div>
<p>Now instead of going through your currently bundled gems or Gemfile.lock
manually, you get a report of what gems you need to upgrade.</p>

<p>For an overview of your outdated gems, there&#39;s also <code>bundle outdated</code>, which you
can run on any project:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>➜  myproject git:(develop) ✗ bundle outdated
Fetching gem metadata from http://rubygems.org/........
Fetching version metadata from http://rubygems.org/...
Fetching dependency metadata from http://rubygems.org/..
Resolving dependencies..........................................

Outdated gems included in the bundle:
  * aasm (newest 4.11.0, installed 3.0.26, requested ~&gt; 3.0.22)
  * activemerchant (newest 1.59.0, installed 1.47.0, requested ~&gt; 1.47.0)
  * acts_as_list (newest 0.7.4, installed 0.7.2, requested ~&gt; 0.7.2)
  * airbrake (newest 5.4.1, installed 4.1.0, requested ~&gt; 4.1.0)
  * awesome_nested_set (newest 3.1.1, installed 2.1.6, requested ~&gt; 2.1.6)
  * aws-sdk (newest 2.3.17, installed 1.64.0, requested ~&gt; 1.64.0)
  * byebug (newest 9.0.5, installed 5.0.0, requested ~&gt; 5.0.0)
  * cancancan (newest 1.15.0, installed 1.13.1, requested ~&gt; 1.10)
  * capistrano (newest 3.5.0, installed 3.4.0, requested ~&gt; 3.0)
  * capistrano-rails (newest 1.1.7, installed 1.1.5, requested ~&gt; 1.1)
  * capybara (newest 2.8.0.dev 59d21b5, installed 2.6.0.dev 3723805)
  * capybara-webkit (newest 1.11.1, installed 1.7.1)
  * codeclimate-test-reporter (newest 0.6.0, installed 0.4.8)
  * compass (newest 1.0.3, installed 0.12.7)
  * compass-rails (newest 3.0.2, installed 2.0.0)
  * cucumber (newest 2.4.0, installed 1.3.20, requested ~&gt; 1.3.10)
  * cucumber-rails (newest 1.4.3, installed 1.4.2, requested ~&gt; 1.4.0)
  * database_cleaner (newest 1.5.3, installed 1.5.1, requested ~&gt; 1.5.1)
  * devise (newest 4.1.1, installed 2.1.4, requested ~&gt; 2.1.0)
  * ...
</code></pre></div>
<p>Last but not least, there&#39;s the <code>rails:update</code>
<a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#the-update-task">task</a>,
which you can use as a guideline as explained very clearly in
<a href="http://thomasleecopeland.com/2015/08/06/running-rails-update.html">this post</a>
to get rid of unnecessary code or monkey-patches, especially if your Rails 3
app was previously running on Rails 2.</p>
]]></content:encoded>
      <dc:date>2016-07-01T14:37:00-04:00</dc:date>
    </item>
    <item>
      <title>Introducing Pecas: Dashboards for Freckle</title>
      <link>https://www.ombulabs.com/blog/open-source/introducing-pecas.html</link>
      <description><![CDATA[At Ombu Labs we are big fans and happy customers
of Freckle. We use their widget to track all the
hours that we spend on client projects,
open source development, and
our own products.

Today I&#39;m happy to introduce Pecas, time tracking leaderboards for Freckle! Pecas is an
open source tool that integrates with your
account and generates beautiful leaderboards per project and per teammate.

Here is a sample dashboard for all your projects:



On top of that, it will send you an email alert if you haven&#39;t tracked any hours
during a work day. If it&#39;s a holiday, it won&#39;t bother you. :)
]]></description>
      <pubDate>Mon, 06 Jun 2016 05:31:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/open-source/introducing-pecas.html</guid>
      <content:encoded><![CDATA[<p>At <a href="https://www.ombulabs.com">Ombu Labs</a> we are big fans and happy customers
of <a href="https://letsfreckle.com/">Freckle</a>. We use their widget to track all the
hours that we spend on client projects,
<a href="https://www.ombulabs.com/#open-source">open source</a> development, and
<a href="https://www.ombulabs.com/#products">our own products</a>.</p>

<p>Today I&#39;m happy to introduce <a href="http://ombulabs.github.io/pecas/">Pecas, time tracking leaderboards for Freckle</a>! <strong>Pecas</strong> is an
<a href="http://github.com/ombulabs/pecas">open source</a> tool that integrates with your
account and generates beautiful leaderboards per project and per teammate.</p>

<p>Here is a sample dashboard for all your projects:</p>

<p><img src="/blog/assets/images/pecas_by_project.jpg" alt="A sample leaderboard in the Pecas web interface" class="full-img"></p>

<p>On top of that, it will send you an <em>email alert</em> if you haven&#39;t tracked any hours
during a work day. If it&#39;s a holiday, it won&#39;t bother you. :)</p>

<!--more-->

<p>I like to check it out every week to see if we are on track for our <a href="https://www.ombulabs.com/blog/software-development/time-and-material.html">time and material</a>
projects. We need to work 40 hours per week for some of our clients and it&#39;s a
good way to detect deviations.</p>

<p>To build this small application we decided to use
<a href="http://rubyonrails.org/">Rails 4.2</a> and the
<a href="http://developer.letsfreckle.com/#overview">Freckle API v2</a>. You can easily
set it up using <a href="http://heroku.com">Heroku</a> and your Freckle API key: <a href="https://github.com/ombulabs/pecas#first-time-only">https://github.com/ombulabs/pecas#first-time-only</a></p>

<p>If you like <a href="https://letsfreckle.com">Freckle</a> as much as we do, feel free to
<strong>fork Pecas</strong> in <a href="https://github.com/ombulabs">Github</a>: <a href="https://github.com/ombulabs/pecas">https://github.com/ombulabs/pecas</a></p>
]]></content:encoded>
      <dc:date>2016-06-06T05:31:00-04:00</dc:date>
    </item>
    <item>
      <title>A comprehensive guide to interacting with IMAP using Ruby</title>
      <link>https://www.ombulabs.com/blog/ruby/imap/a-comprehensive-guide-to-interacting-with-imap-using-ruby.html</link>
      <description><![CDATA[A few times in the past I&#39;ve had to interact with IMAP via Ruby, and wrapping
your head around its API is not so easy. Not only is the IMAP API
a bit obscure and cryptic, but Ruby&#39;s IMAP documentation
is not so great either.

Searching the internet for examples doesn&#39;t yield too many results, so I&#39;ll try
to write down some of the things I&#39;ve learned. The examples I&#39;ll show use
Gmail as the target IMAP server.
]]></description>
      <pubDate>Mon, 30 May 2016 08:09:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/ruby/imap/a-comprehensive-guide-to-interacting-with-imap-using-ruby.html</guid>
      <content:encoded><![CDATA[<p>A few times in the past I&#39;ve had to interact with IMAP via Ruby, and wrapping
your head around its API is not so easy. Not only is the <a href="https://tools.ietf.org/html/rfc3501">IMAP API</a>
a bit obscure and cryptic, but Ruby&#39;s IMAP <a href="http://ruby-doc.org/stdlib-2.2.3/libdoc/net/imap/rdoc/Net/IMAP.html">documentation</a>
is not so great either.</p>

<p>Searching the internet for examples doesn&#39;t yield too many results, so I&#39;ll try
to write down some of the things I&#39;ve learned. The examples I&#39;ll show use
Gmail as the target IMAP server.</p>

<!--more-->

<h2>Connecting and logging in</h2>

<p>To establish an IMAP connection:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">IMAP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;imap.googlemail.com&quot;</span><span class="p">,</span> <span class="mi">993</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Net::IMAP:0x007fde6b1a8ff0 ...</span>
</code></pre></div>
<p>The third parameter here is <code>usessl</code>, it&#39;s set to <code>false</code> by
<a href="https://github.com/ruby/ruby/blob/trunk/lib/net/imap.rb#L1065">default</a>.</p>

<p><em>If</em> you run into any SSL issues and want to ignore them, you can use:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">IMAP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;imap.googlemail.com&quot;</span><span class="p">,</span> <span class="mi">993</span><span class="p">,</span> <span class="kp">true</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Net::IMAP:0x007fa1c77064b0 ...</span>
</code></pre></div>
<p>which skips SSL verification. Note that while this is probably not such a good
idea, even the most popular Gmail Ruby gem,
<a href="https://github.com/gmailgem/gmail/blob/353ddcc8cc0c5b57ad1d3a412f11365ccc12b7d6/lib/gmail/client/base.rb#L26">Gmail</a>,
does this.</p>

<p>After the connection is established, you can login using a couple of different
ways. First, the most common way, using email and password:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;struct Net::IMAP::TaggedResponse</span>
 <span class="nb">name</span><span class="o">=</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span>
 <span class="n">raw_data</span><span class="o">=</span><span class="s2">&quot;RUBY0001 OK c3p0@ombulabs.com authenticated (Success)</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="o">&gt;</span>
</code></pre></div>
<p>Second, you can include the <a href="https://github.com/nfo/gmail_xoauth">gmail_xoauth</a>
gem, which adds the XOAUTH2 authenticator to <code>Net::IMAP</code>, allowing you to use an
OAuth 2.0 token to login:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s2">&quot;LOGIN&quot;</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">your_oauth2_token</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;struct Net::IMAP::TaggedResponse ...</span>
</code></pre></div>
<h2>Listing available mailboxes</h2>

<p>To list all of your mailboxes:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;struct Net::IMAP::MailboxList attr=[:All, :Hasnochildren], delim=&quot;/&quot;, name=&quot;[Gmail]/All Mail&quot;&gt;,</span>
 <span class="c1">#&lt;struct Net::IMAP::MailboxList attr=[:Drafts, :Hasnochildren], delim=&quot;/&quot;, name=&quot;[Gmail]/Drafts&quot;&gt;,</span>
 <span class="c1">#&lt;struct Net::IMAP::MailboxList attr=[:Hasnochildren, :Important], delim=&quot;/&quot;, name=&quot;[Gmail]/Important&quot;&gt;,</span>
 <span class="c1">#&lt;struct Net::IMAP::MailboxList attr=[:Hasnochildren, :Sent], delim=&quot;/&quot;, name=&quot;[Gmail]/Sent Mail&quot;&gt;,</span>
 <span class="c1">#&lt;struct Net::IMAP::MailboxList attr=[:Hasnochildren, :Junk], delim=&quot;/&quot;, name=&quot;[Gmail]/Spam&quot;&gt;,</span>
 <span class="c1">#&lt;struct Net::IMAP::MailboxList attr=[:Flagged, :Hasnochildren], delim=&quot;/&quot;, name=&quot;[Gmail]/Starred&quot;&gt;,</span>
 <span class="c1">#&lt;struct Net::IMAP::MailboxList attr=[:Hasnochildren, :Trash], delim=&quot;/&quot;, name=&quot;[Gmail]/Trash&quot;&gt;]</span>
</code></pre></div>
<p>To search your mailboxes by name, using <code>*</code> as a wildcard character:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;*Mail&quot;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;struct Net::IMAP::MailboxList attr=[:All, :Hasnochildren], delim=&quot;/&quot;, name=&quot;[Gmail]/All Mail&quot;&gt;,</span>
 <span class="c1">#&lt;struct Net::IMAP::MailboxList attr=[:Hasnochildren, :Sent], delim=&quot;/&quot;, name=&quot;[Gmail]/Sent Mail&quot;&gt;]</span>
</code></pre></div>
<h2>Selecting a mailbox</h2>

<p>Most IMAP interactions require having selected a mailbox before doing them.
There are two ways to do so:</p>

<p>Read-only:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">6</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">examine</span><span class="p">(</span><span class="s2">&quot;[Gmail]/All Mail&quot;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;struct Net::IMAP::TaggedResponse</span>
 <span class="nb">name</span><span class="o">=</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span>
 <span class="n">raw_data</span><span class="o">=</span><span class="s2">&quot;RUBY0014 OK [READ-ONLY] [Gmail]/All Mail selected. (Success)</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="o">&gt;</span>
</code></pre></div>
<p>Read and write:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">7</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;[Gmail]/All Mail&quot;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;struct Net::IMAP::TaggedResponse</span>
 <span class="nb">name</span><span class="o">=</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span>
 <span class="n">raw_data</span><span class="o">=</span><span class="s2">&quot;RUBY0015 OK [READ-WRITE] [Gmail]/All Mail selected. (Success)</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="o">&gt;</span>
</code></pre></div>
<h2>Searching email messages</h2>

<p>After selecting an email box, you can search email messages and find either
the sequence number (<code>seqno</code>) or unique id (<code>uid</code>) for the email.</p>

<p>The sequence number indicates the <em>current position</em> of the email message in the
mailbox. So this number will be different after email messages before this email
get moved to a different mailbox, or if they get deleted:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># Search emails which have a subject that includes the word Jedi and return the sequence number.</span>
<span class="o">[</span><span class="mi">8</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="o">[</span><span class="s2">&quot;SUBJECT&quot;</span><span class="p">,</span> <span class="s2">&quot;Jedi&quot;</span><span class="o">]</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="mi">12</span><span class="o">]</span>

<span class="c1"># From within Gmail, we delete one of our very first emails in the All Mail box and then make the same search we did before.</span>

<span class="o">[</span><span class="mi">9</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="o">[</span><span class="s2">&quot;SUBJECT&quot;</span><span class="p">,</span> <span class="s2">&quot;Jedi&quot;</span><span class="o">]</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="mi">11</span><span class="o">]</span>
</code></pre></div>
<p>The unique id is a unique identifier for the email in a mailbox. So even if the
email&#39;s position moves, the <code>uid</code> remains the same:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># Search emails which have a subject that includes the word Jedi and return the unique id.</span>
<span class="o">[</span><span class="mi">10</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">uid_search</span><span class="p">(</span><span class="o">[</span><span class="s2">&quot;SUBJECT&quot;</span><span class="p">,</span> <span class="s2">&quot;Jedi&quot;</span><span class="o">]</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="mi">23</span><span class="o">]</span>

<span class="c1"># From within Gmail, we delete one of our very first emails in the All Mail box and then make the same search we did before.</span>

<span class="o">[</span><span class="mi">11</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">uid_search</span><span class="p">(</span><span class="o">[</span><span class="s2">&quot;SUBJECT&quot;</span><span class="p">,</span> <span class="s2">&quot;Jedi&quot;</span><span class="o">]</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="mi">23</span><span class="o">]</span>
</code></pre></div>
<h2>Fetching email messages</h2>

<p>After we selected a mailbox and we know a message&#39;s <code>seqno</code> or <code>uid</code>, we can
fetch the email headers, content, flags, <a href="https://tools.ietf.org/html/rfc3501#page-57">among others</a>.
If you know the <code>seqno</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">12</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;ENVELOPE&quot;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;struct Net::IMAP::FetchData</span>
  <span class="n">seqno</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
  <span class="kp">attr</span><span class="o">=</span>
   <span class="p">{</span><span class="s2">&quot;ENVELOPE&quot;</span><span class="o">=&gt;</span>
     <span class="c1">#&lt;struct Net::IMAP::Envelope</span>
      <span class="n">date</span><span class="o">=</span><span class="s2">&quot;Thu, 12 Feb 2015 14:55:38 -0300&quot;</span><span class="p">,</span>
      <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;Wanna be a Jedi?&quot;</span><span class="p">,</span>
      <span class="n">from</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Mauro Otonelli&quot;, route=nil, mailbox=&quot;mauro&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">sender</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Mauro Otonelli&quot;, route=nil, mailbox=&quot;mauro&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">reply_to</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Mauro Otonelli&quot;, route=nil, mailbox=&quot;mauro&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">to</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;C3P0 Tripio&quot;, route=nil, mailbox=&quot;c3p0&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">cc</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">bcc</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">in_reply_to</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">message_id</span><span class="o">=</span><span class="s2">&quot;&lt;CBM2vBoqhzb_t4P8BFdGLZFnOHsUJDo1P-TkGbU_EGqxGVfZCyQ@mail.gmail.com&gt;&quot;</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&gt;]</span>
</code></pre></div>
<p>If you know the <code>uid</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">13</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">uid_fetch</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="s2">&quot;ENVELOPE&quot;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;struct Net::IMAP::FetchData</span>
  <span class="n">seqno</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
  <span class="kp">attr</span><span class="o">=</span>
   <span class="p">{</span><span class="s2">&quot;UID&quot;</span><span class="o">=&gt;</span><span class="mi">23</span><span class="p">,</span>
    <span class="s2">&quot;ENVELOPE&quot;</span><span class="o">=&gt;</span>
     <span class="c1">#&lt;struct Net::IMAP::Envelope</span>
      <span class="n">date</span><span class="o">=</span><span class="s2">&quot;Thu, 12 Feb 2015 14:55:38 -0300&quot;</span><span class="p">,</span>
      <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;Wanna be a Jedi?&quot;</span><span class="p">,</span>
      <span class="n">from</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Mauro Otonelli&quot;, route=nil, mailbox=&quot;mauro&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">sender</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Mauro Otonelli&quot;, route=nil, mailbox=&quot;mauro&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">reply_to</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Mauro Otonelli&quot;, route=nil, mailbox=&quot;mauro&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">to</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;C3P0 Tripio&quot;, route=nil, mailbox=&quot;c3p0&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">cc</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">bcc</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">in_reply_to</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">message_id</span><span class="o">=</span><span class="s2">&quot;&lt;CBM2vBoqhzb_t4P8BFdGLZFnOHsUJDo1P-TkGbU_EGqxGVfZCyQ@mail.gmail.com&gt;&quot;</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&gt;]</span>
</code></pre></div>
<p>If you wanted to fetch a range of <code>uid</code>s, you can use a range:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">14</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">uid_fetch</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">23</span><span class="p">,</span> <span class="s2">&quot;ENVELOPE&quot;</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="o">[</span><span class="c1">#&lt;struct Net::IMAP::FetchData</span>
  <span class="n">seqno</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
  <span class="kp">attr</span><span class="o">=</span>
   <span class="p">{</span><span class="s2">&quot;UID&quot;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;ENVELOPE&quot;</span><span class="o">=&gt;</span>
     <span class="c1">#&lt;struct Net::IMAP::Envelope</span>
      <span class="n">date</span><span class="o">=</span><span class="s2">&quot;Wed, 19 Nov 2014 12:01:13 -0800&quot;</span><span class="p">,</span>
      <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;How to use Gmail with Google Apps&quot;</span><span class="p">,</span>
      <span class="n">from</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Gmail Team&quot;, route=nil, mailbox=&quot;mail-noreply&quot;, host=&quot;google.com&quot;&gt;],</span>
      <span class="n">sender</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Gmail Team&quot;, route=nil, mailbox=&quot;mail-noreply&quot;, host=&quot;google.com&quot;&gt;],</span>
      <span class="n">reply_to</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Gmail Team&quot;, route=nil, mailbox=&quot;mail-noreply&quot;, host=&quot;google.com&quot;&gt;],</span>
      <span class="n">to</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;C3P0 Tripio&quot;, route=nil, mailbox=&quot;c3p0&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">cc</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">bcc</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">in_reply_to</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">message_id</span><span class="o">=</span><span class="s2">&quot;&lt;CALqaawdvBhnXcFZ3ztSro8OcdLoRGt-Q0rSWTe7YXjR37dxrzQ@mail.gmail.com&gt;&quot;</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="c1">#&lt;struct Net::IMAP::FetchData</span>
  <span class="n">seqno</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
  <span class="kp">attr</span><span class="o">=</span>
   <span class="p">{</span><span class="s2">&quot;UID&quot;</span><span class="o">=&gt;</span><span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;ENVELOPE&quot;</span><span class="o">=&gt;</span>
     <span class="c1">#&lt;struct Net::IMAP::Envelope</span>
      <span class="n">date</span><span class="o">=</span><span class="s2">&quot;Wed, 19 Nov 2014 12:01:14 -0800&quot;</span><span class="p">,</span>
      <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;The best of Gmail, wherever you are&quot;</span><span class="p">,</span>
      <span class="n">from</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Gmail Team&quot;, route=nil, mailbox=&quot;mail-noreply&quot;, host=&quot;google.com&quot;&gt;],</span>
      <span class="n">sender</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Gmail Team&quot;, route=nil, mailbox=&quot;mail-noreply&quot;, host=&quot;google.com&quot;&gt;],</span>
      <span class="n">reply_to</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;Gmail Team&quot;, route=nil, mailbox=&quot;mail-noreply&quot;, host=&quot;google.com&quot;&gt;],</span>
      <span class="n">to</span><span class="o">=[</span><span class="c1">#&lt;struct Net::IMAP::Address name=&quot;C3P0 Tripio&quot;, route=nil, mailbox=&quot;c3p0&quot;, host=&quot;ombulabs.com&quot;&gt;],</span>
      <span class="n">cc</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">bcc</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">in_reply_to</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span>
      <span class="n">message_id</span><span class="o">=</span><span class="s2">&quot;&lt;CALqaaweWj3TZUS_0=Rg45G+XgHwORk2JG_BpB2DHB3UPMR8WDg@mail.gmail.com&gt;&quot;</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&gt;</span><span class="p">,</span>
<span class="c1">#&lt;struct Net::IMAP::FetchData</span>
 <span class="n">seqno</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
 <span class="kp">attr</span><span class="o">=</span>
  <span class="p">{</span><span class="s2">&quot;UID&quot;</span><span class="o">=&gt;</span><span class="mi">3</span><span class="p">,</span>
   <span class="s2">&quot;ENVELOPE&quot;</span><span class="o">=&gt;</span>
    <span class="c1">#&lt;struct Net::IMAP::Envelope</span>
    <span class="o">...</span>
</code></pre></div>
<h2>Logging out and disconnecting from the server</h2>

<p>There is a usually a limit to the maximum amount of connections you can have
open to an IMAP server. Gmail for example, limits this to 15.
To correctly close an IMAP connection, you first need to log out, and then
disconnect from the server. You can use the <code>disconnected?</code> method to check
if you&#39;ve actually closed the connection:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">15</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">imap</span><span class="o">.</span><span class="n">logout</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;struct Net::IMAP::TaggedResponse</span>
 <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;RUBY0002&quot;</span><span class="p">,</span>
 <span class="nb">name</span><span class="o">=</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span>
 <span class="n">data</span><span class="o">=</span><span class="c1">#&lt;struct Net::IMAP::ResponseText code=nil, text=&quot;73 good day (Success)&quot;&gt;,</span>
 <span class="n">raw_data</span><span class="o">=</span><span class="s2">&quot;RUBY0002 OK 73 good day (Success)</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="o">&gt;</span>
<span class="n">imap</span><span class="o">.</span><span class="n">disconnected?</span>
<span class="o">=&gt;</span> <span class="kp">false</span>
<span class="n">imap</span><span class="o">.</span><span class="n">disconnect</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="n">imap</span><span class="o">.</span><span class="n">disconnected?</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div>
<p>I hope this guide was useful, I tried to cover the most important operations,
but there&#39;s obviously more, such as deleting emails, marking emails as read,
adding emails to a mailbox, etc. If you&#39;ve struggled with IMAP like I have, or
if you found this useful, let me know in the comments section!</p>
]]></content:encoded>
      <dc:date>2016-05-30T08:09:00-04:00</dc:date>
    </item>
    <item>
      <title>DRY your tests</title>
      <link>https://www.ombulabs.com/blog/rails/dry/dry-your-test-unit.html</link>
      <description><![CDATA[I&#39;m a big fan of having small classes. I&#39;m not a big fan of having huge specs for
a small class/object. Every time I see an opportunity to
DRY my specs, I take it.

Today I wrote a spec to make sure that we gracefully ignore SPAMmy
contact requests in the Ombu Labs
contact page. It initially looked like this:
test &quot;gracefully ignores spammy requests with valid attributes&quot; do
  @valid_contact = contacts(:two)
  attributes = @valid_contact.attributes
                             .merge(email_confirmation: @valid_contact.email)

  assert_no_difference(&quot;Contact.count&quot;) do
    post :create, contact: attributes, format: &#39;js&#39;
  end

  assert_response :success
end

The new behavior adds a simple SPAM trap field
that bots will usually fall for.
If a bot is submitting the email_confirmation field (which is hidden by a CSS
class), then it is SPAM and it gracefully ignores the request.
]]></description>
      <pubDate>Mon, 16 May 2016 08:31:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/dry/dry-your-test-unit.html</guid>
      <content:encoded><![CDATA[<p>I&#39;m a big fan of having small classes. I&#39;m not a big fan of having huge specs for
a small class/object. Every time I see an opportunity to
<a href="http://c2.com/cgi/wiki?DontRepeatYourself">DRY</a> my specs, I take it.</p>

<p>Today I wrote a spec to make sure that we gracefully ignore SPAMmy
contact requests in the Ombu Labs
<a href="https://www.ombulabs.com/contact">contact page</a>. It initially looked like this:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="nb">test</span> <span class="s2">&quot;gracefully ignores spammy requests with valid attributes&quot;</span> <span class="k">do</span>
  <span class="vi">@valid_contact</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">(</span><span class="ss">:two</span><span class="p">)</span>
  <span class="n">attributes</span> <span class="o">=</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">attributes</span>
                             <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">email_confirmation</span><span class="p">:</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>

  <span class="n">assert_no_difference</span><span class="p">(</span><span class="s2">&quot;Contact.count&quot;</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">contact</span><span class="p">:</span> <span class="n">attributes</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;js&#39;</span>
  <span class="k">end</span>

  <span class="n">assert_response</span> <span class="ss">:success</span>
<span class="k">end</span>
</code></pre></div>
<p>The new behavior adds a simple <a href="http://www.sitepoint.com/easy-spam-prevention-using-hidden-form-fields/">SPAM trap field</a>
that bots will usually fall for.
If a bot is submitting the <code>email_confirmation</code> field (which is hidden by a CSS
class), then it is <strong>SPAM</strong> and it gracefully ignores the request.</p>

<!--more-->

<p>The test only tests the scenario where the bot is performing an <strong>AJAX</strong>
request. Then I thought that SPAM bots might try to submit a non-AJAX <code>html</code>
request.</p>

<p>So I wrote some more:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="nb">test</span> <span class="s2">&quot;gracefully ignores spammy requests with valid attributes (AJAX)&quot;</span> <span class="k">do</span>
  <span class="vi">@valid_contact</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">(</span><span class="ss">:two</span><span class="p">)</span>
  <span class="n">attributes</span> <span class="o">=</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">attributes</span>
  <span class="n">attributes</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="ss">email_confirmation</span><span class="p">:</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>

  <span class="n">assert_no_difference</span><span class="p">(</span><span class="s2">&quot;Contact.count&quot;</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">contact</span><span class="p">:</span> <span class="n">attributes</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;js&#39;</span>
  <span class="k">end</span>

  <span class="n">assert_response</span> <span class="ss">:success</span>
<span class="k">end</span>

<span class="nb">test</span> <span class="s2">&quot;gracefully ignores spammy requests with valid attributes (HTML)&quot;</span> <span class="k">do</span>
  <span class="vi">@valid_contact</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">(</span><span class="ss">:two</span><span class="p">)</span>
  <span class="n">attributes</span> <span class="o">=</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">attributes</span>
  <span class="n">attributes</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="ss">email_confirmation</span><span class="p">:</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>

  <span class="n">assert_no_difference</span><span class="p">(</span><span class="s2">&quot;Contact.count&quot;</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">contact</span><span class="p">:</span> <span class="n">attributes</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;html&#39;</span>
  <span class="k">end</span>

  <span class="n">assert_response</span> <span class="ss">:success</span>
<span class="k">end</span>
</code></pre></div>
<p>Now that is <strong>ridiculous</strong>, why should I <strong>copy/paste</strong> this? There is only one
parameter (<code>format</code>) that varies between them.</p>

<p>So, I <a href="http://c2.com/cgi/wiki?RefactorMercilessly">refactored</a> the code to
look like this:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="s2">&quot;js&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
  <span class="nb">test</span> <span class="s2">&quot;gracefully ignores spammy requests with valid attributes&quot;</span> <span class="k">do</span>
    <span class="vi">@valid_contact</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">(</span><span class="ss">:two</span><span class="p">)</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">attributes</span>
    <span class="n">attributes</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="ss">email_confirmation</span><span class="p">:</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>

    <span class="n">assert_no_difference</span><span class="p">(</span><span class="s2">&quot;Contact.count&quot;</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">contact</span><span class="p">:</span> <span class="n">attributes</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">format</span>
    <span class="k">end</span>

    <span class="n">assert_response</span> <span class="ss">:success</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>The code above doesn&#39;t <em>really</em> work. It raises this exception:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>/Users/etagwerker/.rvm/gems/ruby-2.2.1@ombulabs-com/gems/activesupport-3.2.17/lib/active_support/testing/declarative.rb:28:in `test&#39;: test_should_gracefully_ignore_spammy_requests_with_valid_attributes is already defined in ContactsControllerTest (RuntimeError)
    from /Users/etagwerker/Projects/ombulabs.com/test/functional/contacts_controller_test.rb:29:in `block in &lt;class:ContactsControllerTest&gt;&#39;
    from /Users/etagwerker/Projects/ombulabs.com/test/functional/contacts_controller_test.rb:28:in `each&#39;
    from /Users/etagwerker/Projects/ombulabs.com/test/functional/contacts_controller_test.rb:28:in `&lt;class:ContactsControllerTest&gt;&#39;
    from /Users/etagwerker/Projects/ombulabs.com/test/functional/contacts_controller_test.rb:3:in `&lt;top (required)&gt;&#39;
    from /Users/etagwerker/.rvm/gems/ruby-2.2.1@ombulabs-com/gems/rake-10.5.0/lib/rake/rake_test_loader.rb:10:in `require&#39;
    from /Users/etagwerker/.rvm/gems/ruby-2.2.1@ombulabs-com/gems/rake-10.5.0/lib/rake/rake_test_loader.rb:10:in `block (2 levels) in &lt;main&gt;&#39;
    from /Users/etagwerker/.rvm/gems/ruby-2.2.1@ombulabs-com/gems/rake-10.5.0/lib/rake/rake_test_loader.rb:9:in `each&#39;
    from /Users/etagwerker/.rvm/gems/ruby-2.2.1@ombulabs-com/gems/rake-10.5.0/lib/rake/rake_test_loader.rb:9:in `block in &lt;main&gt;&#39;
    from /Users/etagwerker/.rvm/gems/ruby-2.2.1@ombulabs-com/gems/rake-10.5.0/lib/rake/rake_test_loader.rb:4:in `select&#39;
    from /Users/etagwerker/.rvm/gems/ruby-2.2.1@ombulabs-com/gems/rake-10.5.0/lib/rake/rake_test_loader.rb:4:in `&lt;main&gt;&#39;
Errors running test:functionals! #&lt;RuntimeError: Command failed with status (1): [ruby -I&quot;lib:test&quot; -I&quot;/Users/etagwerker/.rvm/gems/ruby-2.2.1@ombulabs-com/gems/rake-10.5.0/lib&quot; &quot;/Users/etagwerker/.rvm/gems/ruby-2.2.1@ombulabs-com/gems/rake-10.5.0/lib/rake/rake_test_loader.rb&quot; &quot;test/functional/**/*_test.rb&quot; ]&gt;
</code></pre></div>
<p>Basically <a href="https://rubygems.org/gems/test-unit">test-unit</a> doesn&#39;t want
me to define a test with the same description more than once.</p>

<p>So, I decided to interpolate the format variable in the test description:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="s2">&quot;js&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
  <span class="nb">test</span> <span class="s2">&quot;gracefully ignores spammy requests in </span><span class="si">#{</span><span class="nb">format</span><span class="si">}</span><span class="s2"> format&quot;</span> <span class="k">do</span>
    <span class="vi">@valid_contact</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">(</span><span class="ss">:two</span><span class="p">)</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">attributes</span>
    <span class="n">attributes</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="ss">email_confirmation</span><span class="p">:</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>

    <span class="n">assert_no_difference</span><span class="p">(</span><span class="s2">&quot;Contact.count&quot;</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">contact</span><span class="p">:</span> <span class="n">attributes</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">format</span>
    <span class="k">end</span>

    <span class="n">assert_response</span> <span class="ss">:success</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Test Unit is happy with this, the tests pass and my spec code is as concise as
possible.</p>

<p>If you prefer <a href="https://rubygems.org/gems/rspec">RSpec</a>, it would look like
this:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="s2">&quot;js&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
  <span class="n">it</span> <span class="s2">&quot;gracefully ignores spammy requests with valid attributes&quot;</span> <span class="k">do</span>
    <span class="vi">@valid_contact</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">(</span><span class="ss">:two</span><span class="p">)</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">attributes</span>
    <span class="n">attributes</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="ss">email_confirmation</span><span class="p">:</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>

    <span class="n">expect</span> <span class="k">do</span>
      <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">contact</span><span class="p">:</span> <span class="n">attributes</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">format</span>
    <span class="k">end</span><span class="o">.</span><span class="n">not_to</span> <span class="n">change</span><span class="p">(</span><span class="no">Contact</span><span class="p">,</span> <span class="ss">:count</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_success</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>RSpec is a little smarter than Test Unit and it doesn&#39;t require you to
interpolate a variable (<code>format</code>) in the description.</p>

<p>Either way, <strong>always</strong> look for ways to keep your tests as <em>DRY</em> as your
classes. It will <strong>improve maintenance</strong> in the long run.</p>
]]></content:encoded>
      <dc:date>2016-05-16T08:31:00-04:00</dc:date>
    </item>
    <item>
      <title>The Joys and Woes of Pair Programming</title>
      <link>https://www.ombulabs.com/blog/agile/pair-programming/joys-and-woes-of-pair-programming.html</link>
      <description><![CDATA[There are a few agile practices that I really love. Pair programming
is one of them.

We try to do it as much as possible at Ombu Labs. We
usually keep the sessions under two hours and try to follow a regular
schedule.

When we find ourselves blocked by a code problem, we use our daily scrum to
coordinate a pairing session. It&#39;s quite a step up from rubberducking or using a cardboard programmer to find a solution
to a problem.



The Joys

As a Senior developer, I find that pairing sessions are great for coaching
Junior developers. I enjoy teaching them about best practices, design
patterns, frameworks, languages, code style,
XP, and
TDD.

From the point of view of a Junior developer, I believe it&#39;s a
great opportunity to learn from someone who &quot;has been there before&quot;.
When you program with someone with more experience, you will often learn about
design patterns, elegant object-oriented solutions, tips and tricks.
]]></description>
      <pubDate>Thu, 12 May 2016 10:37:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/agile/pair-programming/joys-and-woes-of-pair-programming.html</guid>
      <content:encoded><![CDATA[<p>There are a few <a href="https://en.wikipedia.org/wiki/Agile_software_development#Agile_practices">agile practices</a> that <strong>I really love</strong>. <a href="http://c2.com/cgi/wiki?PairProgramming">Pair programming</a>
is one of them.</p>

<p>We try to do it as much as possible at <a href="https://www.ombulabs.com">Ombu Labs</a>. We
usually keep the sessions under <strong>two hours</strong> and try to follow a regular
schedule.</p>

<p>When we find ourselves <strong>blocked</strong> by a code problem, we use our daily scrum to
coordinate a <strong>pairing session</strong>. It&#39;s quite a step up from <em><a href="http://c2.com/cgi/wiki?RubberDucking">rubberducking</a></em> or using a <em><a href="http://c2.com/cgi/wiki?CardboardProgrammer">cardboard programmer</a></em> to find a <strong>solution</strong>
to a problem.</p>

<p><img src="/blog/assets/images/pair-programming.jpg" alt="@mauro_oto and I pair programming" class="full-img"></p>

<h2>The Joys</h2>

<p>As a <em>Senior</em> developer, I find that pairing sessions are great for coaching
<em>Junior</em> developers. I enjoy teaching them about best practices, design
patterns, frameworks, languages, code style,
<a href="http://c2.com/cgi/wiki?ExtremeProgramming">XP</a>, and
<a href="http://c2.com/cgi/wiki?TestDrivenDevelopment">TDD</a>.</p>

<p>From the point of view of a <em>Junior</em> developer, I believe it&#39;s a
<strong>great opportunity</strong> to <strong>learn</strong> from someone who &quot;has been there before&quot;.
When you program with someone with more experience, you will often learn about
design patterns, elegant object-oriented solutions, tips and tricks.</p>

<!--more-->

<p>As a <em>Senior</em> developer, pair programming is a great way to mentor a <em>Junior</em>
developer. It&#39;s also a good way to get better at explaining some of the things
you know and to learn in the process.</p>

<p>When I&#39;m struggling, it&#39;s great to have a <strong>sounding board</strong> for my ideas. It&#39;s
useful to have a <strong>brainstorming</strong> session about potential solutions to a
problem. We all know that for every problem there is a:</p>

<ul>
<li>2 hours solution</li>
<li>2 days solution</li>
<li>2 weeks solution</li>
</ul>

<p><em>[I used <em>2</em> but it could be <em>n</em>. You get the point]</em></p>

<p>Pairing with someone you put everything in <strong>perspective</strong>. You evaluate your
resources, your limitations and you explore the different solutions until you
find something that is both elegant and pragmatic for both of you.</p>

<p>When you pair, you tend to avoid <strong>ugly hacks</strong> because someone is right there
watching what you are doing. As the <strong>driver</strong>, you can write your ugly hack
just to show what you want to do, then have your <strong>navigator</strong> improve it.</p>

<h2>The Woes</h2>

<p>To be completely honest, sometimes I have a <strong>hard time</strong> getting myself to
<strong>pair</strong> with someone else. I tend to think that I&#39;ll go <strong>faster</strong> by myself.
But this is not usually the case, especially when I&#39;m facing <strong>hard problems</strong>.</p>

<p>As a <em>Senior</em> developer sometimes you could actually go <strong>faster</strong> by yourself,
but you would miss out on the opportunity of coaching <em>Junior</em> developers.</p>

<p>If the sessions are <strong>too long</strong>, the navigator will lose interest or get lost
if the <em>Senior</em> developer is driving. The <strong>navigator</strong> should definitely
question <strong>weird-looking code</strong>, but that might slow down the <strong>driver</strong>.</p>

<p>Pairing sessions can be <strong>intense</strong>. After you are done, you need to take a
break before you continue with something else.</p>

<p>The navigator must definitely point out <strong>code smells</strong> and ask the driver to
improve them. If the driver can&#39;t, the navigator should improve the smelly code.
That will definitely <strong>slow you down</strong>, but it will produce better code.</p>

<p>The biggest <strong>woe</strong> is that you will produce code at a <strong>slower speed</strong>, but the
code will usually end up with more quality, more coverage and better readability
than if you were programming by yourself.</p>

<h2>Conclusion</h2>

<p>If you haven&#39;t tried <strong>pair programming</strong> yet, you should definitely give it a
try. After you do, you will likely incorporate it to your weekly routine.</p>

<p>The joys and advantages far outweigh the woes and disadvantages of this
practice.</p>

<h2>Tips</h2>

<ul>
<li>Pair when you have
<a href="http://c2.com/cgi/wiki?ProgrammersBlock">programmer&#39;s block</a>.</li>
<li>Pair when you have been <strong>stuck</strong> trying to solve a problem for way too long
and haven&#39;t made any progress.</li>
<li>Keep pairing sessions under <strong>two</strong> hours.</li>
<li>Don&#39;t do all the driving during the session, <strong>take turns</strong>.</li>
<li>Pair with someone with <strong>more experience</strong> than you.</li>
<li>Pair with someone with <strong>less experience</strong> than you.</li>
<li>Pair when you are unsure about the solution you just wrote.</li>
<li><strong>Be communicative</strong>. Guide the navigator through your thought process.
<strong>Talk</strong> about the alternatives and why you go one way or the other.</li>
<li>Keep a <strong>post-it</strong> block right next to you. Write down things that could be
improved but not during the session.</li>
<li>Interrupt only when necessary.</li>
<li>If you are the navigator, don&#39;t be afraid to grab the keyboard to show a
<strong>better alternative</strong> to the code that the driver is writing.</li>
<li>Put your phone on do not disturb mode.</li>
</ul>

<p><em>[The title of this article was inspired by one of <a href="http://home.adelphi.edu/sbloch/class/adages/joy.html">my favorite chapters</a> in <a href="https://en.wikipedia.org/wiki/The_Mythical_Man-Month">The Mythical Man-Month</a> by Fred Brooks]</em></p>
]]></content:encoded>
      <dc:date>2016-05-12T10:37:00-04:00</dc:date>
    </item>
    <item>
      <title>Introducing Infractores</title>
      <link>https://www.ombulabs.com/blog/open-source/crowdsourcing/introducing-infractores.html</link>
      <description><![CDATA[I&#39;ve always been a big fan of scratching your own itch. My latest itch was the insane amount of parking
violations that I see everyday in Buenos Aires, near our office.

We decided to build a simple tool that would allow anyone with a Twitter account to report a parking violation. All
you need to do is submit a geolocated tweet and a couple of photos
(as evidence!)

Here is an example:

Ah, ¿no se puede estacionar en paradas de colectivo? Ya fueee... #InfractoresBA pic.twitter.com/XXmu1pdAib&mdash; E r n e s t o (@_nesto) April 18, 2016



You can check out this tool over here: http://www.infractoresba.com.ar

This page shows all the parking violations reported by users to
@InfractoresBA or with the
#InfractoresBA hashtag.
It&#39;s as simple as that.
]]></description>
      <pubDate>Fri, 29 Apr 2016 11:37:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/open-source/crowdsourcing/introducing-infractores.html</guid>
      <content:encoded><![CDATA[<p>I&#39;ve always been a big fan of <a href="https://en.wikipedia.org/wiki/The_Cathedral_and_the_Bazaar#Lessons_for_creating_good_open_source_software">scratching your own itch</a>. My latest itch was the <strong>insane amount of parking
violations</strong> that I see everyday in <strong>Buenos Aires</strong>, near <a href="https://foursquare.com/v/ombulabs-hq/52f0e47311d25da04d101b62">our office</a>.</p>

<p>We decided to build a <strong>simple tool</strong> that would allow anyone with a <a href="https://twitter.com">Twitter</a> account to <em>report a parking violation</em>. All
you need to do is submit a <strong>geolocated tweet</strong> and a couple of photos
(<strong>as evidence!</strong>)</p>

<p>Here is an example:</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="es" dir="ltr">Ah, ¿no se puede estacionar en paradas de colectivo? Ya fueee... <a href="https://twitter.com/hashtag/InfractoresBA?src=hash">#InfractoresBA</a> <a href="https://t.co/XXmu1pdAib">pic.twitter.com/XXmu1pdAib</a></p>&mdash; E r n e s t o (@_nesto) <a href="https://twitter.com/_nesto/status/722065061309726720">April 18, 2016</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>You can check out this tool over here: <a href="http://www.infractoresba.com.ar">http://www.infractoresba.com.ar</a></p>

<p>This page shows all the parking violations reported by users to
<a href="https://twitter.com/infractoresBA">@InfractoresBA</a> or with the
<a href="https://twitter.com/search?src=typd&q=%23InfractoresBA">#InfractoresBA</a> hashtag.
It&#39;s <strong>as simple as that</strong>.</p>

<!--more-->

<p>We focused on making the feature of reporting a parking violation <strong>as simple as
possible</strong>:</p>

<ul>
<li>There&#39;s no application to download</li>
<li>No need to register to a new site</li>
<li>No need to fill out 20 different fields</li>
</ul>

<p>I know that there are <em>other alternatives</em> to report a violation in Buenos
Aires:</p>

<ul>
<li>An official <a href="http://www.buenosaires.gob.ar/aplicacionesmoviles/ba-denuncia-vial">Android and iOS application</a></li>
<li>An official <a href="http://www.buenosaires.gob.ar/areas/seguridad_justicia/seguridad_urbana/dgcactyt/formulario_denuncia/denunciavial.php?menu_id=34064">web page with a long form</a></li>
</ul>

<p>But I wanted to make it even easier for someone to report a parking violation.
I am also a big fan of (good) <strong>user experience</strong>.</p>

<p>I didn&#39;t see the need to register an account to report a violation. In fact,
I think it&#39;s something that will discourage people from reporting a violation.
Why not use an existing account in <a href="https://twitter.com">Twitter</a>?</p>

<p>As a user of our tool, and as someone who usually rides his bicycle to work, I
wanted to <strong>stop, take a photo, tweet it, and move on</strong>.</p>

<p>Just like this:</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="es" dir="ltr">La gente que estaciona así es un peligro <a href="https://twitter.com/InfractoresBA">@InfractoresBA</a> <a href="https://t.co/DGNfrQvopZ">pic.twitter.com/DGNfrQvopZ</a></p>&mdash; E r n e s t o (@_nesto) <a href="https://twitter.com/_nesto/status/717023979454771201">April 4, 2016</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>There is still some work to be done. That&#39;s why we have made this tool
<a href="/blog/tags/open-source/">open source</a>. We are open to suggestions, bug reports, code contributions and general feedback: <a href="https://github.com/ombulabs/infractores">https://github.com/ombulabs/infractores</a></p>

<p>As always, we developed an <a href="https://www.ombulabs.com/blog/tags/mvp">MVP</a> that can
later be extended and refined. We hope to learn from how the community uses
this tool.</p>

<p>Our vision is for someone to pick up this tool, configure a city and a vertical,
and start using it to track any kind of violation.</p>

<p>In our case, we wanted to improve the situation with parking violations in
<strong>Buenos Aires</strong>. We hope this tool will lead to those who <strong>park illegally</strong>
being fined and encourage more people to <strong>park better</strong>.</p>

<p>However you could easily configure this tool to track <em>loud noise infractions</em> in
<strong>Chicago</strong>, or <em>crime</em> in <strong>Berlin</strong> (in terms of crime it might be tricky to
capture the image/video to use as evidence, but it&#39;s a possibility)</p>

<p>This is <strong>not a commercial project</strong>. We <strong>don&#39;t</strong> expect to make money, we just
want people to use it to <strong>improve their communities</strong>.</p>

<p>All feedback is welcome, whether you like it, hate it or spot an <a href="https://github.com/ombulabs/infractores/issues">issue</a>!</p>
]]></content:encoded>
      <dc:date>2016-04-29T11:37:00-04:00</dc:date>
    </item>
    <item>
      <title>Using Bumbler to reduce runtime dependencies</title>
      <link>https://www.ombulabs.com/blog/ruby/performance/using-bumbler-to-reduce-runtime-dependencies.html</link>
      <description><![CDATA[A few weeks ago, I found an interesting project called
 Bumbler. If your project uses Bundler,
 Bumbler shows you your project&#39;s largest dependencies.
When you find yourself staring at the screen after running
 bundle exec rails c, you may want to give this tool a try.
]]></description>
      <pubDate>Mon, 25 Apr 2016 07:39:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/ruby/performance/using-bumbler-to-reduce-runtime-dependencies.html</guid>
      <content:encoded><![CDATA[<p>A few weeks ago, I found an interesting project called
 <a href="https://github.com/nevir/Bumbler">Bumbler</a>. If your project uses Bundler,
 Bumbler shows you your project&#39;s largest dependencies.
When you find yourself staring at the screen after running
 <code>bundle exec rails c</code>, you may want to give this tool a try.</p>

<!--more-->

<p>Using it is simple. Add <code>gem &#39;bumbler&#39;</code> to your Gemfile under the development
 group, run <code>bundle</code>, and you&#39;re good to go.
 When you run <code>bundle exec bumbler</code> you will see a progress bar and a detail of
 the dependencies which took the longest to load.
Here&#39;s an example of a project&#39;s development dependencies:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>➜  git:(master) ✗ bundle exec bumbler
[#################################################                             ]
(49/65) travis-lint...
Slow requires:
    110.21  render_anywhere
    147.33  nokogiri
    173.83  haml
    179.62  sass-rails
    205.04  delayed_job_active_record
    286.76  rails
    289.36  mail
    291.98  capistrano
    326.05  delayed_job
    414.27  pry
    852.13  salesforce_bulk_api
</code></pre></div>
<p>As you can see, one of the gems takes almost 1 second to load on my system,
 and removing it decreases the time it takes for <code>bundle exec rails c</code> to load
 by 1 second. It&#39;s not a lot, but consider every Rake task you run which depends
 on the environment will take 1 less second to get started.</p>

<p>After we get rid of <code>salesforce_bulk_api</code> and <code>render_anywhere</code> and manually
 call <code>require</code> on them when needed, the load time looks like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>➜  git:(master) ✗ bundle exec bumbler
[#################################################                             ]
(47/65) fog-aws...
Slow requires:
    167.50  sass-rails
    188.87  nokogiri
    218.49  haml
    230.10  capistrano
    253.77  delayed_job_active_record
    284.26  mail
    320.19  delayed_job
    365.67  pry
    464.09  rails
</code></pre></div>
<p>Your tests can also benefit from this, as you may find gems that you do not need
 to have in the test environment. Capistrano is one example, usually you want
 to have it load <strong>only</strong> in development, not in test nor production.</p>

<p>One caveat worth mentioning: you need to take a close look at your loaded gem&#39;s
 dependencies when removing them. For example, <code>capistrano</code> depends on
 <code>net-ssh</code> and <code>net-scp</code>. If you remove <code>capistrano</code> from <code>test</code> or
 <code>production</code>, you won&#39;t be able to use <code>Net::SSH</code> or <code>Net::SCP</code> unless you
 manually add the <code>net-ssh</code> and <code>net-scp</code> dependencies back in your Gemfile, as
 you were relying on them implicitly via Capistrano.</p>
]]></content:encoded>
      <dc:date>2016-04-25T07:39:00-04:00</dc:date>
    </item>
    <item>
      <title>Use session variables to optimize your user flow</title>
      <link>https://www.ombulabs.com/blog/ruby/rails/sessions/session-user-flow.html</link>
      <description><![CDATA[Sessions provide you a nice little data storage feature where the application does not need to get the information directly from the database. So you do not have to persist data in your database and can easily store info about the user on the fly. This is a nice way to enhance the user experience on your page.

Let&#39;s say that you want to show some users a new fancy sign up form and the rest the old form. If you store the version of the sign up form in a session variable, you don&#39;t need to persist this info in your database.
]]></description>
      <pubDate>Fri, 22 Apr 2016 04:37:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/ruby/rails/sessions/session-user-flow.html</guid>
      <content:encoded><![CDATA[<p>Sessions provide you a nice little data storage feature where the application does not need to get the information directly from the database. So you do not have to persist data in your database and can easily store info about the user on the fly. This is a nice way to enhance the user experience on your page.</p>

<p>Let&#39;s say that you want to show some users a new fancy sign up form and the rest the old form. If you store the version of the sign up form in a session variable, you don&#39;t need to persist this info in your database.</p>

<!--more-->

<p>That can be pretty handy in many ways, if you think about changing the content of a website based on the session&#39;s information. Handling a lot of session data can be pretty confusing, since the session is just a simple storage. That basically means that you have to organize your way of working with sessions.</p>

<p>I once had the idea to put all this information into an object. This way I could test it and do wild things with the data, but the frustration comes as soon as you change your Object stored in your session.</p>

<p>Basically this is what you should <strong>NOT</strong> do:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Location</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
    <span class="vi">@location</span> <span class="o">=</span> <span class="n">location_request</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>  
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">city</span>
    <span class="vi">@location</span><span class="o">.</span><span class="n">city</span>
  <span class="k">end</span>
  <span class="o">...</span>
<span class="k">end</span>
<span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_action</span> <span class="ss">:set_location</span>

  <span class="k">def</span> <span class="nf">set_location</span><span class="p">(</span><span class="n">user_ip</span><span class="p">)</span>
    <span class="n">session</span><span class="o">[</span><span class="ss">:user_location</span><span class="o">]</span> <span class="o">=</span> <span class="no">Location</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">user_ip</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>As soon as you later remove the location class and you are still trying to access <code>session[:user_location]</code>, your App will raise the following exception:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>ActionDispatch::Session::SessionRestoreError

Session contains objects whose class definition isn&#39;t available.
Remember to require the classes for all objects kept in the session.
(Original exception: uninitialized constant MyController::Location [NameError])
</code></pre></div>
<p>The problem is at first not very obvious. The app has no knowledge of the previously stored class anymore.</p>

<p>A better way is to not store complex objects or classes in the session. Think about how and what you want to store in the session and keep the data structure simple. Maybe a specific set of helper or controller methods just for handling the user navigation is enough. You can guide or force the user to a specific area of your website using the stored session information.</p>

<p>One example could be a user that has seen all of your pages, but is not willing to sign up or click a specific button. You could write a concern like this one to figure out what pages the user has already visited:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">before_action</span> <span class="ss">:store_path</span>

<span class="k">def</span> <span class="nf">store_path</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:visited_paths</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span>
  <span class="k">if</span> <span class="n">session</span><span class="o">[</span><span class="ss">:visited_paths</span><span class="o">].</span><span class="n">exclude?</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">session</span><span class="o">[</span><span class="ss">:visited_paths</span><span class="o">].</span><span class="n">push</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">visited?</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="n">session</span><span class="o">[</span><span class="ss">:visited_paths</span><span class="o">].</span><span class="n">include?</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>You can keep it simple at this point and you can also test it in an <a href="https://relishapp.com/rspec/rspec-rails/docs/controller-specs/anonymous-controller">Anonymous Controller</a>. With some basic helpers like this, you could make a lot of things much easier and keep the code maintainable.</p>

<p>Session variables are a great way to test your business ideas and user flow. They are a good way to guide your users without storing a lot of information in the database or using third party services.</p>

<p>Keep in mind that the cookie session size is limited to 4kb, in case you want to store a lot of data. Check also this <a href="http://stackoverflow.com/questions/9473808/cookie-overflow-in-rails-application">StackOverflow question</a> for a workaround to this issue.</p>

<p>If you know a better way to work with sessions, let me know!</p>
]]></content:encoded>
      <dc:date>2016-04-22T04:37:00-04:00</dc:date>
    </item>
    <item>
      <title>Our Hiring Process</title>
      <link>https://www.ombulabs.com/blog/team/jobs/our-hiring-process.html</link>
      <description><![CDATA[This is our process to hire new team members at Ombu Labs. It&#39;s a process that we have been improving ever since we started our operations. It&#39;s very important for us to hire A players.

In this article I will focus on how we evaluate new developers, but parts of the process can be customized for other positions.
]]></description>
      <pubDate>Thu, 14 Apr 2016 13:03:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/team/jobs/our-hiring-process.html</guid>
      <content:encoded><![CDATA[<p>This is our process to hire new team members at <a href="https://www.ombulabs.com">Ombu Labs</a>. It&#39;s a process that we have been improving ever since we started our operations. It&#39;s <strong>very important</strong> for us to hire <strong>A players</strong>.</p>

<p>In this article I will focus on how we evaluate new developers, but parts of the process can be customized for other positions.</p>

<!--more-->

<p>We usually hire Junior and Senior developers. You can find our open positions <a href="https://www.ombulabs.com/jobs">over here</a>.</p>

<h2>How to Apply</h2>

<p>You can just follow the <em>Apply</em> link for the position that you are interested in.</p>

<p>We don&#39;t want to receive an old school resume. We prefer to receive a link to your <a href="http://github.com">Github</a> or <a href="http://linkedin.com">LinkedIn</a>, in that particular order.</p>

<p>I realize that there are great developers that have never made any open source contributions. If that&#39;s your case, we will ask for a couple of code samples.</p>

<p>We want to see some recent code samples and evaluate you based on your work, not on your work history. <strong>Experience</strong> is important but <strong>passion</strong> is more important.</p>

<h2>First Interview</h2>

<p>If we like what we see, we will send you an email to coordinate an initial interview.</p>

<p>In this interview we will talk about your experience, what you know, what you are passionate about, what you are looking for, what we are looking for, and some concepts that are really important to us.</p>

<p>In this stage we want to get a sense of what you are looking for and if we are a <strong>good fit for you</strong>.</p>

<p>You can expect some technical questions and some random questions.</p>

<h2>Paid Pair Programming Time</h2>

<p>If we like what you said in the interview, we are going to schedule some time to <strong>pair program</strong> with you.</p>

<p>We don&#39;t expect you to work on a test project for free. That&#39;s why we will pay for the time that you spend pair programming with us.</p>

<p>We will start a project from scratch and pair program with you from 8 to 16 hours. You will be driving most of the time, but one of us will be your copilot.</p>

<p>In this test, we want you to work as you usually work. You can use <a href="http://www.google.com">Google</a>, <a href="http://stackoverflow.com">Stack Overflow</a>, <a href="https://www.ruby-lang.org/">Rubydoc</a>, or whatever you need to get things done.</p>

<p>You will spend some time working with each developer in our team. We want to see <strong>how we work together</strong> and if there is <strong>chemistry</strong> between us.</p>

<h2>Culture Fit Interview</h2>

<p>If we like what you did pair programming with us, we will call you in for a <strong>culture fit</strong> interview.</p>

<p>This interview will be an interview with everyone in the team, not just developers. Everyone in the company will be able to ask you one or more questions. They are usually pretty random.</p>

<p>Also, you will be able to ask anyone in the team any questions. This is a good way for you to find out what it&#39;s really like to work at Ombu Labs.</p>

<h2>Job Offer</h2>

<p>If you pass the culture fit interview, you will receive a job offer.</p>

<p>In the best scenario, you will accept our job offer and join us as soon as possible!</p>

<h2>Join us!</h2>

<p>We are very careful when adding people to our team. We want to work with the best talent out there.</p>

<p>We don&#39;t want to waste anyone&#39;s time. That&#39;s why our hiring process is <strong>so long</strong>. In order to keep our team&#39;s quality high, we prefer to spend more time than usual making a decision.</p>

<p>If you are looking for a <strong>new challenge</strong>, check out our open positions: <a href="https://www.ombulabs.com/jobs">https://www.ombulabs.com/jobs</a></p>
]]></content:encoded>
      <dc:date>2016-04-14T13:03:00-04:00</dc:date>
    </item>
    <item>
      <title>The Landing Page MVP</title>
      <link>https://www.ombulabs.com/blog/lean-startup/mvp/the-landing-page-mvp.html</link>
      <description><![CDATA[There is no good reason why an MVP should take more than one month. If that happens, it means that the scope of the minimum viable product wasn&#39;t small enough.

You want to build the smallest feature set in order to start learning from your target market. It doesn&#39;t have to be feature complete. It doesn&#39;t even have to offer a feature. It doesn&#39;t even need to be a web-based MVP.
]]></description>
      <pubDate>Tue, 05 Apr 2016 07:03:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/lean-startup/mvp/the-landing-page-mvp.html</guid>
      <content:encoded><![CDATA[<p>There is no good reason why an <strong>MVP</strong> should take more than one month. If that happens, it means that the scope of the <a href="https://leanstack.com/minimum-viable-product/">minimum viable product</a> wasn&#39;t small enough.</p>

<p>You want to build the smallest feature set in order to start learning from your target market. It doesn&#39;t have to be feature complete. It doesn&#39;t even have to offer a feature. It doesn&#39;t even need to be a web-based MVP.</p>

<!--more-->

<h2>Lean Canvas</h2>

<p>If you haven&#39;t already, write the first draft of your <a href="https://leanstack.com/lean-canvas/">Lean Canvas</a>. It&#39;s a good exercise to define the <strong>problem</strong>, <strong>solution</strong>, <strong>customer segments</strong>, <strong>unique value proposition</strong>, cost structure and revenue streams.</p>

<p>Keep in mind that each post-it in your Lean Canvas is a hypothesis. <strong>It&#39;s what you consider as the problem, not necessarily what the market considers as the problem</strong>.</p>

<p>The goal here is to identify your riskiest hypothesis.</p>

<h3>Customer Segments</h3>

<p>Ask yourself: Who is your ideal client?</p>

<p>If the answer is vague, try again. Do they have a particular profession? What do they like to do? How old are they? Are they married/single? How many customers does your business model have?</p>

<p>I like to use this form to define your target market:</p>

<ul>
<li>As a loyal customer to my local coffee shop, I&#39;d like to get rewards for being loyal to my shop.</li>
<li>As a local small business owner, I want to offer my repeat customers rewards so that they continue to shop at my store.</li>
</ul>

<h3>Problem</h3>

<p>Now that you&#39;ve defined the customer segments hypotheses, you can think about the problem. What problem do they have? What&#39;s their pain?</p>

<p>Once you have defined problem and customer segments, you can create your landing page MVP.</p>

<h2>The Landing Page MVP</h2>

<p>Sometimes an MVP can be as simple as a landing page. If that&#39;s the case, you can use one of these services:</p>

<ul>
<li><a href="http://unbounce.com">Unbounce</a></li>
<li><a href="http://www.leadpages.net">Lead Pages</a></li>
</ul>

<p>You don&#39;t need a programmer or software boutique for this. You can build a landing page yourself and drive people to it.</p>

<h3>Problem Description</h3>

<p>The most important part of the landing page is the problem description. You want the people in your target market to read the problem description and relate to it.</p>

<p>You will find these types of people in your target market:</p>

<ul>
<li>They don&#39;t know they have a problem. They are fine doing things as they&#39;re currently doing them.</li>
<li>They do know they have a problem. They read your problem description and they can relate to it.</li>
<li>They do know they have a problem and they have already attempted to solve it. They may have hacked a solution that is not ideal.</li>
<li>They do know they have a problem and they have a budget for a solution. This is your sweet spot.</li>
<li>They do know they have a problem and they are already paying someone to provide a solution.</li>
</ul>

<h3>Solution</h3>

<p>After you clearly define the problem, you want to show a teaser for a solution. Usually this will show one (or many) screenshots and a title for the solution.</p>

<p>At this point, you don&#39;t really need to have the solution up and running. It can be a prototype, a Photoshop file, a teaser video or even just some notes in a notepad.</p>

<p>You want to entice people to take a leap of faith.</p>

<h3>Call to Action</h3>

<p>At this point, the leap of faith is that the users will give you their email address to receive updates on your solution and ideally a product launch.</p>

<p>You can use this information to follow up on them, to put them in a drip email marketing sequence, or to get more information from them.</p>

<p>If they decided to give you their email address, it&#39;s more likely that they will be willing to participate in a short call or survey.</p>

<h3>Magnet *</h3>

<p>* This part is optional. You will probably get more email addresses if you offer a <em>freebie</em>. For example: If you are working on a book, you can offer a sample chapter in exchange for their email address.</p>

<p>Sometimes people will be more willing to share their email details if you offer them something <em>tangible</em> in return.</p>

<h3>Traffic</h3>

<p>This type of MVP is useless if you don&#39;t drive people to it. How do you drive people to a landing page? The same way that you drive people to any web page.</p>

<p>These are only a few ways to drive people to your landing page:</p>

<h4>Networking</h4>

<p>You can go to events and network with people. When you meet new people, you can give them your card or just mention the name of your project, the problem and the unique value proposition.</p>

<p>If the people you meet are within your target market, it&#39;s very likely that they will go to your site and sign up.</p>

<p>This approach takes time and is quite <em>old school</em>.</p>

<h4>Facebook</h4>

<p>You can post your website to Facebook so that all your friends can see. If you already have a Facebook page, you can post a link to all your followers.</p>

<p>This way you will get traffic from friends, family and followers. Depending on the amount of likes (and <a href="http://www.businessinsider.com/facebook-changed-how-the-news-feed-works--and-huge-website-upworthy-suddenly-shrank-in-half-2014-2">Facebook&#39;s algorithm</a>) you will get a lot of traffic or not so much.</p>

<p>If there are groups that are related to this problem, you can join these groups and see what people are saying. You can build a relationship with members and later invite them to your landing page.</p>

<p>This way you will get traffic from people who are not friends nor family.</p>

<p>If you have some budget, you can <a href="http://clairepells.com/free-guide-facebook-ads/">use Facebook Ads</a> to target people in your demographic. You can go back to the demographic definition and setup a Facebook Ads campaign to target these people.</p>

<h4>Google Ad Words</h4>

<p>What is your target market searching for in Google? Are they looking for a way to &quot;listen to WNYC online&quot;? Or &quot;offer rewards to my customers&quot;? Or &quot;record a business podcast&quot;?</p>

<p><a href="https://www.google.com/adwords/">Google Ad Words</a> is a great way to find people who are already looking for a solution to the problem you described. You can show them an ad and take them to your own landing page.</p>

<h4>Online Forums</h4>

<p>Some problems already have forums of people talking about them. People usually search for solutions. If they can&#39;t find it, they ask other people for advice.</p>

<p>You could participate in forums and learn from the people that are asking questions that are related to your problem. Then you can drive these people to your landing page.</p>

<h2>Pivot or Persevere</h2>

<p>After you ran your landing page for a few weeks, you can measure the results. How many emails did you collect? What was the conversion rate? Out of all the visitors, how many of them gave you their email address? That ratio is your conversion rate.</p>

<p>With that information you will be able to continue with the same problem description, or you will be forced to <a href="http://steveblank.com/2014/01/14/whats-a-pivot/">pivot</a> into another problem or solution.</p>
]]></content:encoded>
      <dc:date>2016-04-05T07:03:00-04:00</dc:date>
    </item>
    <item>
      <title>Announcing The Ombu Labs Shop!</title>
      <link>https://www.ombulabs.com/blog/design/ombulabs-products.html</link>
      <description><![CDATA[We recently worked on a series of Christmas presents for the team. We are happy to share part of the process and its final result!
]]></description>
      <pubDate>Fri, 01 Apr 2016 08:35:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/design/ombulabs-products.html</guid>
      <content:encoded><![CDATA[<p>We recently worked on a series of Christmas presents for the team. We are happy to share part of the process and its final result!</p>

<!--more-->

<h3>Our process: it all started with an idea</h3>

<p>As it happens with every product, it starts with an idea. We wanted to make a t-shirt, a notebook and a tote bag that could reflect our passion for work and design.</p>

<p>For the notebook, we chose a quote by Otl Aicher: “Good Art Inspires, Good Design Motivates”. Here you can see part of the design process, with some tweaks and final adjustments.</p>

<p><img src="/blog/assets/images/ombu-labs-shop/notebook-design-process.png" alt="Notebook Design Process" class="full-img"></p>

<p>For our t-shirt we chose a very well known quote that inspires us day by day at work: Done is Better than Perfect. In this case, we started with some paper sketches and then its design:</p>

<p><img src="/blog/assets/images/ombu-labs-shop/lettering-1.jpg" alt="T-Shirt Design Process" class="full-img">
<img src="/blog/assets/images/ombu-labs-shop/lettering-2.png" alt="Done is Better than Perfect" class="full-img"></p>

<h3>Our Products</h3>

<p>After all this creative process, these are the results:</p>

<p><img src="/blog/assets/images/ombu-labs-shop/notebook.png" alt="Ombu Labs Notebook" class="full-img"></p>

<p><img src="/blog/assets/images/ombu-labs-shop/t-shirt.png" alt="Ombu Labs t-shirt" class="full-img"></p>

<p>And last, but not least, our tote bag, its design was inspired by our day-to-day work and methodology. We made some illustrations and then created a final composition.</p>

<p><img src="/blog/assets/images/ombu-labs-shop/working-at-ombulabs.gif" alt="Working at OmbuLabs" class="full-img"></p>

<p><img src="/blog/assets/images/ombu-labs-shop/totebag.png" alt="Ombu Labs Tote Bag" class="full-img"></p>

<h3>Ombu Labs Shop</h3>

<p>We are very proud and happy to share this with you. We believe this process can be applied to any kind of project. Now, these products are available for sale in our <a href="http://shop.ombulabs.com/">online store</a>!</p>

<p><img src="/blog/assets/images/ombu-labs-shop/shop.jpg" alt="Ombu Labs Shop" class="full-img"></p>

<p>We also invite you to visit and follow our <a href="https://dribbble.com/OmbuLabs">Dribbble</a> account where we’ll be sharing new shots!</p>
]]></content:encoded>
      <dc:date>2016-04-01T08:35:00-04:00</dc:date>
    </item>
    <item>
      <title>Hunting Down a Slow Rails Request</title>
      <link>https://www.ombulabs.com/blog/rails/performance/hunting-down-a-slow-rails-request.html</link>
      <description><![CDATA[Recently, we started using Skylight in production
for one of our clients&#39; Rails applications, in an attempt to try to improve the
performance of some of the more critical API endpoints.

Skylight reports on:


Time taken per request
Breakdown of time taken per SQL query
Object allocations per request


I noticed an unusually large amount of allocated objects for one request:



This request would take anywhere from 400ms to 3000ms to respond, which is
WAY too long.
]]></description>
      <pubDate>Fri, 04 Mar 2016 06:03:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/performance/hunting-down-a-slow-rails-request.html</guid>
      <content:encoded><![CDATA[<p>Recently, we started using <a href="https://www.skylight.io">Skylight</a> in production
for one of our clients&#39; Rails applications, in an attempt to try to improve the
performance of some of the more critical API endpoints.</p>

<p>Skylight reports on:</p>

<ul>
<li>Time taken per request</li>
<li>Breakdown of time taken per SQL query</li>
<li>Object allocations per request</li>
</ul>

<p>I noticed an unusually large amount of allocated objects for one request:</p>

<p><img src="/blog/assets/images/high-object-allocation.png" alt="Skylight report"></p>

<p>This request would take anywhere from 400ms to 3000ms to respond, which is
<strong>WAY</strong> too long.</p>

<!--more-->

<p>To debug this, I first captured the <code>String</code> object allocation count locally to
see how it behaved:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Started</span> <span class="no">GET</span> <span class="s2">&quot;/email_accounts.json?results_per_page=30&quot;</span> <span class="k">for</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">at</span> <span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mo">02</span> <span class="mi">13</span><span class="p">:</span><span class="mo">04</span><span class="p">:</span><span class="mi">22</span> <span class="o">+</span><span class="mo">0000</span>
<span class="no">Processing</span> <span class="n">by</span> <span class="no">EmailAccountsController</span><span class="c1">#index as JSON</span>
  <span class="ss">Parameters</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;results_per_page&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;30&quot;</span><span class="p">}</span>

<span class="o">[[</span><span class="nb">String</span><span class="p">,</span> <span class="mi">150299</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">Arel</span><span class="o">::</span><span class="no">Nodes</span><span class="o">::</span><span class="no">SqlLiteral</span><span class="p">,</span> <span class="mi">5</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">Arel</span><span class="o">::</span><span class="no">Nodes</span><span class="o">::</span><span class="no">BindParam</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">StringInquirer</span><span class="p">,</span> <span class="mi">1</span><span class="o">]]</span>
<span class="c1">### JSON rendering happens here ###</span>
<span class="o">[[</span><span class="nb">String</span><span class="p">,</span> <span class="mi">707982</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">JSON</span><span class="o">::</span><span class="no">Encoding</span><span class="o">::</span><span class="no">JSONGemEncoder</span><span class="o">::</span><span class="no">EscapedString</span><span class="p">,</span> <span class="mi">2922</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">Arel</span><span class="o">::</span><span class="no">Nodes</span><span class="o">::</span><span class="no">SqlLiteral</span><span class="p">,</span> <span class="mi">6</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">StringInquirer</span><span class="p">,</span> <span class="mi">1</span><span class="o">]]</span>

<span class="no">Completed</span> <span class="mi">200</span> <span class="no">OK</span> <span class="k">in</span> <span class="mi">5860</span><span class="n">ms</span> <span class="p">(</span><span class="ss">Views</span><span class="p">:</span> <span class="mi">11</span><span class="o">.</span><span class="mi">8</span><span class="n">ms</span> <span class="o">|</span> <span class="ss">ActiveRecord</span><span class="p">:</span> <span class="mi">564</span><span class="o">.</span><span class="mi">9</span><span class="n">ms</span><span class="p">)</span>
</code></pre></div>
<p>To get the amount of allocated strings, I used the following snippet:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">strings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="no">ObjectSpace</span><span class="o">.</span><span class="n">each_object</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">str</span><span class="o">|</span> <span class="n">strings</span><span class="o">[</span><span class="n">str</span><span class="o">.</span><span class="n">class</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">}</span>
<span class="n">pp</span> <span class="n">strings</span>
</code></pre></div>
<p>As you can see, there are 700k+ allocated strings. It is very likely that this
increase in object allocation is the culprit for the slow performance.</p>

<p>I dug a bit into the <code>EmailAccount</code> model and its associations, and noticed that
this model had a one-to-many association. Supposedly, we were only returning one
record for this association by using:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">scope</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="ss">:latest_sync</span><span class="p">)</span>
</code></pre></div>
<p>and</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">has_one</span> <span class="ss">:latest_sync</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span> <span class="s2">&quot;email_account_syncs.last_attempt_at desc&quot;</span> <span class="p">},</span>
                      <span class="ss">class_name</span><span class="p">:</span> <span class="s2">&quot;EmailAccountSync&quot;</span>
</code></pre></div>
<p>As it turns out, the <code>has_one :latest_sync</code> relationship was not being
respected by the query performed in the <code>index</code> action, and thus:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">EmailAccountSync</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">21</span><span class="o">.</span><span class="mi">9</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="s2">&quot;email_account_syncs&quot;</span><span class="o">.</span><span class="n n-Operator">*</span> <span class="no">FROM</span> <span class="s2">&quot;email_account_syncs&quot;</span>  <span class="no">WHERE</span> <span class="s2">&quot;email_account_syncs&quot;</span><span class="o">.</span><span class="s2">&quot;email_account_id&quot;</span> <span class="no">IN</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>  <span class="no">ORDER</span> <span class="no">BY</span> <span class="n">email_account_syncs</span><span class="o">.</span><span class="n">last_attempt_at</span> <span class="n">desc</span>
</code></pre></div>
<p>This meant that all <code>EmailAccountSync</code> instances were getting loaded for each
<code>EmailAccount</code> record. The <code>limit</code> that should have been in the SQL statement
was not there.</p>

<p>I googled for a bit and found <a href="https://github.com/rails/rails/issues/10621#issuecomment-77389988">this issue</a>,
which suggests using <code>eager_load</code> instead of <code>includes</code>, which fixes the issue.</p>

<p>The downside is that it introduces an N+1 query problem, but it&#39;s a dramatical
performance gain:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Started</span> <span class="no">GET</span> <span class="s2">&quot;/email_accounts.json?results_per_page=30&quot;</span> <span class="k">for</span> <span class="mi">186</span><span class="o">.</span><span class="mi">158</span><span class="o">.</span><span class="mi">142</span><span class="o">.</span><span class="mi">200</span> <span class="n">at</span> <span class="mi">2016</span><span class="o">-</span><span class="mo">03</span><span class="o">-</span><span class="mo">02</span> <span class="mi">13</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">44</span> <span class="o">+</span><span class="mo">0000</span>
<span class="no">Processing</span> <span class="n">by</span> <span class="no">EmailAccountsController</span><span class="c1">#index as JSON</span>
  <span class="ss">Parameters</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;results_per_page&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;30&quot;</span><span class="p">}</span>

<span class="o">[[</span><span class="nb">String</span><span class="p">,</span> <span class="mi">150295</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">JSON</span><span class="o">::</span><span class="no">Encoding</span><span class="o">::</span><span class="no">JSONGemEncoder</span><span class="o">::</span><span class="no">EscapedString</span><span class="p">,</span> <span class="mi">2110</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">Arel</span><span class="o">::</span><span class="no">Nodes</span><span class="o">::</span><span class="no">SqlLiteral</span><span class="p">,</span> <span class="mi">20</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">Arel</span><span class="o">::</span><span class="no">Nodes</span><span class="o">::</span><span class="no">BindParam</span><span class="p">,</span> <span class="mi">10</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">StringInquirer</span><span class="p">,</span> <span class="mi">1</span><span class="o">]]</span>
<span class="c1">### JSON rendering happens ###</span>
<span class="o">[[</span><span class="nb">String</span><span class="p">,</span> <span class="mi">157847</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">JSON</span><span class="o">::</span><span class="no">Encoding</span><span class="o">::</span><span class="no">JSONGemEncoder</span><span class="o">::</span><span class="no">EscapedString</span><span class="p">,</span> <span class="mi">4220</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">Arel</span><span class="o">::</span><span class="no">Nodes</span><span class="o">::</span><span class="no">SqlLiteral</span><span class="p">,</span> <span class="mi">30</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">Arel</span><span class="o">::</span><span class="no">Nodes</span><span class="o">::</span><span class="no">BindParam</span><span class="p">,</span> <span class="mi">12</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">StringInquirer</span><span class="p">,</span> <span class="mi">1</span><span class="o">]]</span>

<span class="no">Completed</span> <span class="mi">200</span> <span class="no">OK</span> <span class="k">in</span> <span class="mi">178</span><span class="n">ms</span> <span class="p">(</span><span class="ss">Views</span><span class="p">:</span> <span class="mi">5</span><span class="o">.</span><span class="mi">6</span><span class="n">ms</span> <span class="o">|</span> <span class="ss">ActiveRecord</span><span class="p">:</span> <span class="mi">2</span><span class="o">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>
</code></pre></div>
<p>The object allocation is down by a huge amount, and the request now takes from
50ms to 200ms to respond. This is not yet completely efficient, but it is a much
more acceptable value.</p>
]]></content:encoded>
      <dc:date>2016-03-04T06:03:00-05:00</dc:date>
    </item>
    <item>
      <title>10 Steps to Evaluate a Rails Project</title>
      <link>https://www.ombulabs.com/blog/rails/maintenance/ten-steps-to-evaluate-a-rails-project.html</link>
      <description><![CDATA[It will come a time when you will have to decide whether to maintain a Rails project or not.

If you want to seriously consider it, you should follow these 10 steps:

1. Setup the development environment

Git clone the repository and try to start the server. Is the README clear enough? Can you follow the steps in the file and easily get started?

A lot of projects will have a README that is out of date and/or instructions that don&#39;t work right off the bat.

Most of the projects will define guidelines like these:


Configure your config/database.yml
Configure your .env file
Setup the database rake db:create db:migrate db:seed
Start the server rails server


The best projects will have a one-liner that will setup the entire environment for you.
]]></description>
      <pubDate>Wed, 17 Feb 2016 08:55:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/maintenance/ten-steps-to-evaluate-a-rails-project.html</guid>
      <content:encoded><![CDATA[<p>It will come a time when you will have to decide whether to maintain a <a href="http://rubyonrails.org">Rails</a> project <strong>or not</strong>.</p>

<p>If you want to seriously consider it, you should follow these 10 steps:</p>

<h3>1. Setup the development environment</h3>

<p>Git clone the repository and try to start the server. Is the <code>README</code> clear enough? Can you follow the steps in the file and easily get started?</p>

<p>A lot of projects will have a <code>README</code> that is out of date and/or instructions that don&#39;t work right off the bat.</p>

<p>Most of the projects will define guidelines like these:</p>

<ul>
<li>Configure your <code>config/database.yml</code></li>
<li>Configure your <code>.env</code> file</li>
<li>Setup the database <code>rake db:create db:migrate db:seed</code></li>
<li>Start the server <code>rails server</code></li>
</ul>

<p>The best projects will have a one-liner that will setup the entire environment for you.</p>

<!--more-->

<p>For example:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="nb">cd</span> path/to/project
./bin/setup
rails server
</code></pre></div>
<h3>2. Run the tests</h3>

<p>Once you have setup your development environment, try to run the tests. For example:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>rake
</code></pre></div>
<p>Any decent <a href="http://rubyonrails.org">Rails</a> project will have a passing build, even if it&#39;s not very thorough.</p>

<p>Hopefully, the build won’t take more than 10 minutes to finish. Some builds will take a long time, especially if they include integration tests (e.g. Integration tests that use the <a href="http://www.seleniumhq.org">Selenium</a> driver)</p>

<p>Did the build pass? Did it fail? How many failures did you get?</p>

<p>In the best case scenario, the tests will pass.</p>

<h3>3. Review schema.rb</h3>

<p>A good way to see the complexity of an application is to see the amount of tables in the database. Does it have more than 20 tables? More than 100? Can you easily draw an <a href="https://en.wikipedia.org/wiki/Entity%E2%80%93relationship_model">ERD</a> of the core models? Are the tables normalized?</p>

<p>I like doing the exercise of drawing the core business tables and the relationships between them. This usually helps me understand the business behind the project.</p>

<h3>4. Review .env</h3>

<p>Does the project have a <code>.env</code> file or similar? If the project doesn’t have one, it’s a clear sign that there will be trouble moving the project across environments (development, test, staging, production)</p>

<p>By now we should all know that <a href="http://12factor.net/config">we should all be using environment variables</a>. If someone developed this project without <em>env</em> variables, you will probably find condition statements for this problem all over the codebase.</p>

<h3>5. Check the Gemfile</h3>

<p>Find out the project&#39;s <a href="http://rubyonrails.org">Rails</a> version. Is it the latest version? Is it older than 3.0?</p>

<p>One thing that we’ve learned is that upgrading Rails in a project is <strong>not a walk in the park</strong>.</p>

<p>Does it use gems that are not currently maintained? This could be a sign that you will have to migrate to new gems, which will produce extra work and affect your estimates.</p>

<h3>6. Run bundle-audit</h3>

<p><a href="https://rubygems.org/gems/bundler-audit">Bundler Audit</a> is a useful gem that will check for known vulnerabilities for the gems specified in <code>Gemfile.lock</code></p>

<p>If there are any vulnerable dependencies, this tool will suggest that you upgrade to a patched version of the gem.</p>

<p>In the best case scenario, you will see something like this:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>etagwerker:ombushop/ <span class="o">(</span>master<span class="o">)</span> $ bundle-audit
No vulnerabilities found
</code></pre></div>
<h3>7. Setup Code Climate</h3>

<p>This is a quick (and <strong>paid</strong>) step to check code quality. At <a href="https://www.ombulabs.com">Ombu Labs</a> we have a business account that we use for our products and our client&#39;s projects.</p>

<p><a href="https://codeclimate.com">Code Climate</a> is a paid service that does automated code review for test coverage, complexity, duplication, security, and style.</p>

<p>You can quickly find <strong>code hotspots</strong>, potential issues, potential bug risks, and even coverage stats.</p>

<p>What is the <a href="https://docs.codeclimate.com/docs/ratings">GPA</a> of the project? 4.0? 1.5? This will give you an overall idea of the complexity within the project. 4.0 is the best you can get!</p>

<p>A free alternative would be to run some (or all) of these tools on the project:</p>

<ul>
<li><a href="https://rubygems.org/gems/flog">flog</a></li>
<li><a href="https://rubygems.org/gems/flay">flay</a></li>
<li><a href="https://rubygems.org/gems/metric_fu">metric_fu</a></li>
<li><a href="https://rubygems.org/gems/simplecov">simplecov</a></li>
</ul>

<h3>8. Check code coverage</h3>

<p>As much as I like <a href="https://codeclimate.com">Code Climate</a>, <a href="https://rubygems.org/gems/simplecov">simplecov</a> is an even faster way to generate a quick report about code coverage.</p>

<p>This tool will tell you the coverage percentage for each application layer. How much percentage is covered in the models&#39; tests? How much for the controllers&#39; tests?</p>

<p>Which are the least covered files? How many relevant lines are in each file? How many of them are covered by a test?</p>

<p>The overall test coverage percentage will give you an idea about how much past developers cared about tests.</p>

<p>If you are going to be changing the code, you need to make sure that this code is covered. If not, it will be a nightmare!</p>

<p>You should complement this report with a qualitative code review of the tests, to make sure that the coverage is actually thorough.</p>

<h3>9. Research the development process</h3>

<p>Do the developers have a process to introduce changes to the project? Do they use code reviews before they merge anything to <code>master</code>? Do they have a <a href="https://en.wikipedia.org/wiki/Continuous_integration">CI</a> service that runs with every pull request? Do they even use pull requests?</p>

<p>What&#39;s in the roadmap for the next 3 months? Is this project <strong>on fire</strong>? Do they need a firefighter? Why is it on fire?</p>

<h3>10. Review performance stats</h3>

<p>Do they use <a href="https://www.skylight.io/r/qGCIS90vk2nD">Skylight</a>? <a href="http://newrelic.com">NewRelic</a>? What are the slowest and busiest requests? What are the main performance problems?</p>

<p>Most projects won&#39;t have information from these (<strong>paid</strong>) services. So you will have to find out on your own. If they use <a href="https://www.google.com/analytics/">Google Analytics</a>, you might find some information about poor page performance.</p>

<h2>Conclusion</h2>

<p>These are the steps that we currently follow before we take over a Rails project. They&#39;ve been quite helpful for us. I recommend that you use them to judge the quality of the project as objectively as possible.</p>

<p>Project maintainers, product owners and founders won&#39;t know the state of the code. You can&#39;t trust their opinion.</p>

<p>At <a href="https://www.ombulabs.com">Ombu Labs</a>, if all these steps <strong>pass</strong> we will be happy to take over the project. If most of them <strong>fail</strong> we will usually send the company a <strong>free</strong> code quality report and respectfully decline.</p>

<p>I would love to know your opinion about these steps. Do you have other steps that you would recommend? Let me know!</p>
]]></content:encoded>
      <dc:date>2016-02-17T08:55:00-05:00</dc:date>
    </item>
    <item>
      <title>Set up and run Hubot without using Heroku</title>
      <link>https://www.ombulabs.com/blog/hubot/linux/set-up-and-run-hubot-in-non-heroku-server.html</link>
      <description><![CDATA[Hubot makes it incredibly easy to setup on a Heroku
server, by taking advantage of its Procfile support. Simply running
git push heroku master deploys the app and starts it.

When it comes to deploying to your own Linux server, given that
foreman doesn&#39;t really like background processes (see:
ddollar/foreman#65), you need to
use something like monit, systemd or tmux to better manage your Hubot
process.
]]></description>
      <pubDate>Fri, 29 Jan 2016 06:16:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/hubot/linux/set-up-and-run-hubot-in-non-heroku-server.html</guid>
      <content:encoded><![CDATA[<p><a href="https://hubot.github.com">Hubot</a> makes it incredibly easy to setup on a Heroku
server, by taking advantage of its Procfile support. Simply running
<code>git push heroku master</code> deploys the app and starts it.</p>

<p>When it comes to deploying to your own Linux server, given that
<code>foreman</code> doesn&#39;t really like background processes (see:
<a href="https://github.com/ddollar/foreman/issues/65">ddollar/foreman#65</a>), you need to
use something like <code>monit</code>, <code>systemd</code> or <code>tmux</code> to better manage your Hubot
process.</p>

<!--more-->

<p>If you don&#39;t already have your own Hubot repository, you can easily create one.
The easiest way is using the hubot generator:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>npm install -g yo generator-hubot
</code></pre></div>
<p>Run the generator in a folder of your choosing:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ mkdir myhubot
$ <span class="nb">cd</span> myhubot
$ yo hubot
</code></pre></div>
<p>Go through the steps the generator takes you, and when you&#39;re done, initialize a
Git repository and push it to Github or your preferred Git server.</p>

<p>Go ahead and choose where you want to run your Hubot from and SSH into your
instance (we used an AWS EC2 instance). Once in it, you can clone your Hubot
repository, or if you prefer, create a Capistrano recipe and deploy it.  </p>

<p>As I mentioned before, you could run <code>foreman start</code> now to check that your bot
is working, but you can&#39;t leave it running in the background out-of-the-box, as
<code>foreman</code> is not friendly to background processes.</p>

<p>You can work around this by leaving <code>foreman</code> itself running in a dettached tmux
session:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ tmux new -s hubot
$ <span class="nb">cd</span> /path/to/hubot
$ foreman start
&lt;Ctrl-b&gt;-d
</code></pre></div>
<p>This is <strong>not the best way to do it</strong>, as the process could end unexpectedly and
it won&#39;t come up again. This forces you to re-attach to the session or kill it
and restart Hubot manually.</p>

<p>The best way is to use either a <code>systemd</code> service or <code>monit</code>. For a <code>monit</code>
example, check out
<a href="https://gist.github.com/philcryer/d391b72511f4b69cece3">this gist</a>.</p>

<p>In our case, we use <code>systemd</code>, which allows us to start it by running
<code>sudo service hubot start</code>. To do this, create the following service file:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="p">;</span> Hubot systemd service unit file
<span class="p">;</span> Place in e.g. <span class="sb">`</span>/etc/systemd/system/hubot.service<span class="sb">`</span>, <span class="k">then</span>
<span class="p">;</span> <span class="sb">`</span>systemctl daemon-reload<span class="sb">`</span> and <span class="sb">`</span>service hubot start<span class="sb">`</span>.

<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Hubot
<span class="nv">Requires</span><span class="o">=</span>network.target
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">WorkingDirectory</span><span class="o">=</span>/path/to/hubot
<span class="nv">User</span><span class="o">=</span>deployer

<span class="nv">Restart</span><span class="o">=</span>always
<span class="nv">RestartSec</span><span class="o">=</span><span class="m">10</span>

<span class="nv">ExecStart</span><span class="o">=</span>/bin/bash -a -c <span class="s1">&#39;cd /path/to/hubot &amp;&amp; source .env &amp;&amp; /bin/hubot --adapter slack&#39;</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>
<p>Finally, you can run <code>systemctl daemon-reload</code> and then
<code>sudo service hubot start</code>. Any changes you make to the bot can be obtained
using <code>git pull origin master</code> and then restarting the Hubot service
(<code>service hubot restart</code>), or by using Capistrano if you wrote the deploy recipe
for it.</p>

<p>Hubot is a nice addition to your team, and if you use the Slack
integration, you can use it for cool stuff like deploying via your CI server,
or simple things like getting pictures of pugs delivered to your channel!</p>

<p><img src="https://cloud.githubusercontent.com/assets/17584/12687311/c6f97cc6-c6ad-11e5-91b6-4e0c861aa196.png" alt="pug me"></p>
]]></content:encoded>
      <dc:date>2016-01-29T06:16:00-05:00</dc:date>
    </item>
    <item>
      <title>Let vs Instance Variables</title>
      <link>https://www.ombulabs.com/blog/rails/rspec/ruby/let-vs-instance.html</link>
      <description><![CDATA[Maybe in the past you stumbled over the two different approaches to setup your test variables. One way is the more programmatical approach by using instance variables, usually initialized in a before block.
]]></description>
      <pubDate>Fri, 22 Jan 2016 05:36:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/rspec/ruby/let-vs-instance.html</guid>
      <content:encoded><![CDATA[<p>Maybe in the past you stumbled over the two different approaches to setup your test variables. One way is the more programmatical approach by using instance variables, usually initialized in a <code>before</code> block.</p>

<!--more-->
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span>
  <span class="k">end</span>
</code></pre></div>
<p>The other option is <code>let</code>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span> <span class="p">}</span>
</code></pre></div>
<p>If you have seen this and you are still not sure, when to use instance variables and when <code>let</code>, then you will in the following examples.</p>

<p>For this example I have chosen a simple setup in which I want to create 2 users and check their attributes.</p>

<p>To properly reset the database with <a href="https://github.com/DatabaseCleaner/database_cleaner">DatabaseCleaner</a> after each test, you can use this snippet below:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:suite</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">strategy</span> <span class="o">=</span> <span class="ss">:transaction</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
    <span class="no">DatabaseCleaner</span><span class="o">.</span><span class="n">cleaning</span> <span class="k">do</span>
      <span class="n">example</span><span class="o">.</span><span class="n">run</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">infer_spec_type_from_file_location!</span>
<span class="k">end</span>
</code></pre></div>
<p>My setup with instance variables looks like this:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;foo@ombulabs.com&#39;</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;foofoo&#39;</span>
    <span class="vi">@user_2</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;bar@ombulabs.com&#39;</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;barbar&#39;</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;check user username&#39;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;foofoo&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;check user_2 email&#39;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="vi">@user_2</span><span class="o">.</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;bar@ombulabs.com&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;combined test that checks all users&#39;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;foo@ombulabs.com&#39;</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="vi">@user_2</span><span class="o">.</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;barbar&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>And the setup with <code>let</code> would look like this:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;foo@ombulabs.com&#39;</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;foofoo&#39;</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:user_2</span><span class="p">)</span> <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;bar@ombulabs.com&#39;</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;barbar&#39;</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">&#39;check user username&#39;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;foofoo&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;check user_2 email&#39;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">user_2</span><span class="o">.</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;bar@ombulabs.com&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;combined test that checks all users&#39;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;foo@ombulabs.com&#39;</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">user_2</span><span class="o">.</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;barbar&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>So let&#39;s run both specs separately and have a look on the output.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ bin/rspec spec/models/user_instance_spec.rb
...

Finished in <span class="m">0</span>.087 seconds <span class="o">(</span>files took <span class="m">2</span>.87 seconds to load<span class="o">)</span>
<span class="m">3</span> examples, <span class="m">0</span> failures
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ bin/rspec spec/models/user_let_spec.rb
...

Finished in <span class="m">0</span>.06692 seconds <span class="o">(</span>files took <span class="m">3</span>.06 seconds to load<span class="o">)</span>
<span class="m">3</span> examples, <span class="m">0</span> failures
</code></pre></div>
<p>What we already can see is that the <code>let</code>-tests are faster.</p>

<p>If we have a look at the test logs, we can see why that is.</p>

<p>Log output of <code>user_instance_spec.rb</code>:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>SQL <span class="o">(</span><span class="m">2</span>.6ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;foo@ombulabs.com&#39;</span>, <span class="s1">&#39;foofoo&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span><span class="o">)</span>
SQL <span class="o">(</span><span class="m">0</span>.3ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;bar@ombulabs.com&#39;</span>, <span class="s1">&#39;barbar&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span><span class="o">)</span>
SQL <span class="o">(</span><span class="m">0</span>.5ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;foo@ombulabs.com&#39;</span>, <span class="s1">&#39;foofoo&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span><span class="o">)</span>
SQL <span class="o">(</span><span class="m">0</span>.4ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;bar@ombulabs.com&#39;</span>, <span class="s1">&#39;barbar&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span><span class="o">)</span>
SQL <span class="o">(</span><span class="m">0</span>.3ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;foo@ombulabs.com&#39;</span>, <span class="s1">&#39;foofoo&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span><span class="o">)</span>
SQL <span class="o">(</span><span class="m">0</span>.3ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;bar@ombulabs.com&#39;</span>, <span class="s1">&#39;barbar&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span>, <span class="s1">&#39;2016-01-22 16:44:42&#39;</span><span class="o">)</span>
</code></pre></div>
<p>As we can see here, that apparently for each of my tests all records are being created.
This is not the case for <code>let</code> examples, if we have a look at the log output.</p>

<p>Log output of <code>user_let_spec.rb</code>:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>SQL <span class="o">(</span><span class="m">0</span>.7ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;foo@ombulabs.com&#39;</span>, <span class="s1">&#39;foofoo&#39;</span>, <span class="s1">&#39;2016-01-22 16:47:45&#39;</span>, <span class="s1">&#39;2016-01-22 16:47:45&#39;</span><span class="o">)</span>
SQL <span class="o">(</span><span class="m">0</span>.4ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;bar@ombulabs.com&#39;</span>, <span class="s1">&#39;barbar&#39;</span>, <span class="s1">&#39;2016-01-22 16:47:45&#39;</span>, <span class="s1">&#39;2016-01-22 16:47:45&#39;</span><span class="o">)</span>
SQL <span class="o">(</span><span class="m">0</span>.3ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;foo@ombulabs.com&#39;</span>, <span class="s1">&#39;foofoo&#39;</span>, <span class="s1">&#39;2016-01-22 16:47:45&#39;</span>, <span class="s1">&#39;2016-01-22 16:47:45&#39;</span><span class="o">)</span>
SQL <span class="o">(</span><span class="m">0</span>.3ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;bar@ombulabs.com&#39;</span>, <span class="s1">&#39;barbar&#39;</span>, <span class="s1">&#39;2016-01-22 16:47:45&#39;</span>, <span class="s1">&#39;2016-01-22 16:47:45&#39;</span><span class="o">)</span>
</code></pre></div>
<p>As we can see in the log output, we count 6 SQL Inserts for the instance example and just 4 SQL Inserts for the <code>let</code> example. This is because the variables configured with <code>let</code> will be loaded if we directly call them. This behavior is called lazy loading and forgives small mistakes when writing tests.</p>

<p>If we now have a closer look at the instance variable example, you see there the use of <code>before</code>. This is the default RSpec behavior and actually translates to <code>before(:each)</code>. This means the <code>before</code> block gets executed before <strong>every</strong> single test. If you have a really complex test setup in which you use a <code>before(:each)</code>, you are most likely wasting a lot of time setting up your tests.</p>

<p>For the next example I&#39;m going to use <code>before(:all)</code> to see what changes. So my before block looks now like this:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="n">before</span><span class="p">(</span><span class="ss">:all</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;foo@ombulabs.com&#39;</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;foofoo&#39;</span>
    <span class="vi">@user_2</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;bar@ombulabs.com&#39;</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;barbar&#39;</span>
  <span class="k">end</span>
</code></pre></div>
<p>And the log output of my spec is the following:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ bin/rspec spec/models/user_instance_before_all_spec.rb
...

Finished in <span class="m">0</span>.06128 seconds <span class="o">(</span>files took <span class="m">3</span>.68 seconds to load<span class="o">)</span>
<span class="m">3</span> examples, <span class="m">0</span> failures
</code></pre></div>
<p>My <code>test.log</code> gives me the following output:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>SQL <span class="o">(</span><span class="m">13</span>.2ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;foo@ombulabs.com&#39;</span>, <span class="s1">&#39;foofoo&#39;</span>, <span class="s1">&#39;2016-01-22 16:48:31&#39;</span>, <span class="s1">&#39;2016-01-22 16:48:31&#39;</span><span class="o">)</span>
SQL <span class="o">(</span><span class="m">5</span>.2ms<span class="o">)</span>  INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> <span class="o">(</span><span class="sb">`</span>email<span class="sb">`</span>, <span class="sb">`</span>username<span class="sb">`</span>, <span class="sb">`</span>created_at<span class="sb">`</span>, <span class="sb">`</span>updated_at<span class="sb">`</span><span class="o">)</span> VALUES <span class="o">(</span><span class="s1">&#39;bar@ombulabs.com&#39;</span>, <span class="s1">&#39;barbar&#39;</span>, <span class="s1">&#39;2016-01-22 16:48:31&#39;</span>, <span class="s1">&#39;2016-01-22 16:48:31&#39;</span><span class="o">)</span>
</code></pre></div>
<p>So basically the <code>before(:all)</code> block ensures that we are only creating everything inside this <strong>once</strong>. The <code>before(:all)</code> can save you some time, when executing tests that need the exact same setup, otherwise I prefer to use the <code>let</code> syntax because it&#39;s easier to read.</p>

<p>Another great benefit of <code>let</code> is the flexible redefinition of variables to change a most likely complex setup.
You just need to change a <code>let</code> variable within a context block and you are able to use the exact setup with different variables just by changing one line.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">RSpec</span><span class="o">.</span><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:model</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>    <span class="p">{</span> <span class="s1">&#39;OmbuLabs&#39;</span> <span class="p">}</span>
  <span class="n">let!</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>   <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;foo@ombulabs.com&#39;</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="nb">name</span> <span class="p">}</span>
  <span class="n">let!</span><span class="p">(</span><span class="ss">:user_2</span><span class="p">)</span> <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span> <span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;bar@ombulabs.com&#39;</span><span class="p">,</span> <span class="ss">username</span><span class="p">:</span> <span class="s1">&#39;barbar&#39;</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">&#39;check user username&#39;</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;OmbuLabs&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">&#39;ombushop username&#39;</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;OmbuShop&#39;</span> <span class="p">}</span>

    <span class="n">it</span> <span class="s1">&#39;check user username&#39;</span> <span class="k">do</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">&#39;OmbuShop&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Benefits with <code>let</code>:</p>

<ul>
<li>Lazy loaded variables</li>
<li>Faster than <code>before(:each)</code>, slower than <code>before(:all)</code></li>
<li>Better readability</li>
<li>Flexible usage</li>
</ul>

<p>Benefits with instance variables:</p>

<ul>
<li>Useful for tests that need just one simple setup with a <code>before(:all)</code></li>
</ul>

<p>Let&#39;s sum it up, if your test setup allows it, use instance variables in a <code>before(:all)</code> block, otherwise I recommend using <code>let</code>.</p>
]]></content:encoded>
      <dc:date>2016-01-22T05:36:00-05:00</dc:date>
    </item>
    <item>
      <title>Protect your sensitive data in Git</title>
      <link>https://www.ombulabs.com/blog/open-source/security/protect-your-sensitive-data-in-git.html</link>
      <description><![CDATA[If you are working with open source or if you are going to open source a repository, you should ensure that none of your sensitive data (API Keys, Credentials, Passwords) can be accessed by anyone.

One thing that a lot of people forget, is that this information stay forever in your repository history, if you do not rewrite the history of your repository.

For instance, what usually happens is that you commit a file with sensitive information. In this Example I added accidentally my ssh-key to the repo:
$ git commit -am &#39;init git repo&#39;
[master (root-commit) 917a1e1] init git repo
 2 files changed, 52 insertions(+)
 create mode 100644 id_rsa
 create mode 100644 id_rsa.pub

After doing a couple of additions, working and editing, I realise that I should never have commited the ssh-key. *facepalm*

Alright, then I just do a simple git rm --cached id_rsa and everything is back to normal. I also add this file to a .gitignore, so that this cannot happen in the future anymore.
(master) $ git rm --cached id_rsa
rm &#39;id_rsa&#39;
(master) $ git status
A  .gitignore
D  id_rsa
(master) $ git commit -am &#39;remove id_rsa&#39;
[master c69deb9] remove id_rsa
 2 files changed, 1 insertion(+), 51 deletions(-)
 create mode 100644 .gitignore
 delete mode 100644 id_rsa

So if we now have a look in our commit list, we can still see our first commit where I added my ssh-key. If I checkout this commit, I still have the contents of my ssh-key available.
(master) $ git log
917a1e1 - init git repo (24 minutes ago) &lt;Sirko Sittig&gt;
(master) $ git checkout 917a1e1
((detached from 917a1e1)) $ cat id_rsa
-----BEGIN RSA PRIVATE KEY-----
MIIJKQIBAAKCAgEAoequrqsM42na3OpvBFYOpqvzJumr3/kxJTuluXbPyJzVjMXf
d/uhFUJgSqq4AJGOFLLPpQ+9jwfA+WraIxZ9R7p8LgpNdUwKsmGnUvofeD/9Rs1y
YZO8EAjl1URLJ379nN+L5KKPS/48Q4iGp57iwuGzrXLHccLyW5+Z0iMuHlKBQzPx
...

To ensure that ALL of this data gets properly removed, I need to remove this file from all the commits in the repository with git filter-branch. The command git rm --cached git rm docs is not sufficient in this case.
(master) $ git filter-branch --tree-filter &#39;rm -f id_rsa&#39; HEAD
Rewrite c69deb9779a30e6335ab1a8ac1a0825cfc9302e4 (6/6)
Ref &#39;refs/heads/master&#39; was rewritten

So far so good, but what about my other branches that have been created?
bash
(master) $ git checkout new-feature
(new-feature) $ ls
drwxrwxr-x  3 sirko sirko  4096 Dec 31 13:20 ./
drwx------ 56 sirko sirko 12288 Dec 31 12:37 ../
drwxrwxr-x  8 sirko sirko  4096 Dec 31 13:20 .git/
-rw-rw-r--  1 sirko sirko  3243 Dec 31 13:20 id_rsa
-rw-r--r--  1 sirko sirko   748 Dec 31 12:41 id_rsa.pub
-rw-rw-r--  1 sirko sirko    64 Dec 31 13:20 my_document.txt


Apparently git filter-branch is applying this changes only to the current branch, which is actually not what I want. To make this work, it seems that I have to run git filter-branch in every existing branch, which makes it pretty annoying. After reading more in the (git docs)[https://git-scm.com/docs/git-filter-branch], I found that I need to apply the --all option.
(master) $ git filter-branch --tree-filter &#39;rm -f id_rsa&#39; HEAD --all
Rewrite c69deb9779a30e6335ab1a8ac1a0825cfc9302e4 (7/7)
Ref &#39;refs/heads/master&#39; was rewritten
WARNING: Ref &#39;refs/heads/master&#39; is unchanged
Ref &#39;refs/remotes/origin/master&#39; was rewritten
WARNING: Ref &#39;refs/remotes/origin/master&#39; is unchanged
Ref &#39;refs/remotes/origin/new-feature&#39; was rewritten
(master) $ git checkout new-feature
(new-feature) $ ll
total 44
drwxrwxr-x  3 sirko sirko  4096 Dec 31 13:41 ./
drwx------ 57 sirko sirko 12288 Dec 31 13:41 ../
drwxrwxr-x  8 sirko sirko  4096 Dec 31 13:41 .git/
-rw-rw-r--  1 sirko sirko   748 Dec 31 13:41 id_rsa.pub
-rw-rw-r--  1 sirko sirko    64 Dec 31 13:41 my_document.txt

That seems to be exactly what I want and in the end I just need to git push --all --force my changes. After doing this, all collaborators should dump their local versions and clone a fresh version from the origin.

Another alternative to working with git filter-branch is BFG which has some more nifty features.

This tool provides some commands to completely remove big files as well as passwords from your Git history. Sadly I could not get it properly working, big files are still persistent as a git object and passwords can not be deleted because they are protected by &#39;HEAD&#39;. I could not really find a solution for these problems. Maybe you are more lucky!

The easiest and much simpler solution is to initialize a new git repository, after making sure to have all sensitive information removed. The downside is obviously the loss of the project&#39;s Git history.
]]></description>
      <pubDate>Thu, 21 Jan 2016 05:36:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/open-source/security/protect-your-sensitive-data-in-git.html</guid>
      <content:encoded><![CDATA[<p>If you are working with open source or if you are going to open source a repository, you should ensure that none of your sensitive data (API Keys, Credentials, Passwords) can be accessed by anyone.</p>

<p><strong>One thing that a lot of people forget, is that this information stay forever in your repository history, if you do not rewrite the history of your repository.</strong></p>

<p>For instance, what usually happens is that you commit a file with sensitive information. In this Example I added accidentally my <code>ssh-key</code> to the repo:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>$ git commit -am <span class="s1">&#39;init git repo&#39;</span>
<span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 917a1e1<span class="o">]</span> init git repo
 <span class="m">2</span> files changed, <span class="m">52</span> insertions<span class="o">(</span>+<span class="o">)</span>
 create mode <span class="m">100644</span> id_rsa
 create mode <span class="m">100644</span> id_rsa.pub
</code></pre></div>
<p>After doing a couple of additions, working and editing, I realise that I should never have commited the <code>ssh-key</code>. *facepalm*</p>

<p>Alright, then I just do a simple <code>git rm --cached id_rsa</code> and everything is back to normal. I also add this file to a .gitignore, so that this cannot happen in the future anymore.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">(</span>master<span class="o">)</span> $ git rm --cached id_rsa
rm <span class="s1">&#39;id_rsa&#39;</span>
<span class="o">(</span>master<span class="o">)</span> $ git status
A  .gitignore
D  id_rsa
<span class="o">(</span>master<span class="o">)</span> $ git commit -am <span class="s1">&#39;remove id_rsa&#39;</span>
<span class="o">[</span>master c69deb9<span class="o">]</span> remove id_rsa
 <span class="m">2</span> files changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>, <span class="m">51</span> deletions<span class="o">(</span>-<span class="o">)</span>
 create mode <span class="m">100644</span> .gitignore
 delete mode <span class="m">100644</span> id_rsa
</code></pre></div>
<p>So if we now have a look in our commit list, we can still see our first commit where I added my ssh-key. If I checkout this commit, I still have the contents of my <code>ssh-key</code> available.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">(</span>master<span class="o">)</span> $ git log
917a1e1 - init git repo <span class="o">(</span><span class="m">24</span> minutes ago<span class="o">)</span> &lt;Sirko Sittig&gt;
<span class="o">(</span>master<span class="o">)</span> $ git checkout 917a1e1
<span class="o">((</span>detached from 917a1e1<span class="o">))</span> $ cat id_rsa
-----BEGIN RSA PRIVATE KEY-----
MIIJKQIBAAKCAgEAoequrqsM42na3OpvBFYOpqvzJumr3/kxJTuluXbPyJzVjMXf
d/uhFUJgSqq4AJGOFLLPpQ+9jwfA+WraIxZ9R7p8LgpNdUwKsmGnUvofeD/9Rs1y
YZO8EAjl1URLJ379nN+L5KKPS/48Q4iGp57iwuGzrXLHccLyW5+Z0iMuHlKBQzPx
...
</code></pre></div>
<p>To ensure that ALL of this data gets properly removed, I need to remove this file from all the commits in the repository with <a href="https://git-scm.com/docs/git-filter-branch">git filter-branch</a>. The command <code>git rm --cached</code> <a href="https://git-scm.com/docs/git-rm">git rm docs</a> is not sufficient in this case.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">(</span>master<span class="o">)</span> $ git filter-branch --tree-filter <span class="s1">&#39;rm -f id_rsa&#39;</span> HEAD
Rewrite c69deb9779a30e6335ab1a8ac1a0825cfc9302e4 <span class="o">(</span><span class="m">6</span>/6<span class="o">)</span>
Ref <span class="s1">&#39;refs/heads/master&#39;</span> was rewritten
</code></pre></div>
<p>So far so good, but what about my other branches that have been created?
<code>bash
(master) $ git checkout new-feature
(new-feature) $ ls
drwxrwxr-x  3 sirko sirko  4096 Dec 31 13:20 ./
drwx------ 56 sirko sirko 12288 Dec 31 12:37 ../
drwxrwxr-x  8 sirko sirko  4096 Dec 31 13:20 .git/
-rw-rw-r--  1 sirko sirko  3243 Dec 31 13:20 id_rsa
-rw-r--r--  1 sirko sirko   748 Dec 31 12:41 id_rsa.pub
-rw-rw-r--  1 sirko sirko    64 Dec 31 13:20 my_document.txt
</code></p>

<p>Apparently <code>git filter-branch</code> is applying this changes only to the current branch, which is actually not what I want. To make this work, it seems that I have to run <code>git filter-branch</code> in every existing branch, which makes it pretty annoying. After reading more in the (git docs)[https://git-scm.com/docs/git-filter-branch], I found that I need to apply the <code>--all</code> option.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">(</span>master<span class="o">)</span> $ git filter-branch --tree-filter <span class="s1">&#39;rm -f id_rsa&#39;</span> HEAD --all
Rewrite c69deb9779a30e6335ab1a8ac1a0825cfc9302e4 <span class="o">(</span><span class="m">7</span>/7<span class="o">)</span>
Ref <span class="s1">&#39;refs/heads/master&#39;</span> was rewritten
WARNING: Ref <span class="s1">&#39;refs/heads/master&#39;</span> is unchanged
Ref <span class="s1">&#39;refs/remotes/origin/master&#39;</span> was rewritten
WARNING: Ref <span class="s1">&#39;refs/remotes/origin/master&#39;</span> is unchanged
Ref <span class="s1">&#39;refs/remotes/origin/new-feature&#39;</span> was rewritten
<span class="o">(</span>master<span class="o">)</span> $ git checkout new-feature
<span class="o">(</span>new-feature<span class="o">)</span> $ ll
total <span class="m">44</span>
drwxrwxr-x  <span class="m">3</span> sirko sirko  <span class="m">4096</span> Dec <span class="m">31</span> <span class="m">13</span>:41 ./
drwx------ <span class="m">57</span> sirko sirko <span class="m">12288</span> Dec <span class="m">31</span> <span class="m">13</span>:41 ../
drwxrwxr-x  <span class="m">8</span> sirko sirko  <span class="m">4096</span> Dec <span class="m">31</span> <span class="m">13</span>:41 .git/
-rw-rw-r--  <span class="m">1</span> sirko sirko   <span class="m">748</span> Dec <span class="m">31</span> <span class="m">13</span>:41 id_rsa.pub
-rw-rw-r--  <span class="m">1</span> sirko sirko    <span class="m">64</span> Dec <span class="m">31</span> <span class="m">13</span>:41 my_document.txt
</code></pre></div>
<p>That seems to be exactly what I want and in the end I just need to <code>git push --all --force</code> my changes. <strong>After doing this, all collaborators should dump their local versions and clone a fresh version from the origin.</strong></p>

<p>Another alternative to working with <code>git filter-branch</code> is <a href="https://rtyley.github.io/bfg-repo-cleaner/">BFG</a> which has some more nifty features.</p>

<p>This tool provides some commands to completely remove big files as well as passwords from your Git history. Sadly I could not get it properly working, big files are still persistent as a git object and passwords can not be deleted because they are <code>protected by &#39;HEAD&#39;</code>. I could not really find a solution for these problems. Maybe you are more lucky!</p>

<p>The easiest and much simpler solution is to initialize a new git repository, after making sure to have all sensitive information removed. The downside is obviously the loss of the project&#39;s Git history.</p>
]]></content:encoded>
      <dc:date>2016-01-21T05:36:00-05:00</dc:date>
    </item>
    <item>
      <title>How to report a bug</title>
      <link>https://www.ombulabs.com/blog/open-source/bugs/how-to-report-a-bug.html</link>
      <description><![CDATA[The simplest way to contribute to an open source project is to file an issue. Here are a few steps for you to file issues that are useful for the project maintainers.

1. Make sure it hasn&#39;t been reported yet

A quick Google search should return one or more results about the issue. If it&#39;s user error, just change the way you are using the code and move on.

If that doesn&#39;t work, find the project (it&#39;s probably on Github) and search through open and closed issues. If it&#39;s filed and open, try to add more information to make it easier to solve. (Please please please don&#39;t just add another +1 to a series of +1s)

If you couldn&#39;t find any issues, submit an issue (Beware: some projects will encourage you to post to their mailing list before filing an issue)

2. Submit a useful issue report

Don&#39;t just post the title of the error and what you were doing when it happened.

Please be as specific as possible!

Post information about:


The environment (a snapshot of Gemfile.lock could help)
The error message (a good candidate for the issue&#39;s title)
The backtrace should always be included in the description
If there is some configuration involved, add it to the description


3. Bonus points


Try a couple of alternatives and see what results you get. Save all the output, which might be useful for the issue&#39;s resolution. I know that most of us try different solutions before filing an issue.
If you want to show the maintainer an example of the problem, you could create a sample application that generates the problem, using the same configuration and the same dependencies you have in your application.
If you found the problematic line in the library, you could enhance the tests to cover the scenario that you are seeing. The best libraries have near 100% code coverage, so adding another scenario could be easier than you think. You don&#39;t need to find the solution, but seeing a failing spec will definitely make it easier to find a solution.


4. Share your monkeypatch

Most of us will monkeypatch our application and move on. This sucks!

You should file the issue, so that other programmers will benefit from your &quot;wasted&quot; effort.

If you monkeypatched it in a horrible way, add it to the issue as well. The project maintainer or other programmers might find that it isn&#39;t such a horrible patch after all.

To sum things up

I&#39;ve explained a couple of ways that you can make a contribution to an open source project. I started with the simpler steps and then I moved on to the more advanced contributions.

Ideally, detailed issue reports will become pull requests in the future. You (or someone else) might send the pull request, but it all begins with a detailed description of the problem you are seeing.

Don&#39;t just say &quot;It doesn&#39;t work!&quot;, don&#39;t be that person! Next time file an issue so that we can all benefit from your pain.
]]></description>
      <pubDate>Fri, 01 Jan 2016 08:55:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/open-source/bugs/how-to-report-a-bug.html</guid>
      <content:encoded><![CDATA[<p>The simplest way to contribute to an open source project is to file an issue. Here are a few steps for you to file issues that are useful for the project maintainers.</p>

<h3>1. Make sure it hasn&#39;t been reported yet</h3>

<p>A quick Google search should return one or more results about the issue. If it&#39;s user error, just change the way you are using the code and move on.</p>

<p>If that doesn&#39;t work, find the project (it&#39;s probably on <a href="https://github.com">Github</a>) and search through open and closed issues. If it&#39;s filed and open, try to add more information to make it easier to solve. (<em>Please please please</em> don&#39;t just add another <strong>+1</strong> to a series of <strong>+1s</strong>)</p>

<p>If you couldn&#39;t find any issues, submit an issue (<em>Beware</em>: some projects will encourage you to post to their mailing list <em>before</em> filing an issue)</p>

<h3>2. Submit a useful issue report</h3>

<p>Don&#39;t just post the title of the error and what you were doing when it happened.</p>

<p><strong>Please be as specific as possible!</strong></p>

<p>Post information about:</p>

<ul>
<li>The environment (a snapshot of Gemfile.lock could help)</li>
<li>The error message (a good candidate for the issue&#39;s title)</li>
<li>The backtrace should <strong>always</strong> be included in the description</li>
<li>If there is some configuration involved, add it to the description</li>
</ul>

<h3>3. Bonus points</h3>

<ul>
<li><p>Try a couple of alternatives and see what results you get. Save all the output, which might be useful for the issue&#39;s resolution. I know that most of us try different solutions before filing an issue.</p></li>
<li><p>If you want to show the maintainer an example of the problem, you could create a sample application that generates the problem, using the same configuration and the same dependencies you have in your application.</p></li>
<li><p>If you found the problematic line in the library, you could enhance the tests to cover the scenario that you are seeing. The best libraries have near 100% code coverage, so adding another scenario could be easier than you think. You don&#39;t need to find the solution, but seeing a failing spec will definitely make it easier to find a solution.</p></li>
</ul>

<h3>4. Share your monkeypatch</h3>

<p>Most of us will <a href="http://devblog.avdi.org/2008/02/23/why-monkeypatching-is-destroying-ruby">monkeypatch</a> our application and move on. <strong>This sucks!</strong></p>

<p>You should file the issue, so that other programmers will benefit from your &quot;wasted&quot; effort.</p>

<p>If you monkeypatched it in a horrible way, add it to the issue as well. The project maintainer or other programmers might find that it isn&#39;t such a horrible patch after all.</p>

<h3>To sum things up</h3>

<p>I&#39;ve explained a couple of ways that you can make a contribution to an open source project. I started with the simpler steps and then I moved on to the more advanced contributions.</p>

<p>Ideally, detailed issue reports will become pull requests in the future. You (or someone else) might send the pull request, but it all begins with a detailed description of the problem you are seeing.</p>

<p>Don&#39;t just say <em>&quot;It doesn&#39;t work!&quot;</em>, don&#39;t be that person! Next time file an issue so that we can all benefit from your pain.</p>
]]></content:encoded>
      <dc:date>2016-01-01T08:55:00-05:00</dc:date>
    </item>
    <item>
      <title>Adding Docker to a Ruby gem</title>
      <link>https://www.ombulabs.com/blog/docker/rubygems/open-source/adding-docker-to-a-ruby-gem.html</link>
      <description><![CDATA[As a maintainer of a few Ruby gems, I have to decide what is accepted and what gets rejected into the gems. The other day someone submitted a pull request to add a Dockerfile to DatabaseCleaner

I thought it was a good idea, because the current version of DatabaseCleaner requires you to have Postgres, MySQL, Redis, and Mongo up and running before you run rake.

Here are the steps:


Download the Docker Toolbox, a 176+ MB package.
Install the package, which will expand to 400+ MB in your filesystem.
In the terminal: docker-machine start default
Then within your project: docker-compose up (before this I had to run eval &quot;$(docker-machine env default)&quot; because of this issue). Get ready to wait for a few minutes while it sets up your virtual machine.
Finally: docker-compose run --rm gem

]]></description>
      <pubDate>Tue, 29 Dec 2015 08:55:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/docker/rubygems/open-source/adding-docker-to-a-ruby-gem.html</guid>
      <content:encoded><![CDATA[<p>As a maintainer of a few Ruby gems, I have to decide what is accepted and what gets rejected into the gems. The other day someone submitted a <a href="https://github.com/DatabaseCleaner/database_cleaner/pull/384">pull request</a> to add a Dockerfile to <a href="https://github.com/DatabaseCleaner/database_cleaner">DatabaseCleaner</a></p>

<p>I thought it was a good idea, because the current version of DatabaseCleaner requires you to have Postgres, MySQL, Redis, and Mongo up and running before you run <code>rake</code>.</p>

<p>Here are the steps:</p>

<ol>
<li><p>Download the <a href="https://www.docker.com/docker-toolbox">Docker Toolbox</a>, a 176+ MB package.</p></li>
<li><p>Install the package, which will expand to 400+ MB in your filesystem.</p></li>
<li><p>In the terminal: <code>docker-machine start default</code></p></li>
<li><p>Then within your project: <code>docker-compose up</code> (before this I had to run <code>eval &quot;$(docker-machine env default)&quot;</code> because of <a href="https://github.com/docker/compose/issues/2180#issuecomment-147766435">this issue</a>). Get ready to wait for a few minutes while it sets up your virtual machine.</p></li>
<li><p>Finally: <code>docker-compose run --rm gem</code></p></li>
</ol>

<!--more-->

<p>Supposedly these steps should start the required services and run the build. I was expecting to watch it pass, but this is what I saw:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>Installing mongo_ext <span class="m">0</span>.19.3 with native extensions

Gem::Ext::BuildError: ERROR: Failed to build gem native extension.

    /usr/local/rvm/rubies/ruby-2.2.2/bin/ruby -r ./siteconf20151224-6-fhvc98.rb extconf.rb
checking <span class="k">for</span> asprintf<span class="o">()</span>... *** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of necessary
libraries and/or headers.  Check the mkmf.log file <span class="k">for</span> more details.  You may
need configuration options.

Provided configuration options:
    --with-opt-dir
    --without-opt-dir
    --with-opt-include
    --without-opt-include<span class="o">=</span><span class="si">${</span><span class="nv">opt</span><span class="p">-dir</span><span class="si">}</span>/include
    --with-opt-lib
    --without-opt-lib<span class="o">=</span><span class="si">${</span><span class="nv">opt</span><span class="p">-dir</span><span class="si">}</span>/lib
    --with-make-prog
    --without-make-prog
    --srcdir<span class="o">=</span>.
    --curdir
    --ruby<span class="o">=</span>/usr/local/rvm/rubies/ruby-2.2.2/bin/<span class="k">$(</span>RUBY_BASE_NAME<span class="k">)</span>
</code></pre></div>
<p>If I were to add this contribution, I&#39;d make sure that the <code>CONTRIBUTE.markdown</code> lists <a href="https://www.docker.com">Docker</a> as an <em>option</em> to run the specs, not as the default.</p>
]]></content:encoded>
      <dc:date>2015-12-29T08:55:00-05:00</dc:date>
    </item>
    <item>
      <title>Adding Csrf-Protection to your Rails-Backbone App</title>
      <link>https://www.ombulabs.com/blog/rails/backbone/security/adding-csrf-protection-to-your-rails-backbone-app.html</link>
      <description><![CDATA[When integrating Backbone.js in your Rails App, you might face the problem of the inability to verify the CSRF-Token.

The CSRF Protection secures your app with a token. Rails makes sure that the person who is interacting with your app is someone who started a session in your site, not some random attacker from another site. So you should not turn it off, unless you know what you are doing.

For more information on this Topic, check out the Rails Security Guide.

This problem occurs as soon as you are trying to send form data, without the CSRF-Token provided by Rails.
Started POST &quot;/products&quot; for 127.0.0.1 at 2015-12-16 10:06:05 -0300
Processing by ProductsController#create as JSON
  Parameters: {&quot;product&quot;=&gt;{&quot;name&quot;=&gt;&quot;foo&quot;}}
WARNING: Can&#39;t verify CSRF token authenticity
...
Completed 302 Found in 7.6ms (ActiveRecord: 0.8ms)

After this request, Rails will terminate your session and you will have to login again.

This problem is caused by your Backbone.js application, which is sending the data directly to the backend without providing the CSRF-Token.

To solve this problem you need to add the token to your Backbone request. One of the simplest solutions I came across is the following by Anton Shuvalov.
// https://github.com/shuvalov-anton/backbone-rails-sync
Backbone._sync = Backbone.sync;
Backbone.sync = function(method, model, options) {
  if (!options.noCSRF) {
    var beforeSend = options.beforeSend;

    // Set X-CSRF-Token HTTP header
    options.beforeSend = function(xhr) {
      var token = $(&#39;meta[name=&quot;csrf-token&quot;]&#39;).attr(&#39;content&#39;);
      if (token) { xhr.setRequestHeader(&#39;X-CSRF-Token&#39;, token); }
      if (beforeSend) { return beforeSend.apply(this, arguments); }
    };
  }
  return Backbone._sync(method, model, options);
};

It grabs the CSRF-Token provided in the meta tags of your Rails application and sets it for the request header field X-CSRF-Token.

After adding this to the Backbone code, it works as expected.
Started POST &quot;/products&quot; for 127.0.0.1 at 2015-12-16 10:08:29 -0300
Processing by ProductsController#create as JSON
  Parameters: {&quot;product&quot;=&gt;{&quot;name&quot;=&gt;&quot;foo&quot;}}
...
Completed 200 OK in 40.6ms (Views: 0.6ms | ActiveRecord: 10.3ms)
]]></description>
      <pubDate>Tue, 15 Dec 2015 22:55:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/rails/backbone/security/adding-csrf-protection-to-your-rails-backbone-app.html</guid>
      <content:encoded><![CDATA[<p>When integrating <a href="http://backbonejs.org">Backbone.js</a> in your <a href="http://rubyonrails.org">Rails</a> App, you might face the problem of the inability to verify the CSRF-Token.</p>

<p>The CSRF Protection secures your app with a token. Rails makes sure that the person who is interacting with your app is someone who started a session in your site, not some random attacker from another site. So you should not turn it off, unless you know what you are doing.</p>

<p>For more information on this Topic, check out the <a href="http://guides.rubyonrails.org/security.html#cross-site-request-forgery-csrf">Rails Security Guide</a>.</p>

<p>This problem occurs as soon as you are trying to send form data, without the CSRF-Token provided by Rails.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Started</span> <span class="no">POST</span> <span class="s2">&quot;/products&quot;</span> <span class="k">for</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">at</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">16</span> <span class="mi">10</span><span class="p">:</span><span class="mo">06</span><span class="p">:</span><span class="mo">05</span> <span class="o">-</span><span class="mo">0300</span>
<span class="no">Processing</span> <span class="n">by</span> <span class="no">ProductsController</span><span class="c1">#create as JSON</span>
  <span class="ss">Parameters</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;foo&quot;</span><span class="p">}}</span>
<span class="ss">WARNING</span><span class="p">:</span> <span class="no">Can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">verify</span> <span class="no">CSRF</span> <span class="n">token</span> <span class="n">authenticity</span>
<span class="o">...</span>
<span class="no">Completed</span> <span class="mi">302</span> <span class="no">Found</span> <span class="k">in</span> <span class="mi">7</span><span class="o">.</span><span class="mi">6</span><span class="n">ms</span> <span class="p">(</span><span class="ss">ActiveRecord</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="n">ms</span><span class="p">)</span>
</code></pre></div>
<p>After this request, Rails will terminate your session and you will have to login again.</p>

<p>This problem is caused by your Backbone.js application, which is sending the data directly to the backend without providing the CSRF-Token.</p>

<p>To solve this problem you need to add the token to your Backbone request. One of the simplest solutions I came across is the following by <a href="https://github.com/shuvalov-anton/backbone-rails-sync">Anton Shuvalov</a>.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="c1">// https://github.com/shuvalov-anton/backbone-rails-sync</span>
<span class="nx">Backbone</span><span class="p">.</span><span class="nx">_sync</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">sync</span><span class="p">;</span>
<span class="nx">Backbone</span><span class="p">.</span><span class="nx">sync</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">noCSRF</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">beforeSend</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeSend</span><span class="p">;</span>

    <span class="c1">// Set X-CSRF-Token HTTP header</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">beforeSend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;meta[name=&quot;csrf-token&quot;]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;X-CSRF-Token&#39;</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">beforeSend</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">beforeSend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">_sync</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>It grabs the CSRF-Token provided in the meta tags of your Rails application and sets it for the request header field <code>X-CSRF-Token</code>.</p>

<p>After adding this to the Backbone code, it works as expected.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="no">Started</span> <span class="no">POST</span> <span class="s2">&quot;/products&quot;</span> <span class="k">for</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">at</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">16</span> <span class="mi">10</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">29</span> <span class="o">-</span><span class="mo">0300</span>
<span class="no">Processing</span> <span class="n">by</span> <span class="no">ProductsController</span><span class="c1">#create as JSON</span>
  <span class="ss">Parameters</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;foo&quot;</span><span class="p">}}</span>
<span class="o">...</span>
<span class="no">Completed</span> <span class="mi">200</span> <span class="no">OK</span> <span class="k">in</span> <span class="mi">40</span><span class="o">.</span><span class="mi">6</span><span class="n">ms</span> <span class="p">(</span><span class="ss">Views</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">6</span><span class="n">ms</span> <span class="o">|</span> <span class="ss">ActiveRecord</span><span class="p">:</span> <span class="mi">10</span><span class="o">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>
</code></pre></div>]]></content:encoded>
      <dc:date>2015-12-15T22:55:00-05:00</dc:date>
    </item>
    <item>
      <title>How to interact with hidden elements with Protractor</title>
      <link>https://www.ombulabs.com/blog/protractor/how-to-hide-elements-for-protractor-e2e-tests.html</link>
      <description><![CDATA[The other day I was trying to interact with a hidden file input field:
&lt;div class=&quot;col-sm-3&quot;&gt;
  &lt;input class=&quot;btn btn-default&quot; class=&quot;hidden&quot; accept=&quot;.csv&quot;  id=&quot;geofence_file_input&quot;&gt;
  &lt;a class=&quot;btn btn-default&quot; id=&quot;textbox-for-geofencefile&quot;&gt;Select File&lt;/a&gt;
  &lt;span ng-if=&quot;LineItemForm.augmentations.geofence.file&quot;&gt;&lt;/span&gt;
&lt;/div&gt;

And the CSS:
.hidden {
  display: none;
}

Which caused this problem:
Failed: Wait timed out after 100015ms

Workarounds include displaying it, interacting with it, hiding it again, which I didn&#39;t like.
]]></description>
      <pubDate>Tue, 08 Dec 2015 22:55:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/protractor/how-to-hide-elements-for-protractor-e2e-tests.html</guid>
      <content:encoded><![CDATA[<p>The other day I was trying to interact with a hidden file input field:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-sm-3&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">accept</span><span class="o">=</span><span class="s">&quot;.csv&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&quot;geofence_file_input&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;textbox-for-geofencefile&quot;</span><span class="p">&gt;</span>Select File<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">ng-if</span><span class="o">=</span><span class="s">&quot;LineItemForm.augmentations.geofence.file&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<p>And the CSS:</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span></span><span class="p">.</span><span class="nc">hidden</span> <span class="p">{</span>
  <span class="k">display</span><span class="p">:</span> <span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Which caused this problem:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>Failed: Wait timed out after 100015ms
</code></pre></div>
<p>Workarounds include <em>displaying it</em>, <em>interacting with it</em>, <em>hiding it</em> again, which I didn&#39;t like.</p>

<!--more-->

<p>I changed it to be like this, more <strong>protractor-friendly</strong>:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col-sm-3&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;opacity:0;height:0px;&quot;</span> <span class="na">accept</span><span class="o">=</span><span class="s">&quot;.csv&quot;</span>  <span class="na">id</span><span class="o">=</span><span class="s">&quot;geofence_file_input&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-default&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;textbox-for-geofencefile&quot;</span> <span class="na">ng-click</span><span class="o">=</span><span class="s">&quot;selectFile(this)&quot;</span><span class="p">&gt;</span>Select File<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">span</span> <span class="na">ng-if</span><span class="o">=</span><span class="s">&quot;LineItemForm.augmentations.geofence.file&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span></code></pre></figure>

<p>Or with CSS:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><span></span><span class="p">#</span><span class="nn">geofence_file_input</span> <span class="p">{</span>
  <span class="k">opacity</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">height</span><span class="p">:</span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Now it works and the tests do too.</p>
]]></content:encoded>
      <dc:date>2015-12-08T22:55:00-05:00</dc:date>
    </item>
    <item>
      <title>Time and Material</title>
      <link>https://www.ombulabs.com/blog/software-development/time-and-material.html</link>
      <description><![CDATA[As of 2016, we will no longer work with clients on fixed bid projects. They are not a good fit for us and we are not a good fit for them.

All of our clients are startups. Fixed bids are counterproductive for startups. They give the client a false sense of security and they punish changing requirements.

Fixed bids make clients think that their project will be finished in a fixed period of time if their requirements don&#39;t change while developing the project. That is a big if!
]]></description>
      <pubDate>Wed, 18 Nov 2015 22:55:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/software-development/time-and-material.html</guid>
      <content:encoded><![CDATA[<p>As of 2016, we will no longer work with clients on fixed bid projects. They are not a good fit for us and we are not a good fit for them.</p>

<p>All of our clients are startups. Fixed bids are counterproductive for startups. They give the client a false sense of security and they punish changing requirements.</p>

<p>Fixed bids make clients think that their project will be finished in a fixed period of time if their requirements don&#39;t change while developing the project. That is a big <strong>if</strong>!</p>

<!--more-->

<h3>Problem</h3>

<p>The problem is that requirements change constantly, especially when you are working with startups. Startups usually are trying to create something new, something that has never been done before.</p>

<p>In this situation, it is <strong>normal</strong> that requirements change. As a software development team, you should welcome <strong>change</strong>. It means that you are building something that is up to date with the real world.</p>

<p>However, when you have submitted a fixed bid and started working on a project, the last thing you want is a change in the specification.</p>

<p>Because of this, you are forced to define the requirements down to the detail.</p>

<p>You need to define what web pages you will build, what interactions they will have, what background jobs the system will run, what business expectations it will fulfill, performance requirements, browser requirements and many other requirements.</p>

<p>In a startup, this will be based on a lot of wrong assumptions. When you face reality (your users or the market) the assumptions will change. Therefore, the requirements will change.</p>

<h3>Changes</h3>

<p>A change means that:</p>

<ul>
<li>You will need to throw away all the code that you wrote that was related to the changed feature</li>
<li>You will need to estimate the new effort for the changed feature</li>
<li>You will need to re-schedule the delivery date</li>
<li>You will need to get this new estimate approved by the client</li>
<li>There will be back and forth with the client</li>
</ul>

<p>For a 3 months project, this might be OK. But consider what would happen for a 12 months project. If you don&#39;t have the right process, it will be hell.</p>

<p>What&#39;s most important, the relationship with the client will suffer. That is something that you must avoid.</p>

<p>We have experienced all of these problems with fixed bid projects.</p>

<h3>Time and Material</h3>

<p>We decided to work with clients that agree to a simple <em>Time and Material</em> contract.</p>

<p>Basically, we work on projects for <em>X hours per week</em> (with a minimum of <em>20 hours per week</em>) until our clients reach their business goals. If they have new goals and we are both happy with our work, we continue working with them.</p>

<p>We will work with one or two week sprints and we can show results by the end of the first sprint. If you don&#39;t like what we are doing, you only lost a sprint.</p>

<p>I have been working with clients since 2008 and I found that the best relationships I&#39;ve had have been with this model. It&#39;s the best way to maintain a healthy relationship with our client and it&#39;s less risky for both our clients and us.</p>

<p>This model works very well for clients that want to work with an agile team in a lean project. And we love to <a href="https://www.ombulabs.com/blog/lean-startup/the-lean-startup-way.html">apply Lean Startup</a> not only to our own products but also to our clients&#39; projects.</p>

<p>We rigorously track all the time that we spend on projects. Every invoice we send includes a list of tasks and the total amount for the work we completed.</p>

<p>We have a great team of developers, designers and product managers ready to work on your project. If you are interested in working with us, <a href="https://www.ombulabs.com/#contact">get in touch!</a></p>
]]></content:encoded>
      <dc:date>2015-11-18T22:55:00-05:00</dc:date>
    </item>
    <item>
      <title>Almundo's Bill Vulnerability</title>
      <link>https://www.ombulabs.com/blog/security/almundo-bill-vulnerability.html</link>
      <description><![CDATA[The other day my friend Juan Rossi reported a vulnerability in the Almundo billing system. Since then, the vulnerability has been fixed by Superfactura, their billing software provider.

Almundo is one of the biggest travel agencies in Argentina. Their site is among the 250 most visited websites in the country.

The vulnerability allowed anyone to download billing information about their clients by creating a pretty simple HTTP GET request. No programming knowledge required.
]]></description>
      <pubDate>Mon, 24 Aug 2015 23:55:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/security/almundo-bill-vulnerability.html</guid>
      <content:encoded><![CDATA[<p>The other day my friend <a href="https://twitter.com/juanchorossi">Juan Rossi</a> reported a vulnerability in the <a href="http://almundo.com/">Almundo</a> billing system. Since then, the vulnerability has been fixed by <a href="http://superfactura.com.ar/">Superfactura</a>, their billing software provider.</p>

<p>Almundo is one of the <a href="http://www.alexa.com/siteinfo/almundo.com.ar">biggest travel agencies in Argentina</a>. Their site is among the 250 most visited websites in the country.</p>

<p>The vulnerability allowed anyone to download billing information about their clients by creating a pretty simple <code>HTTP GET</code> request. No programming knowledge required.</p>

<!--more-->

<p>Basically, if you had bought anything from Almundo, you would have received an email with a link to your bill. Something like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>http://asatej.superfactura.com.ar/un_comprobante_pdf.php?s=1&amp;f=73455&amp;tc=F13&amp;tf=B
</code></pre></div>
<p>At plain sight, you can see the type of bill (<em>Factura B</em>) and the number of bill (<em>Factura #73455</em>)</p>

<p>By entering this URL, you could see sensitive information about the client and what they had bought:</p>

<ul>
<li>Client&#39;s full name</li>
<li>Client&#39;s CUIL (Tax identification number in Argentina)</li>
<li>Client&#39;s address</li>
<li>What they bought. For example: <strong>EZEPUJEZE</strong> for a flight ticket from <strong>Ezeiza</strong> (Buenos Aires, Argentina) to <strong>Punta Cana</strong> (México)</li>
<li>How much they paid</li>
</ul>

<p>Here is a sample of one of the <strong>public bills</strong> that should have been <strong>private</strong>:</p>

<p><img src="/blog/assets/images/factura-example.jpg" alt="One of the non-private bills" class="medium-img"></p>

<p>Fortunately, you couldn&#39;t see when this trip was happening.</p>

<p>During the many days that this vulnerability was on production, someone with some programming knowledge could have created a script that iterated from 1 to 100,000 (for the bill number) and from A to C (for the bill type) sending GET requests and downloading all the billing information from Almundo.</p>

<p>Considering that <a href="http://superfactura.com.ar/">Superfactura</a> has a few clients, we can only assume that this vulnerability was also in production for all of their clients.</p>

<p>At the time of this publication, the company had not released any information about this vulnerability nor if any sensitive data was downloaded by unauthorized users.</p>
]]></content:encoded>
      <dc:date>2015-08-24T23:55:00-04:00</dc:date>
    </item>
    <item>
      <title>The 7 Days Open Source Challenge</title>
      <link>https://www.ombulabs.com/blog/open-source/the-7-days-open-source-challenge.html</link>
      <description><![CDATA[Last Wednesday I gave a lightning talk about open source at the Buenos Aires Ruby Meetup. I proposed a challenge to all attendees: Contribute to one (or many) open source projects for 7 days straight.

The rules are simple:


You have to do it for 7 days straight
If you can&#39;t do it one day, that breaks your streak
When you break your streak, you have to start over from day 1

]]></description>
      <pubDate>Mon, 03 Aug 2015 23:55:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/open-source/the-7-days-open-source-challenge.html</guid>
      <content:encoded><![CDATA[<p>Last Wednesday I gave a lightning talk about open source at the <a href="http://www.meetup.com/rubyba/events/223814545/">Buenos Aires Ruby Meetup</a>. I proposed a challenge to all attendees: Contribute to one (or many) open source projects for 7 days straight.</p>

<p>The rules are simple:</p>

<ul>
<li>You have to do it for 7 days straight</li>
<li>If you can&#39;t do it one day, that breaks your streak</li>
<li>When you break your streak, you have to start over from day 1</li>
</ul>

<!--more-->

<p>The goal of this challenge is to <strong>make contributing to open source projects a habit</strong>.</p>

<p>You can see the slides over here:</p>

<p><iframe src="//www.slideshare.net/slideshow/embed_code/key/dNhZJXClUW05B" width="510" height="420" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/ombulabs/the-7-days-open-source-challenge" title="The 7 Days Open Source Challenge" target="_blank">The 7 Days Open Source Challenge</a> </strong> from <strong><a href="//www.slideshare.net/ombulabs" target="_blank">Ombu Labs, The Lean Software Boutique</a></strong> </div></p>

<p>I did this challenge because I wanted to get back to contributing to a couple of projects that I currently maintain. It was great and I finally made some progress in <a href="https://github.com/DatabaseCleaner/database_cleaner/">DatabaseCleaner</a></p>

<p>I hope that this challenge will encourage other developers to start contributing to their favorite projects.</p>

<p>Here are a couple of ways that you can contribute to open source:</p>

<ul>
<li>Submit a new issue to a library. Make sure that it hasn&#39;t been reported yet. If it has, add meaningful information to the issue to make it easier to solve it</li>
<li>Try to solve an existing issue. Find the lines of code that are causing the problem and submit a pull request</li>
<li>If you can&#39;t solve it, write a failing scenario in the library&#39;s test suite</li>
<li>Improve documentation where it&#39;s unclear or non-existent</li>
</ul>

<p>If you don&#39;t know where to begin, check out <a href="http://www.codetriage.com/">http://www.codetriage.com</a> or ping me (I&#39;m one of the maintainers of <a href="https://github.com/DatabaseCleaner/database_cleaner/">DatabaseCleaner</a> and <a href="https://github.com/bmabey/email-spec">EmailSpec</a> and I&#39;d appreciate your help)</p>
]]></content:encoded>
      <dc:date>2015-08-03T23:55:00-04:00</dc:date>
    </item>
    <item>
      <title>Slack notifications with Slack-Notify gem</title>
      <link>https://www.ombulabs.com/blog/ruby/slack-notifications-with-slack-notify.html</link>
      <description><![CDATA[We have been using Slack at OmbuLabs for a while now
after switching from HipChat, and haven&#39;t looked back. It looks and feels much
better than any other available platform of its kind. Slack provides
WebHooks, which you can use to post
messages to your team&#39;s channels.
]]></description>
      <pubDate>Wed, 29 Jul 2015 13:40:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/ruby/slack-notifications-with-slack-notify.html</guid>
      <content:encoded><![CDATA[<p>We have been using Slack at <a href="https://www.ombulabs.com">OmbuLabs</a> for a while now
after switching from HipChat, and haven&#39;t looked back. It looks and feels much
better than any other available platform of its kind. Slack provides
<a href="https://api.slack.com/incoming-webhooks">WebHooks</a>, which you can use to post
messages to your team&#39;s channels.</p>

<!--more-->

<p>We use <a href="https://www.solanolabs.com">Solano CI</a> (formerly Tddium) for our
automated builds. By default, the system sends e-mails whenever a build passes
or fails, but we wanted to be notified in our Slack channels. Enter the
<a href="https://github.com/sosedoff/slack-notify">slack-notify</a> gem, which makes
Slack notifications super simple in Ruby.</p>

<p>To get started, first
<a href="https://my.slack.com/services/new/incoming-webhook">set up an incoming webhook</a>.</p>

<p>Once that&#39;s done, you can create the Rake task which Solano can run when
the build has finished running:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span>  <span class="k">def</span> <span class="nf">current_branch</span>
    <span class="sb">`git symbolic-ref HEAD 2&gt;/dev/null | cut -d&quot;/&quot; -f 3-`</span><span class="o">.</span><span class="n">strip</span>
  <span class="k">end</span>

  <span class="n">task</span> <span class="ss">:post_build_hook</span> <span class="k">do</span>
    <span class="nb">require</span> <span class="s1">&#39;slack-notify&#39;</span>

    <span class="n">webhook_url</span> <span class="o">=</span> <span class="s2">&quot;https://hooks.slack.com/services/your-hook&quot;</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TDDIUM_API_SERVER&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">session_id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TDDIUM_SESSION_ID&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">build_status</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TDDIUM_BUILD_STATUS&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">client</span> <span class="o">=</span> <span class="no">SlackNotify</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">channel</span><span class="p">:</span> <span class="s2">&quot;#your-channel&quot;</span><span class="p">,</span>
                                     <span class="ss">webhook_url</span><span class="p">:</span> <span class="n">webhook_url</span><span class="p">,</span>
                                     <span class="ss">username</span><span class="p">:</span> <span class="s2">&quot;Solano CI&quot;</span><span class="p">,</span>
                                     <span class="ss">icon_emoji</span><span class="p">:</span> <span class="s2">&quot;:shipit:&quot;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;_</span><span class="si">#{</span><span class="n">current_branch</span><span class="si">}</span><span class="s2">_ *</span><span class="si">#{</span><span class="n">build_status</span><span class="si">}</span><span class="s2">*! &quot;</span>
    <span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Check build details at: &quot;</span>
    <span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;http://</span><span class="si">#{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/1/reports/</span><span class="si">#{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">client</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
  <span class="k">end</span>
</code></pre></div>
<p>This will let #your-channel know the branch for which the build ran, whether it passed,
failed or errored, and a link to the build report.</p>

<p>You also need to explicitly call it after the build is finished in your
<code>solano.yml</code> or <code>tddium.yml</code> file:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span></span><span class="l l-Scalar l-Scalar-Plain">:tddium</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">:hooks</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">:post_build</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">RAILS_ENV=test bundle exec rake tddium:post_build_hook</span>
</code></pre></div>
<p>We have also set up deployment notifications, so whenever someone deploys to
production, the Slack channel is notified:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">namespace</span> <span class="ss">:notify</span> <span class="k">do</span>
  <span class="n">task</span> <span class="ss">:start</span><span class="p">,</span> <span class="ss">roles</span><span class="p">:</span> <span class="o">[</span><span class="ss">:app</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">USERNAME</span><span class="si">}</span><span class="s2"> started deploying </span><span class="si">#{</span><span class="no">REPO</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="no">GIT_TAG</span><span class="si">}</span><span class="s2">) to production&quot;</span>
    <span class="n">notify_slack</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">task</span> <span class="ss">:done</span><span class="p">,</span> <span class="ss">roles</span><span class="p">:</span> <span class="o">[</span><span class="ss">:app</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">USERNAME</span><span class="si">}</span><span class="s2"> just deployed </span><span class="si">#{</span><span class="no">REPO</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="no">GIT_TAG</span><span class="si">}</span><span class="s2">) to production&quot;</span>
    <span class="n">notify_slack</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">before</span> <span class="s2">&quot;deploy&quot;</span><span class="p">,</span> <span class="s2">&quot;notify:start&quot;</span>
<span class="n">after</span> <span class="s2">&quot;deploy&quot;</span><span class="p">,</span> <span class="s2">&quot;notify:done&quot;</span>
</code></pre></div>
<p>There are many different use cases, just make sure not to spam your team with
too many notifications. At some point, you may want to set up a
channel dedicated solely to notifications if you are part of a bigger team.</p>
]]></content:encoded>
      <dc:date>2015-07-29T13:40:00-04:00</dc:date>
    </item>
    <item>
      <title>Why using default_scope is a bad idea</title>
      <link>https://www.ombulabs.com/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html</link>
      <description><![CDATA[default_scope is a method provided by ActiveRecord, which allows you to set
a default scope (as its name implies) for all operations done on a given model.
It can be useful for allowing soft-deletion in your models, by having a
deleted_on column on your model and setting the default scope to
deleted_on: nil
]]></description>
      <pubDate>Mon, 20 Jul 2015 05:55:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html</guid>
      <content:encoded><![CDATA[<p><code>default_scope</code> is a method provided by ActiveRecord, which allows you to set
a default scope (as its name implies) for all operations done on a given model.
It can be useful for allowing soft-deletion in your models, by having a
<code>deleted_on</code> column on your model and setting the default scope to
<code>deleted_on: nil</code></p>

<!--more-->
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Animal</span>
  <span class="n">default_scope</span> <span class="n">where</span><span class="p">(</span><span class="ss">deleted_on</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>This will hide deleted records and only return non-deleted
ones in your queries after setting <code>deleted_on</code> instead of
calling <code>destroy</code>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">&gt;</span> <span class="no">Animal</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="no">Animal</span> <span class="no">Load</span> <span class="p">(</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span><span class="n">ms</span><span class="p">)</span>  <span class="no">SELECT</span> <span class="sb">`animals`</span><span class="o">.</span><span class="n n-Operator">*</span> <span class="no">FROM</span> <span class="sb">`animals`</span> <span class="no">WHERE</span> <span class="sb">`animals`</span><span class="o">.</span><span class="n n-Operator">`</span><span class="n">deleted_on</span><span class="sb">` IS NULL LIMIT 5</span>
</code></pre></div>
<p>Quite useful! However, <code>default_scope</code> has a dangerous behavior:
<strong>it affects your model&#39;s initialization.</strong></p>

<p>Say you were using STI on your <code>Animal</code> model, and you had a <code>default_scope</code>
for always filtering your model by &quot;Cat&quot;:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">Animal</span>
  <span class="n">default_scope</span> <span class="n">where</span><span class="p">(</span><span class="ss">type</span><span class="p">:</span> <span class="s2">&quot;Cat&quot;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>When you initialize a new Animal, it will always use the value defined in
your default scope:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">&gt;</span> <span class="no">Animal</span><span class="o">.</span><span class="n">new</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Animal id: nil, created_at: nil, updated_at: nil, type: &quot;Cat&quot;&gt;</span>
</code></pre></div>
<p>This can lead to some headaches when you&#39;re not aware of this side-effect, and
depending on the default scoped attribute/value it can cause some pretty bad
bugs.</p>

<p>Also, I&#39;d like to mention the fact that it&#39;s very difficult to write queries
once you have used <code>default_scope</code> on a model. For example:
<code>Animal.where(&#39;deleted_on is not null&#39;)</code> won&#39;t work, you&#39;d need to use
<code>Animal.unscoped</code>, which makes everything awkward. You also need to use
<code>unscoped</code> carefully, because it will remove all scopes of the relation, not just
the default scope.</p>

<p>I recommend that you always avoid default scope if possible. Prefer explicit
scopes instead. If you really need to use it, use it with care.</p>
]]></content:encoded>
      <dc:date>2015-07-20T05:55:00-04:00</dc:date>
    </item>
    <item>
      <title>Mercado Pago Security Hole</title>
      <link>https://www.ombulabs.com/blog/security/mercado-pago-security-vulnerability.html</link>
      <description><![CDATA[On April 17th we discovered a security vulnerability in the Mercado Pago API. Before disclosing this information, we contacted Mercado Libre and sent them a detailed report of the security hole and how to reproduce it.

The vulnerability allowed anyone to get an access token without using the right secret for an account.
]]></description>
      <pubDate>Tue, 14 Jul 2015 19:29:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/security/mercado-pago-security-vulnerability.html</guid>
      <content:encoded><![CDATA[<p>On April 17th we discovered a security vulnerability in the <a href="https://www.mercadopago.com.ar/developers/en/api-docs/">Mercado Pago API</a>. Before disclosing this information, we contacted <a href="http://www.mercadolibre.com/">Mercado Libre</a> and sent them a detailed report of the security hole and how to reproduce it.</p>

<p>The vulnerability allowed anyone to get an access token without using the right secret for an account.</p>

<!--more-->

<p>You can see how the authentication process works on Mercado Pago over here: <a href="https://www.mercadopago.com.ar/developers/en/api-docs/basics/authentication/">https://www.mercadopago.com.ar/developers/en/api-docs/basics/authentication/</a></p>

<p>After 7 hours, Mercado Pago fixed the vulnerability in their production environment.</p>

<h2>How we reproduced the bug</h2>

<p>This example uses Ruby 2.1.2 and the <a href="https://rubygems.org/gems/mercadopago">mercadopago</a> gem.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>2.1.2 :001 &gt; token = MercadoPago::Authentication.access_token(&quot;8872&quot;, &quot;lalalala&quot;)
</code></pre></div>
<p>The first parameter is the client id (an account in Mercado Pago) and the second parameter is the secret (only the account holder should know this)</p>

<p>For client id we used <code>8872</code> which doesn&#39;t belong to us and for secret we used <code>lalalala</code> to show that it wasn&#39;t really <em>the right secret.</em></p>

<p>With that information, we were able to acquire the token. With it you can access a lot of information associated with the payments in the account.</p>

<p>For example:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">002</span> <span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="no">MercadoPago</span><span class="o">::</span><span class="no">Collection</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">token</span><span class="o">[</span><span class="s2">&quot;access_token&quot;</span><span class="o">]</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="ss">:approved</span><span class="p">)</span>
</code></pre></div>
<p>With this query, you could see all the approved transactions for an account <strong>that didn&#39;t belong to you</strong>.</p>

<p>For example:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">=&gt;</span> <span class="p">{</span><span class="s2">&quot;paging&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="o">=&gt;</span><span class="mi">98</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="o">=&gt;</span><span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">},</span>
    <span class="s2">&quot;results&quot;</span><span class="o">=&gt;[</span>
      <span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="mi">753859418</span><span class="p">,</span> <span class="s2">&quot;site_id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;MLA&quot;</span><span class="p">,</span>
       <span class="s2">&quot;date_created&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2014-03-13T16:58:20.000-04:00&quot;</span><span class="p">,</span>
       <span class="s2">&quot;date_approved&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2014-03-13T17:00:38.000-04:00&quot;</span><span class="p">,</span>
       <span class="s2">&quot;last_modified&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2014-03-13T17:00:38.000-04:00&quot;</span><span class="p">,</span>
       <span class="s2">&quot;money_release_date&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2014-03-15T17:00:38.000-04:00&quot;</span><span class="p">,</span>
       <span class="s2">&quot;operation_type&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;regular_payment&quot;</span><span class="p">,</span>
       <span class="s2">&quot;collector_id&quot;</span><span class="o">=&gt;</span><span class="mi">16605960</span><span class="p">,</span> <span class="s2">&quot;sponsor_id&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
       <span class="s2">&quot;payer&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
         <span class="s2">&quot;nickname&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;XOMBULABSX&quot;</span><span class="p">,</span>
         <span class="s2">&quot;first_name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;JON&quot;</span><span class="p">,</span>
         <span class="s2">&quot;last_name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;SNOW&quot;</span><span class="p">,</span>
         <span class="s2">&quot;phone&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;area_code&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;291&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;123412&quot;</span><span class="p">,</span> <span class="s2">&quot;extension&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">},</span>
         <span class="s2">&quot;email&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;security@ombulabs.com&quot;</span><span class="p">,</span>
         <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="mi">83110350</span><span class="p">,</span>
         <span class="s2">&quot;identification&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">}},</span>
         <span class="s2">&quot;external_reference&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;1448&quot;</span><span class="p">,</span>
         <span class="s2">&quot;merchant_order_id&quot;</span><span class="o">=&gt;</span><span class="mi">11567450</span><span class="p">,</span>
         <span class="s2">&quot;reason&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;Premium package&quot;</span><span class="p">,</span> <span class="s2">&quot;currency_id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;ARS&quot;</span><span class="p">,</span>
         <span class="s2">&quot;transaction_amount&quot;</span><span class="o">=&gt;</span><span class="mi">81</span><span class="p">,</span> <span class="s2">&quot;total_paid_amount&quot;</span><span class="o">=&gt;</span><span class="mi">81</span><span class="p">,</span>
         <span class="s2">&quot;shipping_cost&quot;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span>
         <span class="s2">&quot;account_money_amount&quot;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span>
         <span class="s2">&quot;mercadopago_fee&quot;</span><span class="o">=&gt;</span><span class="mi">4</span><span class="o">.</span><span class="mi">85</span><span class="p">,</span>
         <span class="s2">&quot;net_received_amount&quot;</span><span class="o">=&gt;</span><span class="mi">76</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span>
         <span class="s2">&quot;marketplace_fee&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
         <span class="s2">&quot;coupon_id&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
         <span class="s2">&quot;coupon_amount&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
         <span class="s2">&quot;coupon_fee&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
         <span class="s2">&quot;finance_fee&quot;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span>
         <span class="s2">&quot;status&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;approved&quot;</span><span class="p">,</span>
         <span class="s2">&quot;status_detail&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;accredited&quot;</span><span class="p">,</span>
         <span class="s2">&quot;status_code&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;00&quot;</span><span class="p">,</span>
         <span class="s2">&quot;released&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span>
         <span class="s2">&quot;payment_type&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;credit_card&quot;</span><span class="p">,</span>
         <span class="s2">&quot;installments&quot;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span>
         <span class="s2">&quot;installment_amount&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
         <span class="s2">&quot;deferred_period&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
         <span class="s2">&quot;cardholder&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;JON SNOW&quot;</span><span class="p">,</span> <span class="s2">&quot;identification&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;DNI&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;26000000&quot;</span><span class="p">}},</span>
         <span class="s2">&quot;statement_descriptor&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;WWW.MERCADOPAGO.COM&quot;</span><span class="p">,</span>
         <span class="s2">&quot;transaction_order_id&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;marketplace&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;NONE&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="o">=&gt;[]</span><span class="p">,</span>
         <span class="s2">&quot;notification_url&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">}},</span>
      <span class="p">{</span><span class="s2">&quot;collection&quot;</span><span class="o">=&gt;</span>
        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="mi">756415807</span><span class="p">,</span>
        <span class="s2">&quot;site_id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;MLA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date_created&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2014-03-20T15:42:35.000-04:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date_approved&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2014-03-20T15:42:35.000-04:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;last_modified&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2014-03-20T15:42:35.000-04:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;money_release_date&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;2014-03-22T15:42:35.000-04:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;operation_type&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;regular_payment&quot;</span><span class="p">,</span>
        <span class="s2">&quot;collector_id&quot;</span><span class="o">=&gt;</span><span class="mi">16605960</span><span class="p">,</span>
        <span class="s2">&quot;sponsor_id&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
        <span class="s2">&quot;payer&quot;</span><span class="o">=&gt;</span><span class="p">{</span>
          <span class="s2">&quot;nickname&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;YOURNICKNAME&quot;</span><span class="p">,</span>
          <span class="s2">&quot;first_name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;Matias&quot;</span><span class="p">,</span>
          <span class="s2">&quot;last_name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;OMBU&quot;</span><span class="p">,</span>
          <span class="s2">&quot;phone&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;area_code&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;291&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;4000000&quot;</span><span class="p">,</span> <span class="s2">&quot;extension&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">},</span>
          <span class="s2">&quot;email&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;hola@ombulabs.com&quot;</span><span class="p">,</span>
          <span class="s2">&quot;id&quot;</span><span class="o">=&gt;</span><span class="mi">18878708</span><span class="p">,</span>
          <span class="s2">&quot;identification&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">}},</span>
        <span class="s2">&quot;external_reference&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;1457&quot;</span><span class="p">,</span>
        <span class="s2">&quot;merchant_order_id&quot;</span><span class="o">=&gt;</span><span class="mi">13031193</span><span class="p">,</span>
        <span class="s2">&quot;reason&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;Premium package&quot;</span><span class="p">,</span>
        <span class="s2">&quot;currency_id&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;ARS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;transaction_amount&quot;</span><span class="o">=&gt;</span><span class="mi">81</span><span class="p">,</span>
        <span class="s2">&quot;total_paid_amount&quot;</span><span class="o">=&gt;</span><span class="mi">81</span><span class="p">,</span>
        <span class="s2">&quot;shipping_cost&quot;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;account_money_amount&quot;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;mercadopago_fee&quot;</span><span class="o">=&gt;</span><span class="mi">4</span><span class="o">.</span><span class="mi">85</span><span class="p">,</span>
        <span class="s2">&quot;net_received_amount&quot;</span><span class="o">=&gt;</span><span class="mi">76</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span>
        <span class="s2">&quot;marketplace_fee&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
        <span class="s2">&quot;coupon_id&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
        <span class="s2">&quot;coupon_amount&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
        <span class="s2">&quot;coupon_fee&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;finance_fee&quot;</span><span class="o">=&gt;</span><span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;status&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;approved&quot;</span><span class="p">,</span>
        <span class="s2">&quot;status_detail&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;accredited&quot;</span><span class="p">,</span>
        <span class="s2">&quot;status_code&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;released&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;payment_type&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;credit_card&quot;</span><span class="p">,</span>
        <span class="s2">&quot;installments&quot;</span><span class="o">=&gt;</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;installment_amount&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
        <span class="s2">&quot;deferred_period&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
        <span class="s2">&quot;cardholder&quot;</span><span class="o">=&gt;</span>
          <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
           <span class="s2">&quot;identification&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">}},</span>
        <span class="s2">&quot;statement_descriptor&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;WWW.MERCADOPAGO.COM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;transaction_order_id&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">,</span>
        <span class="s2">&quot;marketplace&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;NONE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tags&quot;</span><span class="o">=&gt;[]</span><span class="p">,</span>
        <span class="s2">&quot;notification_url&quot;</span><span class="o">=&gt;</span><span class="kp">nil</span><span class="p">}},</span>
        <span class="o">...</span>
      <span class="p">}</span>
</code></pre></div>
<p><em>The sensitive information in this code snippet has been intentionally changed</em></p>

<p>So, during the time that this vulnerability was live (at least 7 hours) an attacker could have used it to:</p>

<ul>
<li><p>Find information about all the payments that your account had received since you started using the service</p></li>
<li><p>Find information about your clients, their DNI, name, phone number</p></li>
</ul>

<p>All the attacker needed to exploit this vulnerability was a Mercado Pago account ID and some basic tech knowledge.</p>

<h2>How we discovered this bug</h2>

<p>At <a href="http://www.ombushop.com">OmbuShop</a>, our integration tests use the Mercado Pago sandbox to check that the amount that a client has to pay is correct. I know that this isn&#39;t ideal (or is it?) but it&#39;s as real as it gets for our integration tests.</p>

<p>One of our tests checked that you couldn&#39;t get collections information with the wrong user credentials. When the test started failing in our continuous tests, we started digging around and found this security hole.</p>

<h2>What worries me</h2>

<p>It&#39;s hard to understand how such a big payment processor never published information about this security hole. I would expect them to know if some information was accessed by people who didn&#39;t have access to it.</p>

<p>They could check their access logs and see who accessed their API using a secret that wasn&#39;t the right one. Then they could inform their customers of this problem and warn them about this situation.</p>

<p>Mercado Pago, a product of Mercado Libre (<a href="http://www.nasdaq.com/symbol/meli">$MELI</a>) which is a publicly traded company, doesn&#39;t even have public versioning information of their API nor a continuous integration suite that would catch such an obvious vulnerability.</p>

<p>Maybe I am just used to the security reports published by Github about <a href="https://github.com/blog/1068-public-key-security-vulnerability-and-mitigation">their vulnerabilities</a>. Maybe Github is way more serious than Mercado Pago about privacy and online security.</p>

<p>I think that Mercado Pago needs to step up their game and be more transparent about their platform and user privacy.</p>

<p>A good place to start would be a better way to receive security vulnerability reports and disclosing information about their security problems.</p>

<p>Until today, they haven&#39;t disclosed any information about this security hole and it&#39;s very hard to find a way to report a security issue to them.</p>
]]></content:encoded>
      <dc:date>2015-07-14T19:29:00-04:00</dc:date>
    </item>
    <item>
      <title>The Lean Startup Way</title>
      <link>https://www.ombulabs.com/blog/lean-startup/the-lean-startup-way.html</link>
      <description><![CDATA[At OmbuLabs we like to split our time working on our own products, client projects, and open source code. We have embraced the Lean Startup methodology not only for our own products but also for our client projects.

It is easier to apply the methodology to our own products than to our client projects. With our products, we decide what goals we want to reach and what experiments we are going to run to validate our hypotheses.
]]></description>
      <pubDate>Tue, 30 Jun 2015 19:29:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/lean-startup/the-lean-startup-way.html</guid>
      <content:encoded><![CDATA[<p>At <a href="https://www.ombulabs.com">OmbuLabs</a> we like to split our time working on our own products, client projects, and open source code. We have embraced the Lean Startup methodology not only for our own products but also for our client projects.</p>

<p>It is easier to apply the methodology to our own products than to our client projects. With our products, we decide what goals we want to reach and what experiments we are going to run to validate our hypotheses.</p>

<!--more-->

<p>And we have ran many experiments to create and maintain these products:</p>

<ul>
<li><a href="http://www.ombushop.com/">OmbuShop</a>: The best way to setup your online shop in Latin America. A SaaS product that enables businesses to easily setup their online shop.</li>
<li><a href="http://www.tutiendaonline.com.ar/">TuTiendaOnline</a>: A directory of shops in Argentina.</li>
<li><a href="http://bolognesa.herokuapp.com/">Bolognesa</a>: A <a href="http://pomodorotechnique.com/">Pomodoro</a> tracker.</li>
</ul>

<p>With client projects, we first need to explain what the <a href="http://theleanstartup.com/">Lean Startup</a> methodology is. The best clients we have had already had an understanding of the methodology.</p>

<p>Once they understand it, we can work with them and define their minimum viable product scope. This minimal project will usually take between one and two months. This time requirement is very important, because it will help us to narrow the scope.</p>

<p>The idea is to test their core hypotheses with their target market.</p>

<p>Once we have designed, implemented, tested and deployed their <a href="http://leanstack.com/minimum-viable-product/">MVP</a>, it&#39;s time to start gathering data about the target market. This is how the build, measure, learn cycle begins.</p>

<p>Every time we deploy a product, we need to make sure that we are tracking the right numbers. For basic projects we prefer <a href="http://www.google.com/analytics/">Google Analytics</a>, for more complex projects we prefer <a href="https://mixpanel.com/">Mixpanel</a>.</p>

<p>If it is an e-commerce application, we need to make sure to track the conversions from day 1. If it is a SaaS application, we need to track the funnels from day 1.</p>

<p>This data will allow us to continue improving the product.</p>

<p>Every time we finish an iteration, we should measure the key indicators and make sure that we have improved the product. If we see the numbers drop, we should rollback to the previous state of the application.</p>

<p>We won&#39;t suggest that you A/B test everything from day 1, but some changes will be A/B tested to confirm that the change actually improves the key metric we are trying to improve.</p>

<p>We truly believe that the Lean Startup way is the best for both our clients and us. We want to build successful products for them, so that we can continue working with them over a long period of time. It&#39;s a <strong>win/win</strong> situation.</p>
]]></content:encoded>
      <dc:date>2015-06-30T19:29:00-04:00</dc:date>
    </item>
    <item>
      <title>How to Git push with blocked ports</title>
      <link>https://www.ombulabs.com/blog/git/github/how-to-git-push-with-blocked-ports.html</link>
      <description><![CDATA[Often times I find myself working out of a coffee shop with a terrible Internet connection. We have a nice office at OmbuLabs but there is still that Je ne sais quoi at coffee shops.

The cool thing about Git is that you can git commit all your changes while enjoying a cup of coffee and git push later (when you&#39;re back at home with a decent connection)

But what if you want to git push from the coffee shop? Sometimes the only ports that are open are port 80 (HTTP) and 443 (HTTPS).
]]></description>
      <pubDate>Sun, 28 Jun 2015 14:29:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/git/github/how-to-git-push-with-blocked-ports.html</guid>
      <content:encoded><![CDATA[<p>Often times I find myself working out of a coffee shop with a <strong>terrible Internet connection</strong>. We have a nice office at <a href="https://es.foursquare.com/v/ombushop-hq/52f0e47311d25da04d101b62">OmbuLabs</a> but there is still that <em>Je ne sais quoi</em> at coffee shops.</p>

<p>The cool thing about <a href="https://git-scm.com/">Git</a> is that you can <code>git commit</code> all your changes while enjoying a cup of coffee and <code>git push</code> later (when you&#39;re back at home with a decent connection)</p>

<p>But what if you want to <code>git push</code> from the coffee shop? Sometimes the only ports that are open are port 80 (HTTP) and 443 (HTTPS).</p>

<!--more-->

<p>If your Git remote repository supports HTTPS, you can easily push to it by following these steps:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>git remote add origin-https https://github.com/DatabaseCleaner/database_cleaner.git
git push origin-https master
</code></pre></div>
<p>A Git repository can have as many remote repositories as you want, so I like to keep <code>origin</code> and <code>origin-https</code> to <code>git push</code> whenever I want.</p>

<p>You will have to enter your username and password to authenticate with Github.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$ git push origin-https master
Username for &#39;https://github.com&#39;: etagwerker
Password for &#39;https://etagwerker@github.com&#39;:
Everything up-to-date
</code></pre></div>
<p>Now you can <code>git push</code> even on shitty Internet connections.</p>
]]></content:encoded>
      <dc:date>2015-06-28T14:29:00-04:00</dc:date>
    </item>
    <item>
      <title>Our Definition of "Done"</title>
      <link>https://www.ombulabs.com/blog/software-development/software-quality/our-definition-of-done.html</link>
      <description><![CDATA[Quality should be present in everything you do, but it should be balanced with the time you spend working on a feature. Does it feel like you&#39;ve been working on this feature for a really long time? Maybe you have. Is it &quot;done&quot;?

That is a tough question, so I&#39;ll write down our definition of done.
]]></description>
      <pubDate>Thu, 18 Jun 2015 07:37:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/software-development/software-quality/our-definition-of-done.html</guid>
      <content:encoded><![CDATA[<p>Quality should be present in everything you do, but it should be balanced with the time you spend working on a feature. Does it feel like you&#39;ve been working on this feature for a <strong>really long time</strong>? Maybe you have. Is it &quot;done&quot;?</p>

<p>That is a tough question, so I&#39;ll write down <em>our definition of done</em>.</p>

<!--more-->

<h2>When is a feature done?</h2>

<ul>
<li>The feature does what it is expected to do</li>
<li>If it has a user interface, the <a href="http://www.helloerik.com/ux-is-not-ui">UX</a> is simple and good enough: A <em>human</em> can use it!</li>
<li>If it is code for other programmers, the <a href="http://c2.com/cgi/wiki?InterfaceSegregationPrinciple">public contract</a> is clear: A programmer read the documentation and use it</li>
<li>It has a <a href="http://c2.com/cgi/wiki?CodeCoverage">decent spec</a>, which covers at least two scenarios (not just the happy path)</li>
<li>It is fast!</li>
<li>The build passes (it doesn&#39;t break any of the existing specs)</li>
<li>The code is easy to maintain (<a href="http://c2.com/cgi/wiki?DontRepeatYourself">DRY</a>&#39;ed)</li>
</ul>

<p>Have you spent 2 days in a feature that should&#39;ve been done in 2 hours? Have you spent 2 hours on a bug fix that should&#39;ve taken you 8 hours? If so, why?</p>

<p>If the feature is big, break it into smaller features. This will make it easier to move ahead.</p>

<p>Before you submit your <a href="https://help.github.com/articles/using-pull-requests">pull request</a>, make sure that you have considered this list.</p>
]]></content:encoded>
      <dc:date>2015-06-18T07:37:00-04:00</dc:date>
    </item>
    <item>
      <title>Enumerable#grep vs Enumerable#select</title>
      <link>https://www.ombulabs.com/blog/ruby/benchmark/enumerator-grep-vs-enumerator-select.html</link>
      <description><![CDATA[Often, Enumerable#select is the chosen method to obtain elements from an
Array for a given block. Without thinking twice, we may be doing more work than
necessary by not taking advantage of another method from the Enumerable module,
Enumerable#grep.
]]></description>
      <pubDate>Thu, 09 Apr 2015 07:37:00 -0400</pubDate>
      <guid>https://www.ombulabs.com/blog/ruby/benchmark/enumerator-grep-vs-enumerator-select.html</guid>
      <content:encoded><![CDATA[<p>Often, <code>Enumerable#select</code> is the chosen method to obtain elements from an
Array for a given block. Without thinking twice, we may be doing more work than
necessary by not taking advantage of another method from the Enumerable module,
<code>Enumerable#grep</code>.</p>

<!--more-->

<p><code>Enumerable#grep</code> can not always be used instead of <code>Enumerable#select</code>, but
when it can, <code>#grep</code> provides better readability and a small speed improvement
over <code>#select</code>.</p>

<p>See the benchmark below for example, which uses the class matcher for <code>#grep</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">041</span> <span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100000</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span> <span class="p">}</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">042</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100000</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span> <span class="p">}</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">043</span> <span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">044</span> <span class="o">&gt;</span> <span class="no">Benchmark</span><span class="o">.</span><span class="n">bm</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">045</span> <span class="o">&gt;</span>   <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">)</span>    <span class="p">{</span> <span class="n">c</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">.</span><span class="n">is_a?</span> <span class="nb">Integer</span> <span class="p">}</span> <span class="p">}</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">046</span><span class="o">?&gt;</span>   <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;grep&quot;</span><span class="p">)</span>      <span class="p">{</span> <span class="n">c</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="nb">Integer</span><span class="p">)</span> <span class="p">}</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">047</span><span class="o">?&gt;</span> <span class="k">end</span>
                 <span class="n">user</span>     <span class="nb">system</span>      <span class="n">total</span>        <span class="n">real</span>
<span class="nb">select</span>       <span class="mi">0</span><span class="o">.</span><span class="mo">040000</span>   <span class="mi">0</span><span class="o">.</span><span class="mo">000000</span>   <span class="mi">0</span><span class="o">.</span><span class="mo">040000</span> <span class="p">(</span>  <span class="mi">0</span><span class="o">.</span><span class="mo">0377</span><span class="mi">99</span><span class="p">)</span>
<span class="n">grep</span>         <span class="mi">0</span><span class="o">.</span><span class="mo">020000</span>   <span class="mi">0</span><span class="o">.</span><span class="mo">000000</span>   <span class="mi">0</span><span class="o">.</span><span class="mo">020000</span> <span class="p">(</span>  <span class="mi">0</span><span class="o">.</span><span class="mo">02374</span><span class="mi">9</span><span class="p">)</span>

<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">04</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">c</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">.</span><span class="n">is_a?</span> <span class="nb">Integer</span> <span class="p">}</span> <span class="o">==</span> <span class="n">c</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="nb">Integer</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre></div>
<p>You can also see its power when using Regexp patterns, which is not only faster
but also less verbose, which is enough of a win to favor it over <code>#select</code>:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">04</span><span class="mi">9</span> <span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100000</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="p">(</span><span class="mi">65</span> <span class="o">+</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">26</span><span class="p">))</span><span class="o">.</span><span class="n">chr</span> <span class="p">}</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">050</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100000</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span> <span class="p">}</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">051</span> <span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">052</span> <span class="o">&gt;</span> <span class="no">Benchmark</span><span class="o">.</span><span class="n">bm</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">053</span> <span class="o">&gt;</span>   <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">)</span>    <span class="p">{</span> <span class="n">c</span><span class="o">.</span><span class="n">select</span><span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="sr">/^\d*$/</span> <span class="o">===</span> <span class="n">x</span><span class="p">}</span> <span class="p">}</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">054</span><span class="o">?&gt;</span>   <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;grep&quot;</span><span class="p">)</span>      <span class="p">{</span> <span class="n">c</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/^\d*$/</span><span class="p">)</span> <span class="p">}</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">055</span><span class="o">?&gt;</span> <span class="k">end</span>
                 <span class="n">user</span>     <span class="nb">system</span>      <span class="n">total</span>        <span class="n">real</span>
<span class="nb">select</span>       <span class="mi">0</span><span class="o">.</span><span class="mo">020000</span>   <span class="mi">0</span><span class="o">.</span><span class="mo">000000</span>   <span class="mi">0</span><span class="o">.</span><span class="mo">020000</span> <span class="p">(</span>  <span class="mi">0</span><span class="o">.</span><span class="mo">02105</span><span class="mi">8</span><span class="p">)</span>
<span class="n">grep</span>         <span class="mi">0</span><span class="o">.</span><span class="mo">020000</span>   <span class="mi">0</span><span class="o">.</span><span class="mo">000000</span>   <span class="mi">0</span><span class="o">.</span><span class="mo">020000</span> <span class="p">(</span>  <span class="mi">0</span><span class="o">.</span><span class="mo">012626</span><span class="p">)</span>
</code></pre></div>
<p>There are some pretty good use cases for <code>#grep</code>, and one last thing worth
keeping in mind: <code>#grep</code> can take a second parameter, which acts
as <code>#map</code> does and reads very nicely. For example:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">056</span> <span class="o">&gt;</span> <span class="n">hello</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="s1">&#39;ello&#39;</span><span class="p">,</span> <span class="s1">&#39;llo&#39;</span><span class="p">,</span> <span class="s1">&#39;lo&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="o">]</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">057</span> <span class="o">&gt;</span> <span class="n">hello</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="sr">/[A-Z]\w+/</span> <span class="o">===</span> <span class="n">x</span> <span class="p">}</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:downcase</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;hello&quot;</span><span class="o">]</span>
<span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="p">:</span><span class="mo">05</span><span class="mi">8</span> <span class="o">&gt;</span> <span class="n">hello</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">/[A-Z]\w+/</span><span class="p">,</span> <span class="o">&amp;</span><span class="ss">:downcase</span><span class="p">)</span>
 <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;hello&quot;</span><span class="o">]</span>
</code></pre></div>]]></content:encoded>
      <dc:date>2015-04-09T07:37:00-04:00</dc:date>
    </item>
    <item>
      <title>4 Useful Github tricks which should be more popular</title>
      <link>https://www.ombulabs.com/blog/git/github/4-useful-github-tricks.html</link>
      <description><![CDATA[If you are using git in 2015, you are probably also using Github, unless you&#39;re self-hosting or still betting on Bitbucket.

Below are some cool, useful tricks you can use on Github which can probably make your life easier:
]]></description>
      <pubDate>Mon, 19 Jan 2015 13:35:00 -0500</pubDate>
      <guid>https://www.ombulabs.com/blog/git/github/4-useful-github-tricks.html</guid>
      <content:encoded><![CDATA[<p>If you are using git in 2015, you are probably also using <a href="http://www.github.com">Github</a>, unless you&#39;re self-hosting or still betting on <a href="http://www.bitbucket.com">Bitbucket</a>.</p>

<p>Below are some cool, useful tricks you can use on Github which can probably make your life easier:</p>

<!--more-->

<h2>T</h2>

<p>This is probably the most-well known and most used. By hitting the T key while browsing a repository, the file finder comes up, which lets you type in any file and it will search for that filename in the repository.</p>

<p>You can also navigate using the arrow keys, and access the file by hitting Enter.</p>

<h2>.diff / .patch</h2>

<p>By appending .diff to any diff URL on Github, you&#39;ll be able to see the plain-text version of it, as if looking at output from git.</p>

<h2>?w=1</h2>

<p>A not-so-well-known tip is appending ?w=1 to a diff URL to omit whitespaces from a diff.</p>

<p><a href="https://github.com/ombulabs/setup/commit/7c824aaca37a401bdd6d0f8acd1b11f510648bb4">Example diff on ombulabs/setup</a> vs <a href="https://github.com/ombulabs/setup/commit/7c824aaca37a401bdd6d0f8acd1b11f510648bb4?w=1">Example diff on ombulabs/setup with w=1</a></p>

<p>Probably not the best example but useful to remember for longer diffs.</p>

<h2>.keys</h2>

<p>You can get anyone&#39;s public keys by appending .keys to their Github username. For instance, to get my public keys: <a href="https://github.com/mauro-oto.keys">mauro-oto</a></p>

<p>For great git-specific tips, try <a href="http://mislav.uniqpath.com/2010/07/git-tips/">here</a> or <a href="http://gitready.com/">here</a>.</p>
]]></content:encoded>
      <dc:date>2015-01-19T13:35:00-05:00</dc:date>
    </item>
    <dc:date>2018-07-23T07:48:00-04:00</dc:date>
  </channel>
</rss>